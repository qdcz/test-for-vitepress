<!DOCTYPE html>
<html lang="en-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>child_process | æ¾œæ¼¾</title>
    <meta name="description" content="å¹¿å¤©ä¸‹ä¹‹å¹¿,æ·±å¤©ä¸‹ä¹‹æ·±">
    <link rel="stylesheet" href="/assets/style.49f07aca.css">
    <link rel="modulepreload" href="/assets/Home.a35a742d.js">
    <link rel="modulepreload" href="/assets/app.71728ad2.js">
    <link rel="modulepreload" href="/assets/service_NodeJs_child_process.md.83fa6bbd.lean.js">
    
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <meta name="keywords" content="æ¾œæ¼¾">
  <link rel="icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://lib.baomitu.com/gitalk/1.7.0/gitalk.min.css">
  <script src="https://lib.baomitu.com/gitalk/1.7.0/gitalk.min.js"></script>
  <script src="https://lib.baomitu.com/axios/0.21.1/axios.js"></script>
  <meta name="twitter:title" content="child_process | æ¾œæ¼¾">
  <meta property="og:title" content="child_process | æ¾œæ¼¾">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-d186b2c2><div class="sidebar-button" data-v-d186b2c2><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="æ¾œæ¼¾, back to home" data-v-d186b2c2 data-v-34a93bc8><img class="logo" src="/logo2.jpg" alt="Logo" data-v-34a93bc8> æ¾œæ¼¾</a><div class="flex-grow" data-v-d186b2c2></div><div class="nav" data-v-d186b2c2><nav class="nav-links" data-v-d186b2c2 data-v-30b7e073><!--[--><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/" data-v-711da5ba>ğŸ  é¦–é¡µ <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/service/go/study/index" data-v-711da5ba>å­¦ä¹ goçš„ç»å† <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/home/home" data-v-711da5ba>ç ä¸Šè¡ŒåŠ¨ <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/IDEShortcutKey/WebStorm" data-v-711da5ba>ç¼–è¾‘å™¨å¿«æ·é”® <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/environmentConstruction/index" data-v-711da5ba>ç¯å¢ƒæ­å»º <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/windowSystem/index" data-v-711da5ba>window <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/service/Linux/index" data-v-711da5ba>linux <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/about/index" data-v-711da5ba>ğŸ”¨å…³äº <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/concat/index" data-v-711da5ba>ğŸ‘«å‹æƒ…é“¾æ¥ <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/temporary/index" data-v-711da5ba>ä¸´æ—¶å­˜å‚¨ <!----></a></div></div><!--]--><!----><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item isExternal" href="https://github.com/qdcz" target="_blank" rel="noopener noreferrer" data-v-711da5ba>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-711da5ba><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-7e9d9da8><nav class="nav-links nav" data-v-7e9d9da8 data-v-30b7e073><!--[--><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/" data-v-711da5ba>ğŸ  é¦–é¡µ <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/service/go/study/index" data-v-711da5ba>å­¦ä¹ goçš„ç»å† <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/home/home" data-v-711da5ba>ç ä¸Šè¡ŒåŠ¨ <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/IDEShortcutKey/WebStorm" data-v-711da5ba>ç¼–è¾‘å™¨å¿«æ·é”® <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/environmentConstruction/index" data-v-711da5ba>ç¯å¢ƒæ­å»º <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/windowSystem/index" data-v-711da5ba>window <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/service/Linux/index" data-v-711da5ba>linux <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/about/index" data-v-711da5ba>ğŸ”¨å…³äº <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/concat/index" data-v-711da5ba>ğŸ‘«å‹æƒ…é“¾æ¥ <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/temporary/index" data-v-711da5ba>ä¸´æ—¶å­˜å‚¨ <!----></a></div></div><!--]--><!----><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item isExternal" href="https://github.com/qdcz" target="_blank" rel="noopener noreferrer" data-v-711da5ba>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-711da5ba><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-7e9d9da8><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#spawn">.spawn()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#exec">.exec()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#execfile">.execFile()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#fork">.fork()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#æ–¹æ³•">æ–¹æ³•</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#exec-1">exec()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#execfile-1">.execFile()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#fork-1">.fork()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#spawn-1">.spawn()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#options-detached">options.detached</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#options-stdio">options.stdio</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å­ç±»childprocess-äº‹ä»¶">å­ç±»ChildProcess äº‹ä»¶</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#close">close</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#disconnect">disconnect</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#error">error</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#exit">exit</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#message">message</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#spawn-2">spawn</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å±æ€§">å±æ€§</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-channel">subprocess.channel</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-channel-ref">subprocess.channel.ref()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-channel-unref">subprocess.channel.unref()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-connected">subprocess.connected</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-disconnect">subprocess.disconnect()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-exitcode">subprocess.exitCode</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-kill-signal">subprocess.kill([signal])</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-killed">subprocess.killed</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-pid">subprocess.pid</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-ref">subprocess.ref()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-send-message-sendhandle-options-callback">subprocess.send(message[, sendHandle[, options]][, callback])</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-signalcode">subprocess.signalCode</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-spawnargs">subprocess.spawnargs</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-spawnfile">subprocess.spawnfile</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-stderr">subprocess.stderr</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-stdin">subprocess.stdin</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-stdout">subprocess.stdout</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-stdio">subprocess.stdio</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subprocess-unref">subprocess.unref()</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#maxbuffer-å’Œ-unicode">maxBuffer å’Œ Unicode</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#shell-çš„è¦æ±‚">shell çš„è¦æ±‚</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#é»˜è®¤çš„-windows-shell">é»˜è®¤çš„ Windows shell</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#é«˜çº§åºåˆ—åŒ–">é«˜çº§åºåˆ—åŒ–</a><!----></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-f058c2ee><div class="container" data-v-f058c2ee><!--[--><!--]--><div style="position:relative;" class="content" data-v-f058c2ee><div><h1 id="child-process" tabindex="-1">child_process</h1><p>child_process æ¨¡å—æä¾›äº†è¡ç”Ÿå­è¿›ç¨‹çš„èƒ½åŠ›, ç®€å•æ¥è¯´å°±æ˜¯æ‰§è¡Œcmdå‘½ä»¤çš„èƒ½åŠ›</p><h2 id="spawn" tabindex="-1">.spawn()</h2><p>é€‚ç”¨äºè¿”å›å¤§é‡æ•°æ®ï¼Œä¾‹å¦‚å›¾åƒå¤„ç†ï¼ŒäºŒè¿›åˆ¶æ•°æ®å¤„ç†ã€‚</p><h2 id="exec" tabindex="-1">.exec()</h2><p>é€‚ç”¨äºå°é‡æ•°æ®ï¼ŒmaxBuffer é»˜è®¤å€¼ä¸º 200 * 1024 è¶…å‡ºè¿™ä¸ªé»˜è®¤å€¼å°†ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œæ•°æ®é‡è¿‡å¤§å¯é‡‡ç”¨ spawn</p><h2 id="execfile" tabindex="-1">.execFile()</h2><p>ç±»ä¼¼ child_process.exec()ï¼ŒåŒºåˆ«æ˜¯ä¸èƒ½é€šè¿‡ shell æ¥æ‰§è¡Œï¼Œä¸æ”¯æŒåƒ I/O é‡å®šå‘å’Œæ–‡ä»¶æŸ¥æ‰¾è¿™æ ·çš„è¡Œä¸º</p><h2 id="fork" tabindex="-1">.fork()</h2><p>è¡ç”Ÿæ–°çš„è¿›ç¨‹ï¼Œè¿›ç¨‹ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„ V8 å®ä¾‹ã€å†…å­˜ï¼Œç³»ç»Ÿèµ„æºæ˜¯æœ‰é™çš„ï¼Œä¸å»ºè®®è¡ç”Ÿå¤ªå¤šçš„å­è¿›ç¨‹å‡ºæ¥ï¼Œ é€šé•¿æ ¹æ®ç³»ç»Ÿ** CPU æ ¸å¿ƒæ•°**è®¾ç½®ã€‚</p><p>å¼‚æ­¥åˆ›å»ºè¿›ç¨‹</p><p>spawnã€forkã€execã€execFileéƒ½éµå¾ªå¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½è¿”å›childProcesså®ä¾‹ã€‚</p><h2 id="æ–¹æ³•" tabindex="-1">æ–¹æ³•</h2><h3 id="exec-1" tabindex="-1">exec()</h3><p>è¯­æ³•ï¼š</p><div class="language-html"><pre><code>options <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span>
    cwd <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>URL</span><span class="token punctuation">&gt;</span></span> å­è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ã€‚ é»˜è®¤å€¼: process.cwd()ã€‚
    env <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span> ç¯å¢ƒå˜é‡é”®å€¼å¯¹ã€‚ é»˜è®¤å€¼: process.<wbr>envã€‚
    encoding <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> é»˜è®¤å€¼: &#39;utf8&#39;
    shell <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> ç”¨äºæ‰§è¡Œå‘½ä»¤çš„ shellã€‚ è¯·å‚é˜… shell çš„è¦æ±‚å’Œé»˜è®¤çš„ Windows shellã€‚ é»˜è®¤å€¼: Unix ä¸Šæ˜¯ &#39;/bin/sh&#39;ï¼ŒWindows ä¸Šæ˜¯ process.<wbr>env.ComSpecã€‚
    signal <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AbortSignal</span><span class="token punctuation">&gt;</span></span> å…è®¸ä½¿ç”¨ä¸­æ­¢ä¿¡å·ä¸­æ­¢å­è¿›ç¨‹ã€‚
    timeout <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> é»˜è®¤å€¼: 0
    maxBuffer <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> æ ‡å‡†è¾“å‡ºæˆ–æ ‡å‡†é”™è¯¯ä¸Šå…è®¸çš„æœ€å¤§æ•°æ®é‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ å¦‚æœè¶…è¿‡ï¼Œåˆ™å­è¿›ç¨‹å°†ç»ˆæ­¢å¹¶æˆªæ–­ä»»ä½•è¾“å‡ºã€‚ è¯·å‚é˜… maxBuffer å’Œ Unicode çš„æ³¨æ„äº‹é¡¹ã€‚ é»˜è®¤å€¼: 1024 * 1024ã€‚
    killSignal <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>integer</span><span class="token punctuation">&gt;</span></span> é»˜è®¤å€¼: &#39;SIGTERM&#39;
    uid <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> è®¾ç½®è¿›ç¨‹çš„ç”¨æˆ·æ ‡è¯†ï¼ˆå‚è§ setuid(2)ï¼‰ã€‚
    gid <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> è®¾ç½®è¿›ç¨‹çš„ç¾¤ç»„æ ‡è¯†ï¼ˆå‚è§ setgid(2)ï¼‰ã€‚
    windowsHide <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span> éšè—é€šå¸¸åœ¨ Windows ç³»ç»Ÿä¸Šåˆ›å»ºçš„å­è¿›ç¨‹æ§åˆ¶å°çª—å£ã€‚ é»˜è®¤å€¼: falseã€‚
callback <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Function</span><span class="token punctuation">&gt;</span></span> å½“è¿›ç¨‹ç»ˆæ­¢æ—¶ä½¿ç”¨è¾“å‡ºè°ƒç”¨ã€‚
    error <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Error</span><span class="token punctuation">&gt;</span></span>
    stdout <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Buffer</span><span class="token punctuation">&gt;</span></span>
    stderr <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Buffer</span><span class="token punctuation">&gt;</span></span>
è¿”å›: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildProcess</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>è¡ç”Ÿ shellï¼Œç„¶ååœ¨è¯¥ shell ä¸­æ‰§è¡Œ commandï¼Œç¼“å†²ä»»ä½•ç”Ÿæˆçš„è¾“å‡ºã€‚ ä¼ ç»™æ‰§è¡Œå‡½æ•°çš„ command å­—ç¬¦ä¸²ç”± shell ç›´æ¥å¤„ç†ï¼Œ ç‰¹æ®Šå­—ç¬¦ï¼ˆå›  shell è€Œå¼‚ï¼‰éœ€è¦è¿›è¡Œç›¸åº”å¤„ç†ï¼š</p><div class="language-js"><pre><code><span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:util&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> exec <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">&#39;echo &quot;The \\$HOME variable is $HOME&quot;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// $HOME å˜é‡åœ¨ç¬¬ä¸€ä¸ªå®ä¾‹ä¸­è¢«è½¬ä¹‰ï¼Œä½†åœ¨ç¬¬äºŒä¸ªå®ä¾‹ä¸­æ²¡æœ‰ã€‚</span>


<span class="token comment">/**
 * å›è°ƒæ¨¡å¼
 * ä½¿ç”¨åŒå¼•å·ï¼Œè¿™æ ·è·¯å¾„ä¸­çš„ç©ºæ ¼å°±ä¸ä¼šè¢«è§£é‡Šä¸ºå¤šä¸ªå‚æ•°çš„åˆ†éš”ç¬¦ã€‚
 */</span>
<span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">&#39;&quot;/path/to/test file/test.sh&quot; arg1 arg2&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">exec error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stdout: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stdout<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stderr: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stderr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">/**
 * å¼‚æ­¥è½¬åŒæ­¥æ¨¡å¼
 * 
 å¦‚æœæ­¤æ–¹æ³•ä½œä¸ºå…¶ util.promisify() ç‰ˆæœ¬è¢«è°ƒç”¨ï¼Œåˆ™å…¶å°†ä¸ºå…·æœ‰ stdout å’Œ stderr å±æ€§çš„ Object 
 è¿”å› Promiseã€‚è¿”å›çš„ ChildProcess å®ä¾‹ä½œä¸º child å±æ€§é™„åŠ åˆ° Promiseã€‚ å¦‚æœå‡ºç°é”™è¯¯
 ï¼ˆåŒ…æ‹¬ä»»ä½•å¯¼è‡´é€€å‡ºç ä¸æ˜¯ 0 çš„é”™è¯¯ï¼‰,åˆ™å°†è¿”å›è¢«æ‹’ç»çš„ promise,å…¶å…·æœ‰ä¸å›è°ƒä¸­ç»™å®šç›¸åŒçš„ errorå¯¹è±¡ï¼Œ
 ä½†æœ‰ä¸¤ä¸ªé¢å¤–çš„å±æ€§ stdout å’Œ stderrã€‚
 */</span>
<span class="token keyword">const</span> _exec <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>exec<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">lsExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> stdout<span class="token punctuation">,</span> stderr <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_exec</span><span class="token punctuation">(</span><span class="token string">&#39;ls&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;stdout:&#39;</span><span class="token punctuation">,</span> stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;stderr:&#39;</span><span class="token punctuation">,</span> stderr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">lsExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">/**
 å¦‚æœå¯ç”¨äº† signal é€‰é¡¹ï¼Œåˆ™åœ¨ç›¸åº”çš„ AbortController ä¸Šè°ƒç”¨ .abort() ä¸åœ¨å­è¿›ç¨‹ä¸Šè°ƒç”¨
 .kill() ç±»ä¼¼ï¼Œåªæ˜¯ä¼ ç»™å›è°ƒçš„é”™è¯¯å°†æ˜¯ AbortErrorï¼š
 */</span>
<span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span> <span class="token operator">=</span> controller<span class="token punctuation">;</span>
<span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">&#39;grep ssh&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸€ä¸ª AbortError</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å¦‚æœ timeout å¤§äº 0ï¼Œåˆ™å¦‚æœå­è¿›ç¨‹è¿è¡Œæ—¶é—´è¶…è¿‡ timeout æ¯«ç§’ï¼Œçˆ¶è¿›ç¨‹å°†å‘é€ç”± killSignal å±æ€§ï¼ˆé»˜è®¤ä¸º &#39;SIGTERM&#39;ï¼‰æ ‡è¯†çš„ä¿¡å·ã€‚</p><h3 id="execfile-1" tabindex="-1">.execFile()</h3><p>child_process.execFile() å‡½æ•°ä¸ child_process.exec() ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒé»˜è®¤ä¸è¡ç”Ÿ shellã€‚ è€Œæ˜¯ï¼ŒæŒ‡å®šçš„å¯æ‰§è¡Œæ–‡ä»¶ file ç›´æ¥ä½œä¸ºæ–°è¿›ç¨‹è¡ç”Ÿï¼Œä½¿å…¶æ¯” child_process.exec() ç•¥æœ‰æ•ˆç‡ã€‚</p><p>æ”¯æŒä¸ child_process.exec() ç›¸åŒçš„é€‰é¡¹ã€‚ ç”±äºæœªè¡ç”Ÿ shellï¼Œå› æ­¤ä¸æ”¯æŒ I/O é‡å®šå‘å’Œæ–‡ä»¶é€šé…ç­‰è¡Œä¸ºã€‚</p><div class="language-html"><pre><code>file <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> è¦è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°æˆ–è·¯å¾„ã€‚
args <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string[]</span><span class="token punctuation">&gt;</span></span> å­—ç¬¦ä¸²å‚æ•°åˆ—è¡¨ã€‚
options <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span>
    cwd <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>URL</span><span class="token punctuation">&gt;</span></span> å­è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ã€‚
    env <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span> ç¯å¢ƒå˜é‡é”®å€¼å¯¹ã€‚ é»˜è®¤å€¼: process.<wbr>envã€‚
    encoding <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> é»˜è®¤å€¼: &#39;utf8&#39;
    timeout <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> é»˜è®¤å€¼: 0
    maxBuffer <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> æ ‡å‡†è¾“å‡ºæˆ–æ ‡å‡†é”™è¯¯ä¸Šå…è®¸çš„æœ€å¤§æ•°æ®é‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ å¦‚æœè¶…è¿‡ï¼Œåˆ™å­è¿›ç¨‹å°†ç»ˆæ­¢å¹¶æˆªæ–­ä»»ä½•è¾“å‡ºã€‚ è¯·å‚é˜… maxBuffer å’Œ Unicode çš„æ³¨æ„äº‹é¡¹ã€‚ é»˜è®¤å€¼: 1024 * 1024ã€‚
    killSignal <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>integer</span><span class="token punctuation">&gt;</span></span> é»˜è®¤å€¼: &#39;SIGTERM&#39;
    uid <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> è®¾ç½®è¿›ç¨‹çš„ç”¨æˆ·æ ‡è¯†ï¼ˆå‚è§ setuid(2)ï¼‰ã€‚
    gid <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> è®¾ç½®è¿›ç¨‹çš„ç¾¤ç»„æ ‡è¯†ï¼ˆå‚è§ setgid(2)ï¼‰ã€‚
    windowsHide <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span> éšè—é€šå¸¸åœ¨ Windows ç³»ç»Ÿä¸Šåˆ›å»ºçš„å­è¿›ç¨‹æ§åˆ¶å°çª—å£ã€‚ é»˜è®¤å€¼: falseã€‚
    windowsVerbatimArguments <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span> åœ¨ Windows ä¸Šä¸ä¸ºå‚æ•°åŠ ä¸Šå¼•å·æˆ–è½¬ä¹‰ã€‚ åœ¨ Unix ä¸Šè¢«å¿½ç•¥ã€‚ é»˜è®¤å€¼: falseã€‚
    shell <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> å¦‚æœæ˜¯ trueï¼Œåˆ™åœ¨ shell å†…è¿è¡Œ commandã€‚ åœ¨ Unix ä¸Šä½¿ç”¨ &#39;/bin/sh&#39;ï¼Œåœ¨ Windows ä¸Šä½¿ç”¨ process.<wbr>env.ComSpecã€‚ å¯ä»¥å°†ä¸åŒçš„ shell æŒ‡å®šä¸ºå­—ç¬¦ä¸²ã€‚ è¯·å‚é˜… shell çš„è¦æ±‚å’Œé»˜è®¤çš„ Windows shellã€‚ é»˜è®¤å€¼: false ï¼ˆæ²¡æœ‰ shellï¼‰
    signal <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AbortSignal</span><span class="token punctuation">&gt;</span></span> å…è®¸ä½¿ç”¨ä¸­æ­¢ä¿¡å·ä¸­æ­¢å­è¿›ç¨‹ã€‚
callback <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Function</span><span class="token punctuation">&gt;</span></span> è¿›ç¨‹ç»ˆæ­¢æ—¶ä½¿ç”¨è¾“å‡ºè°ƒç”¨ã€‚
    error <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Error</span><span class="token punctuation">&gt;</span></span>
    stdout <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Buffer</span><span class="token punctuation">&gt;</span></span>
    stderr <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Buffer</span><span class="token punctuation">&gt;</span></span>
è¿”å›: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildProcess</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js"><pre><code><span class="token comment">/**
 * é¦–ä¾‹ å›è°ƒæ–¹å¼
 */</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> execFile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">execFile</span><span class="token punctuation">(</span><span class="token string">&#39;node&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;--version&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token comment">/**
 * å¼‚æ­¥è½¬åŒæ­¥æ¨¡å¼
 */</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:util&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> execFile <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> stdout <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">execFile</span><span class="token punctuation">(</span><span class="token string">&#39;node&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;--version&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>




<span class="token comment">// å¦‚æœå¯ç”¨äº† shell é€‰é¡¹ï¼Œåˆ™è¯·å‹¿å°†æœªç»å¤„ç†çš„ç”¨æˆ·è¾“å…¥ä¼ é€’ç»™æ­¤å‡½æ•°ã€‚ ä»»ä½•åŒ…å« shell å…ƒå­—ç¬¦çš„è¾“å…¥éƒ½å¯ç”¨äºè§¦å‘ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚</span>
<span class="token comment">// å¦‚æœå¯ç”¨äº† signal é€‰é¡¹ï¼Œåˆ™åœ¨ç›¸åº”çš„ AbortController ä¸Šè°ƒç”¨ .abort() ä¸åœ¨å­è¿›ç¨‹ä¸Šè°ƒç”¨ .kill() ç±»ä¼¼ï¼Œåªæ˜¯ä¼ ç»™å›è°ƒçš„é”™è¯¯å°†æ˜¯ AbortErrorï¼š</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> execFile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span> <span class="token operator">=</span> controller<span class="token punctuation">;</span>
<span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">execFile</span><span class="token punctuation">(</span><span class="token string">&#39;node&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;--version&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸€ä¸ª AbortError</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="fork-1" tabindex="-1">.fork()</h3><div class="language-html"><pre><code>modulePath <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>URL</span><span class="token punctuation">&gt;</span></span> è¦åœ¨å­è¿›ç¨‹ä¸­è¿è¡Œçš„æ¨¡å—ã€‚
args <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string[]</span><span class="token punctuation">&gt;</span></span> å­—ç¬¦ä¸²å‚æ•°åˆ—è¡¨ã€‚
options <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span>
    cwd <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>URL</span><span class="token punctuation">&gt;</span></span> å­è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ã€‚
    detached <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span> å‡†å¤‡å­è¿›ç¨‹ç‹¬ç«‹äºå…¶çˆ¶è¿›ç¨‹è¿è¡Œã€‚ å…·ä½“è¡Œä¸ºå–å†³äºå¹³å°ï¼Œå‚è§ options.detachedã€‚
    env <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span> ç¯å¢ƒå˜é‡é”®å€¼å¯¹ã€‚ é»˜è®¤å€¼: process.<wbr>envã€‚
    execPath <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> ç”¨äºåˆ›å»ºå­è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚
    execArgv <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string[]</span><span class="token punctuation">&gt;</span></span> ä¼ ç»™å¯æ‰§è¡Œæ–‡ä»¶çš„å­—ç¬¦ä¸²å‚æ•°åˆ—è¡¨ã€‚ é»˜è®¤å€¼: process.execArgvã€‚
    gid <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> è®¾ç½®è¿›ç¨‹çš„ç¾¤ç»„æ ‡è¯†ï¼ˆå‚è§ setgid(2)ï¼‰ã€‚
    serialization <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> æŒ‡å®šç”¨äºåœ¨è¿›ç¨‹ä¹‹é—´å‘é€æ¶ˆæ¯çš„åºåˆ—åŒ–ç±»å‹ã€‚ å¯èƒ½çš„å€¼ä¸º &#39;json&#39; å’Œ &#39;advanced&#39;ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…é«˜çº§åºåˆ—åŒ–ã€‚ é»˜è®¤å€¼: &#39;json&#39;ã€‚
    signal <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AbortSignal</span><span class="token punctuation">&gt;</span></span> å…è®¸ä½¿ç”¨ä¸­æ­¢ä¿¡å·å…³é—­å­è¿›ç¨‹ã€‚
    killSignal <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>integer</span><span class="token punctuation">&gt;</span></span> å½“è¡ç”Ÿçš„è¿›ç¨‹å°†è¢«è¶…æ—¶æˆ–ä¸­æ­¢ä¿¡å·æ€æ­»æ—¶è¦ä½¿ç”¨çš„ä¿¡å·å€¼ã€‚ é»˜è®¤å€¼: &#39;SIGTERM&#39;ã€‚
    silent <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span> å¦‚æœä¸º trueï¼Œåˆ™å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯å°†é€šè¿‡ç®¡é“ä¼ è¾“åˆ°çˆ¶è¿›ç¨‹ï¼Œå¦åˆ™å®ƒä»¬å°†ä»çˆ¶è¿›ç¨‹ç»§æ‰¿ï¼Œæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… child_process.spawn() çš„ stdio çš„ &#39;pipe&#39; å’Œ &#39;inherit&#39; é€‰é¡¹ã€‚ é»˜è®¤å€¼: falseã€‚
    stdio <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Array</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> å‚è§ child_process.spawn() çš„ stdioã€‚ æä¾›æ­¤é€‰é¡¹æ—¶ï¼Œå®ƒä¼šè¦†ç›– silentã€‚ å¦‚æœä½¿ç”¨æ•°ç»„å˜ä½“ï¼Œåˆ™å®ƒå¿…é¡»æ°å¥½åŒ…å«ä¸€ä¸ªå€¼ä¸º &#39;ipc&#39; çš„æ¡ç›®ï¼Œå¦åˆ™å°†æŠ›å‡ºé”™è¯¯ã€‚ ä¾‹å¦‚ [0, 1, 2, &#39;ipc&#39;]ã€‚
    uid <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> è®¾ç½®è¿›ç¨‹çš„ç”¨æˆ·æ ‡è¯†ï¼ˆå‚è§ setuid(2)ï¼‰ã€‚
    windowsVerbatimArguments <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span> åœ¨ Windows ä¸Šä¸ä¸ºå‚æ•°åŠ ä¸Šå¼•å·æˆ–è½¬ä¹‰ã€‚ åœ¨ Unix ä¸Šè¢«å¿½ç•¥ã€‚ é»˜è®¤å€¼: falseã€‚
    timeout <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> å…è®¸è¿›ç¨‹è¿è¡Œçš„æœ€é•¿æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚ é»˜è®¤å€¼: undefinedã€‚
è¿”å›: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildProcess</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>child_process.fork() æ–¹æ³•æ˜¯ child_process.spawn() çš„ç‰¹ä¾‹ï¼Œä¸“é—¨ç”¨äºè¡ç”Ÿæ–°çš„ Node.js è¿›ç¨‹ã€‚ ä¸ child_process.spawn() ä¸€æ ·ï¼Œ è¿”å› ChildProcess å¯¹è±¡ã€‚ è¿”å›çš„ ChildProcess å°†æœ‰é¢å¤–çš„å†…ç½®é€šä¿¡é€šé“ï¼Œå…è®¸æ¶ˆæ¯åœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´æ¥å›ä¼ é€’ã€‚ è¯¦è§ subprocess.send()ã€‚</p><p>è¯·è®°ä½ï¼Œè¡ç”Ÿçš„ Node.js å­è¿›ç¨‹ç‹¬ç«‹äºçˆ¶è¿›ç¨‹ï¼Œé™¤äº†ä¸¤è€…ä¹‹é—´å»ºç«‹çš„ IPC é€šä¿¡é€šé“ã€‚ æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„å†…å­˜ï¼Œå…·æœ‰è‡ªå·±çš„ V8 å®ä¾‹ã€‚ ç”±äºéœ€è¦é¢å¤–çš„èµ„æºåˆ†é…ï¼Œä¸å»ºè®®è¡ç”Ÿå¤§é‡å­ Node.js è¿›ç¨‹ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œchild_process.fork() å°†ä½¿ç”¨çˆ¶è¿›ç¨‹çš„ process.execPath è¡ç”Ÿæ–°çš„ Node.js å®ä¾‹ã€‚ options å¯¹è±¡ä¸­çš„ execPath å±æ€§å…è®¸ä½¿ç”¨æ›¿ä»£çš„æ‰§è¡Œè·¯å¾„ã€‚</p><p>ä½¿ç”¨è‡ªå®šä¹‰ execPath å¯åŠ¨çš„ Node.js è¿›ç¨‹å°†ä½¿ç”¨åœ¨å­è¿›ç¨‹ä¸Šä½¿ç”¨ç¯å¢ƒå˜é‡ NODE_CHANNEL_FD æ ‡è¯†çš„æ–‡ä»¶æè¿°ç¬¦ä¸çˆ¶è¿›ç¨‹é€šä¿¡ã€‚</p><p>ä¸ fork(2) POSIX ç³»ç»Ÿè°ƒç”¨ä¸åŒï¼Œchild_process.fork() ä¸å…‹éš†å½“å‰è¿›ç¨‹ã€‚</p><p>child_process.fork() ä¸æ”¯æŒ child_process.spawn() ä¸­å¯ç”¨çš„ shell é€‰é¡¹ï¼Œå¦‚æœè®¾ç½®å°†è¢«å¿½ç•¥ã€‚</p><p>å¦‚æœå¯ç”¨äº† signal é€‰é¡¹ï¼Œåˆ™åœ¨ç›¸åº”çš„ AbortController ä¸Šè°ƒç”¨ .abort() ä¸åœ¨å­è¿›ç¨‹ä¸Šè°ƒç”¨ .kill() ç±»ä¼¼ï¼Œåªæ˜¯ä¼ ç»™å›è°ƒçš„é”™è¯¯å°†æ˜¯ AbortErrorï¼š</p><div class="language-js"><pre><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æˆ‘è¢«åˆ›å»ºäº†Næ¬¡&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;child&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1_000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> fork <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span> <span class="token operator">=</span> controller<span class="token punctuation">;</span>
    <span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span>__filename<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;child&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    child<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœæ§åˆ¶å™¨ä¸­æ­¢ï¼Œåˆ™è¿™å°†åœ¨ err ä¸º AbortError çš„æƒ…å†µä¸‹è¢«è°ƒç”¨</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åœæ­¢å­è¿›ç¨‹</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="spawn-1" tabindex="-1">.spawn()</h3><div class="language-html"><pre><code>command <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> è¦è¿è¡Œçš„å‘½ä»¤ã€‚
args <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string[]</span><span class="token punctuation">&gt;</span></span> å­—ç¬¦ä¸²å‚æ•°åˆ—è¡¨ã€‚
options <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span>
    cwd <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>URL</span><span class="token punctuation">&gt;</span></span> å­è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ã€‚
    env <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span> ç¯å¢ƒå˜é‡é”®å€¼å¯¹ã€‚ é»˜è®¤å€¼: process.<wbr>envã€‚
    argv0 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> æ˜¾å¼è®¾ç½®å‘é€ç»™å­è¿›ç¨‹çš„ argv[0] çš„å€¼ã€‚ å¦‚æœæœªæŒ‡å®šï¼Œè¿™å°†è®¾ç½®ä¸º commandã€‚
    stdio <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Array</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºé…ç½®ï¼ˆå‚è§ options.stdioï¼‰ã€‚
    detached <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span> å‡†å¤‡å­è¿›ç¨‹ç‹¬ç«‹äºå…¶çˆ¶è¿›ç¨‹è¿è¡Œã€‚ å…·ä½“è¡Œä¸ºå–å†³äºå¹³å°ï¼Œå‚è§ options.detachedã€‚
    uid <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> è®¾ç½®è¿›ç¨‹çš„ç”¨æˆ·æ ‡è¯†ï¼ˆå‚è§ setuid(2)ï¼‰ã€‚
    gid <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> è®¾ç½®è¿›ç¨‹çš„ç¾¤ç»„æ ‡è¯†ï¼ˆå‚è§ setgid(2)ï¼‰ã€‚
    serialization <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> æŒ‡å®šç”¨äºåœ¨è¿›ç¨‹ä¹‹é—´å‘é€æ¶ˆæ¯çš„åºåˆ—åŒ–ç±»å‹ã€‚ å¯èƒ½çš„å€¼ä¸º &#39;json&#39; å’Œ &#39;advanced&#39;ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…é«˜çº§åºåˆ—åŒ–ã€‚ é»˜è®¤å€¼: &#39;json&#39;ã€‚
    shell <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> å¦‚æœæ˜¯ trueï¼Œåˆ™åœ¨ shell å†…è¿è¡Œ commandã€‚ åœ¨ Unix ä¸Šä½¿ç”¨ &#39;/bin/sh&#39;ï¼Œåœ¨ Windows ä¸Šä½¿ç”¨ process.<wbr>env.ComSpecã€‚ å¯ä»¥å°†ä¸åŒçš„ shell æŒ‡å®šä¸ºå­—ç¬¦ä¸²ã€‚ è¯·å‚é˜… shell çš„è¦æ±‚å’Œé»˜è®¤çš„ Windows shellã€‚ é»˜è®¤å€¼: false ï¼ˆæ²¡æœ‰ shellï¼‰
    windowsVerbatimArguments <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span> åœ¨ Windows ä¸Šä¸ä¸ºå‚æ•°åŠ ä¸Šå¼•å·æˆ–è½¬ä¹‰ã€‚ åœ¨ Unix ä¸Šè¢«å¿½ç•¥ã€‚ å½“æŒ‡å®šäº† shell å¹¶ä¸”æ˜¯ CMD æ—¶ï¼Œåˆ™è‡ªåŠ¨è®¾ç½®ä¸º trueã€‚ é»˜è®¤å€¼: falseã€‚
    windowsHide <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span> éšè—é€šå¸¸åœ¨ Windows ç³»ç»Ÿä¸Šåˆ›å»ºçš„å­è¿›ç¨‹æ§åˆ¶å°çª—å£ã€‚ é»˜è®¤å€¼: falseã€‚
    signal <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AbortSignal</span><span class="token punctuation">&gt;</span></span> å…è®¸ä½¿ç”¨ä¸­æ­¢ä¿¡å·ä¸­æ­¢å­è¿›ç¨‹ã€‚
    timeout <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> å…è®¸è¿›ç¨‹è¿è¡Œçš„æœ€é•¿æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚ é»˜è®¤å€¼: undefinedã€‚
    killSignal <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>integer</span><span class="token punctuation">&gt;</span></span> å½“è¡ç”Ÿçš„è¿›ç¨‹å°†è¢«è¶…æ—¶æˆ–ä¸­æ­¢ä¿¡å·æ€æ­»æ—¶è¦ä½¿ç”¨çš„ä¿¡å·å€¼ã€‚ é»˜è®¤å€¼: &#39;SIGTERM&#39;ã€‚
è¿”å›: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildProcess</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>child_process.spawn() æ–¹æ³•ä½¿ç”¨ç»™å®šçš„ command å’Œ args ä¸­çš„å‘½ä»¤è¡Œå‚æ•°è¡ç”Ÿæ–°è¿›ç¨‹ã€‚ å¦‚æœçœç•¥ï¼Œargs é»˜è®¤ä¸ºç©ºæ•°ç»„ã€‚</p><p>å¦‚æœå¯ç”¨äº† shell é€‰é¡¹ï¼Œåˆ™è¯·å‹¿å°†æœªç»å¤„ç†çš„ç”¨æˆ·è¾“å…¥ä¼ é€’ç»™æ­¤å‡½æ•°ã€‚ ä»»ä½•åŒ…å« shell å…ƒå­—ç¬¦çš„è¾“å…¥éƒ½å¯ç”¨äºè§¦å‘ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚</p><p>ä½¿ç”¨ cwd æŒ‡å®šä»ä¸­è¡ç”Ÿè¿›ç¨‹çš„å·¥ä½œç›®å½•ã€‚ å¦‚æœæ²¡æœ‰ç»™å®šï¼Œåˆ™é»˜è®¤æ˜¯ç»§æ‰¿å½“å‰å·¥ä½œç›®å½•ã€‚ å¦‚æœç»™å®šï¼Œä½†è·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™å­è¿›ç¨‹ä¼šè§¦å‘ ENOENT é”™è¯¯å¹¶ç«‹å³é€€å‡ºã€‚ å½“å‘½ä»¤ä¸å­˜åœ¨æ—¶ï¼Œä¹Ÿä¼šè§¦å‘ ENOENTã€‚</p><p>ä½¿ç”¨ env æŒ‡å®šå¯¹æ–°è¿›ç¨‹å¯è§çš„ç¯å¢ƒå˜é‡ï¼Œé»˜è®¤ä¸º process.<wbr>envã€‚</p><p>env ä¸­çš„ undefined å€¼å°†è¢«å¿½ç•¥ã€‚</p><div class="language-js"><pre><code><span class="token comment">/**
 * è¿è¡Œ ls -lh /usrã€æ•è· stdoutã€stderr å’Œé€€å‡ºç çš„ç¤ºä¾‹ï¼š
 */</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ls <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">&#39;ls&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;-lh&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/usr&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ls<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stdout: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ls<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stderr: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ls<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;close&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">child process exited with code </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>




<span class="token comment">/**
 * ç¤ºä¾‹ï¼šä¸€ç§éå¸¸ç²¾ç»†çš„è¿è¡Œ ps ax | grep ssh çš„æ–¹å¼
 */</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ps <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">&#39;ps&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;ax&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> grep <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">&#39;grep&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;ssh&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ps<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    grep<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ps<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ps stderr: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ps<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;close&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ps process exited with code </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    grep<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

grep<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

grep<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">grep stderr: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

grep<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;close&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">grep process exited with code </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">/**
 * æŸäº›å¹³å°ï¼ˆmacOSã€Linuxï¼‰å°†ä½¿ç”¨ argv[0] çš„å€¼ä½œä¸ºè¿›ç¨‹æ ‡é¢˜ï¼Œè€Œå…¶ä»–å¹³å°ï¼ˆWindowsã€SunOSï¼‰å°†ä½¿ç”¨ commandã€‚

 Node.js å½“å‰åœ¨å¯åŠ¨æ—¶ç”¨ process.execPath è¦†ç›– argv[0]ï¼Œå› æ­¤ Node.js å­è¿›ç¨‹ä¸­çš„ process.argv[0] å°†ä¸åŒ¹é…ä»çˆ¶è¿›ç¨‹ä¼ ç»™ spawn çš„ argv0 å‚æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨ process.argv0 å±æ€§æ£€ç´¢å®ƒã€‚

 å¦‚æœå¯ç”¨äº† signal é€‰é¡¹ï¼Œåˆ™åœ¨ç›¸åº”çš„ AbortController ä¸Šè°ƒç”¨ .abort() ä¸åœ¨å­è¿›ç¨‹ä¸Šè°ƒç”¨ .kill() ç±»ä¼¼ï¼Œåªæ˜¯ä¼ ç»™å›è°ƒçš„é”™è¯¯å°†æ˜¯ AbortErrorï¼š
 */</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span> <span class="token operator">=</span> controller<span class="token punctuation">;</span>
<span class="token keyword">const</span> grep <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">&#39;grep&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;ssh&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
grep<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæ§åˆ¶å™¨ä¸­æ­¢ï¼Œåˆ™è¿™å°†åœ¨ err ä¸º AbortError çš„æƒ…å†µä¸‹è¢«è°ƒç”¨</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åœæ­¢å­è¿›ç¨‹</span>
</code></pre></div><h3 id="options-detached" tabindex="-1">options.detached</h3><p>åœ¨ Windows ä¸Šï¼Œå°† options.detached è®¾ç½®ä¸º true å¯ä»¥è®©å­è¿›ç¨‹åœ¨çˆ¶è¿›ç¨‹é€€å‡ºåç»§ç»­è¿è¡Œã€‚ å­è¿›ç¨‹å°†æœ‰è‡ªå·±çš„æ§åˆ¶å°çª—å£ã€‚ ä¸€æ—¦ä¸ºå­è¿›ç¨‹å¯ç”¨ï¼Œåˆ™å®ƒå°±ä¸èƒ½è¢«ç¦ç”¨ã€‚</p><p>åœ¨é Windows å¹³å°ä¸Šï¼Œå¦‚æœ options.detached è®¾ç½®ä¸º trueï¼Œåˆ™å­è¿›ç¨‹å°†æˆä¸ºæ–°è¿›ç¨‹ç»„å’Œä¼šè¯çš„é¢†å¯¼è€…ã€‚ å­è¿›ç¨‹å¯ä»¥åœ¨çˆ¶è¿›ç¨‹é€€å‡ºåç»§ç»­è¿è¡Œï¼Œä¸ç®¡å®ƒä»¬æ˜¯å¦åˆ†ç¦»ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… setsid(2)ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œçˆ¶è¿›ç¨‹å°†ç­‰å¾…åˆ†ç¦»çš„å­è¿›ç¨‹é€€å‡ºã€‚ ä¸ºäº†é˜²æ­¢çˆ¶è¿›ç¨‹ç­‰å¾…ç»™å®šçš„ subprocess é€€å‡ºï¼Œåˆ™ä½¿ç”¨ subprocess.unref() æ–¹æ³•ã€‚ è¿™æ ·åšä¼šä½¿çˆ¶è¿›ç¨‹çš„äº‹ä»¶å¾ªç¯ä¸å°†å­è¿›ç¨‹åŒ…æ‹¬åœ¨å…¶å¼•ç”¨è®¡æ•°ä¸­ï¼Œä»è€Œå…è®¸çˆ¶è¿›ç¨‹ç‹¬ç«‹äºå­è¿›ç¨‹é€€å‡ºï¼Œé™¤éåœ¨å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ä¹‹é—´å»ºç«‹äº† IPC é€šé“ã€‚</p><p>å½“ä½¿ç”¨ detached é€‰é¡¹å¯åŠ¨é•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹æ—¶ï¼Œè¿›ç¨‹åœ¨çˆ¶è¿›ç¨‹é€€å‡ºåä¸ä¼šä¸€ç›´åœ¨åå°è¿è¡Œï¼Œé™¤éæä¾›äº†æœªè¿æ¥åˆ°çˆ¶è¿›ç¨‹çš„ stdio é…ç½®ã€‚ å¦‚æœç»§æ‰¿äº†çˆ¶è¿›ç¨‹çš„ stdioï¼Œåˆ™å­è¿›ç¨‹å°†ä¿æŒä¸æ§åˆ¶ç»ˆç«¯çš„è¿æ¥ã€‚</p><p>é•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹çš„ç¤ºä¾‹ï¼Œé€šè¿‡åˆ†ç¦»å¹¶å¿½ç•¥å…¶çˆ¶è¿›ç¨‹çš„ stdio æ–‡ä»¶æè¿°ç¬¦ï¼Œä»¥å¿½ç•¥çˆ¶è¿›ç¨‹çš„ç»ˆæ­¢ï¼š</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> subprocess <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;child_program.js&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">detached</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">&#39;ignore&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

subprocess<span class="token punctuation">.</span><span class="token function">unref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æˆ–è€…ï¼Œå¯ä»¥å°†å­è¿›ç¨‹çš„è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ä¸­ï¼š</p><div class="language-js"><pre><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> out <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">openSync</span><span class="token punctuation">(</span><span class="token string">&#39;./out.log&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> err <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">openSync</span><span class="token punctuation">(</span><span class="token string">&#39;./out.log&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> subprocess <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">&#39;prg&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">detached</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;ignore&#39;</span><span class="token punctuation">,</span> out<span class="token punctuation">,</span> err <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

subprocess<span class="token punctuation">.</span><span class="token function">unref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="options-stdio" tabindex="-1">options.stdio</h3><p>options.stdio é€‰é¡¹ç”¨äºé…ç½®åœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´å»ºç«‹çš„ç®¡é“ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¢«é‡å®šå‘åˆ° ChildProcess å¯¹è±¡ä¸Šç›¸åº”çš„ subprocess.stdinã€subprocess.stdout å’Œ subprocess.stderr æµã€‚ è¿™ç›¸å½“äºå°† options.stdio è®¾ç½®ä¸ºç­‰äº [&#39;pipe&#39;, &#39;pipe&#39;, &#39;pipe&#39;]ã€‚</p><p>ä¸ºæ–¹ä¾¿èµ·è§ï¼Œoptions.stdio å¯èƒ½æ˜¯ä»¥ä¸‹å­—ç¬¦ä¸²ä¹‹ä¸€ï¼š</p><p>å¦åˆ™ï¼Œoptions.stdio çš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ªç´¢å¼•å¯¹åº”äºå­è¿›ç¨‹ä¸­çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ æ–‡ä»¶æè¿°ç¬¦ 0ã€1 å’Œ 2 åˆ†åˆ«å¯¹åº”äºæ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ã€‚ å¯ä»¥æŒ‡å®šé¢å¤–çš„æ–‡ä»¶æè¿°ç¬¦ä»¥åœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´åˆ›å»ºé¢å¤–çš„ç®¡é“ã€‚ è¯¥å€¼æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š</p><div class="language-js"><pre><code><span class="token string">&#39;pipe&#39;</span>ï¼šåœ¨å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ä¹‹é—´åˆ›å»ºç®¡é“ã€‚ ç®¡é“çš„çˆ¶ç«¯ä½œä¸º subprocess<span class="token punctuation">.</span>stdio<span class="token punctuation">[</span>fd<span class="token punctuation">]</span> çš„ child_process å¯¹è±¡çš„å±æ€§æš´éœ²ç»™çˆ¶è¿›ç¨‹ã€‚ ä¸ºæ–‡ä»¶æè¿°ç¬¦ <span class="token number">0</span>ã€<span class="token number">1</span> å’Œ <span class="token number">2</span> åˆ›å»ºçš„ç®¡é“ä¹Ÿå¯åˆ†åˆ«ç”¨ä½œ subprocess<span class="token punctuation">.</span>stdinã€subprocess<span class="token punctuation">.</span>stdout å’Œ subprocess<span class="token punctuation">.</span>stderrã€‚ ç›®å‰ï¼Œè¿™äº›ä¸æ˜¯å®é™…çš„ Unix ç®¡é“ï¼Œå› æ­¤å­è¿›ç¨‹ä¸èƒ½é€šè¿‡å®ƒä»¬çš„æè¿°ç¬¦æ–‡ä»¶ä½¿ç”¨å®ƒä»¬ï¼Œä¾‹å¦‚ <span class="token operator">/</span>dev<span class="token operator">/</span>fd<span class="token operator">/</span><span class="token number">2</span> æˆ– <span class="token operator">/</span>dev<span class="token operator">/</span>stdoutã€‚

<span class="token string">&#39;overlapped&#39;</span>ï¼šä¸ <span class="token string">&#39;pipe&#39;</span> ç›¸åŒï¼Œåªæ˜¯åœ¨å¥æŸ„ä¸Šè®¾ç½®äº† <span class="token constant">FILE_FLAG_OVERLAPPED</span> æ ‡å¿—ã€‚ è¿™å¯¹äºå­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºå¥æŸ„ä¸Šçš„é‡å  <span class="token constant">I</span><span class="token operator">/</span><span class="token constant">O</span> æ˜¯å¿…éœ€çš„ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ–‡æ¡£ã€‚ è¿™ä¸é Windows ç³»ç»Ÿä¸Šçš„ <span class="token string">&#39;pipe&#39;</span> å®Œå…¨ç›¸åŒã€‚

<span class="token string">&#39;ipc&#39;</span>ï¼šåˆ›å»º <span class="token constant">IPC</span> é€šé“ï¼Œç”¨äºåœ¨çˆ¶å­è¿›ç¨‹ä¹‹é—´ä¼ é€’æ¶ˆæ¯<span class="token operator">/</span>æ–‡ä»¶æè¿°ç¬¦ã€‚ ä¸€ä¸ª ChildProcess æœ€å¤šå¯ä»¥æœ‰ä¸€ä¸ª <span class="token constant">IPC</span> æ ‡å‡†è¾“å…¥è¾“å‡ºæ–‡ä»¶æè¿°ç¬¦ã€‚ è®¾ç½®æ­¤é€‰é¡¹å°†å¯ç”¨ subprocess<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> æ–¹æ³•ã€‚ å¦‚æœå­è¿›ç¨‹æ˜¯ Node<span class="token punctuation">.</span>js è¿›ç¨‹ï¼Œåˆ™ <span class="token constant">IPC</span> é€šé“çš„å­˜åœ¨å°†å¯ç”¨ process<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å’Œ process<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> æ–¹æ³•ï¼Œä»¥åŠå­è¿›ç¨‹ä¸­çš„ <span class="token string">&#39;disconnect&#39;</span> å’Œ <span class="token string">&#39;message&#39;</span> äº‹ä»¶ã€‚

ä¸æ”¯æŒä»¥ process<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> ä»¥å¤–çš„ä»»ä½•æ–¹å¼è®¿é—® <span class="token constant">IPC</span> é€šé“æ–‡ä»¶æè¿°ç¬¦ã€æˆ–è€…å°† <span class="token constant">IPC</span> é€šé“ä¸é Node<span class="token punctuation">.</span>js å®ä¾‹çš„å­è¿›ç¨‹ä¸€èµ·ä½¿ç”¨ã€‚

<span class="token string">&#39;ignore&#39;</span>ï¼šæŒ‡ç¤º Node<span class="token punctuation">.</span>js å¿½ç•¥å­è¿›ç¨‹ä¸­çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ è™½ç„¶ Node<span class="token punctuation">.</span>js å°†å§‹ç»ˆä¸ºå…¶è¡ç”Ÿçš„è¿›ç¨‹æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦ <span class="token number">0</span>ã€<span class="token number">1</span> å’Œ <span class="token number">2</span>ï¼Œä½†å°†æ–‡ä»¶æè¿°ç¬¦è®¾ç½®ä¸º <span class="token string">&#39;ignore&#39;</span> å°†å¯¼è‡´ Node<span class="token punctuation">.</span>js æ‰“å¼€ <span class="token operator">/</span>dev<span class="token operator">/</span><span class="token keyword">null</span> å¹¶å°†å…¶é™„åŠ åˆ°å­è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦ã€‚

<span class="token string">&#39;inherit&#39;</span>ï¼šé€šè¿‡ç›¸åº”çš„æ ‡å‡†è¾“å…¥è¾“å‡ºæµä¼ å…¥<span class="token operator">/</span>ä¼ å‡ºçˆ¶è¿›ç¨‹ã€‚ åœ¨å‰ä¸‰ä¸ªä½ç½®ï¼Œè¿™åˆ†åˆ«ç›¸å½“äº process<span class="token punctuation">.</span>stdinã€process<span class="token punctuation">.</span>stdout å’Œ process<span class="token punctuation">.</span>stderrã€‚ åœ¨ä»»ä½•å…¶ä»–ä½ç½®ï¼Œç›¸å½“äº <span class="token string">&#39;ignore&#39;</span>ã€‚

<span class="token operator">&lt;</span>Stream<span class="token operator">&gt;</span> å¯¹è±¡ï¼šä¸å­è¿›ç¨‹å…±äº«å¼•ç”¨ç»ˆç«¯ã€æ–‡ä»¶ã€å¥—æ¥å­—æˆ–ç®¡é“çš„å¯è¯»æˆ–å¯å†™æµã€‚ æµçš„åº•å±‚æ–‡ä»¶æè¿°ç¬¦åœ¨å­è¿›ç¨‹ä¸­å¤åˆ¶åˆ°å¯¹åº”äº stdio æ•°ç»„ä¸­çš„ç´¢å¼•çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ æµå¿…é¡»æœ‰åº•å±‚æè¿°ç¬¦ï¼ˆæ–‡ä»¶æµåœ¨ <span class="token string">&#39;open&#39;</span> äº‹ä»¶å‘ç”Ÿä¹‹å‰æ²¡æœ‰ï¼‰ã€‚

æ­£æ•´æ•°ï¼šè¯¥æ•´æ•°å€¼è¢«è§£é‡Šä¸ºå½“å‰åœ¨çˆ¶è¿›ç¨‹ä¸­æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ å®ƒä¸å­è¿›ç¨‹å…±äº«ï¼Œç±»ä¼¼äºå…±äº« <span class="token operator">&lt;</span>Stream<span class="token operator">&gt;</span> å¯¹è±¡çš„æ–¹å¼ã€‚ Windows ä¸æ”¯æŒä¼ å…¥å¥—æ¥å­—ã€‚

<span class="token keyword">null</span>ã€<span class="token keyword">undefined</span>ï¼šä½¿ç”¨é»˜è®¤å€¼ã€‚ å¯¹äºæ ‡å‡†è¾“å…¥è¾“å‡ºæ–‡ä»¶æè¿°ç¬¦ <span class="token number">0</span>ã€<span class="token number">1</span> å’Œ <span class="token number">2</span>ï¼ˆæ¢å¥è¯è¯´ï¼Œæ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ï¼‰ï¼Œåˆ›å»ºç®¡é“ã€‚ å¯¹äºæ–‡ä»¶æè¿°ç¬¦ <span class="token number">3</span> åŠä»¥ä¸Šï¼Œé»˜è®¤å€¼ä¸º <span class="token string">&#39;ignore&#39;</span>ã€‚
</code></pre></div><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“çˆ¶å­è¿›ç¨‹ä¹‹é—´å»ºç«‹äº† IPC é€šé“ï¼Œå¹¶ä¸”å­è¿›ç¨‹æ˜¯ Node.js è¿›ç¨‹æ—¶ï¼Œåˆ™å­è¿›ç¨‹ä¼šåœ¨æœªå¼•ç”¨ IPC é€šé“çš„æƒ…å†µä¸‹å¯åŠ¨ï¼ˆä½¿ç”¨ unref() ï¼‰ï¼Œç›´åˆ°å­è¿›ç¨‹ä¸º &#39;disconnect&#39; äº‹ä»¶æˆ– &#39;message&#39; äº‹ä»¶æ³¨å†Œäº‹ä»¶å¥æŸ„ã€‚ è¿™å…è®¸å­è¿›ç¨‹æ­£å¸¸é€€å‡ºï¼Œè€Œè¿›ç¨‹ä¸ä¼šè¢«æ‰“å¼€çš„ IPC é€šé“ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚</p><p>åœ¨ç±» Unix æ“ä½œç³»ç»Ÿä¸Šï¼Œchild_process.spawn() æ–¹æ³•åœ¨å°†äº‹ä»¶å¾ªç¯ä¸å­è¿›ç¨‹åˆ†ç¦»ä¹‹å‰åŒæ­¥æ‰§è¡Œå†…å­˜æ“ä½œã€‚ å…·æœ‰å¤§é‡å†…å­˜å ç”¨çš„åº”ç”¨ç¨‹åºå¯èƒ½ä¼šå‘ç°é¢‘ç¹çš„ child_process.spawn() è°ƒç”¨æ˜¯ä¸€ä¸ªç“¶é¢ˆã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… V8 é—®é¢˜ 7381ã€‚</p><p>å¦è§ï¼šchild_process.exec() å’Œ child_process.fork()ã€‚</p><h2 id="å­ç±»childprocess-äº‹ä»¶" tabindex="-1">å­ç±»ChildProcess äº‹ä»¶</h2><p>ChildProcess çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¡ç”Ÿçš„å­è¿›ç¨‹ã€‚</p><p>ChildProcess çš„å®ä¾‹ä¸æ˜¯ç›´æ¥åˆ›å»ºçš„ã€‚ è€Œæ˜¯ï¼Œä½¿ç”¨ child_process.spawn()ã€child_process.exec()ã€child_process.execFile() æˆ– child_process.fork() æ–¹æ³•æ¥åˆ›å»º ChildProcess çš„å®ä¾‹ã€‚</p><h3 id="close" tabindex="-1">close</h3><div class="language-html"><pre><code>code <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> å¦‚æœå­è¿›ç¨‹è‡ªå·±é€€å‡ºï¼Œåˆ™ä¸ºé€€å‡ºç ã€‚
signal <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> ç»ˆæ­¢å­è¿›ç¨‹çš„ä¿¡å·ã€‚
</code></pre></div><p>åœ¨è¿›ç¨‹å·²ç»“æŸå¹¶ä¸”å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºæµå·²å…³é—­ä¹‹åï¼Œåˆ™è§¦å‘ &#39;close&#39; äº‹ä»¶ã€‚ è¿™ä¸ &#39;exit&#39; äº‹ä»¶ä¸åŒï¼Œå› ä¸ºå¤šä¸ªè¿›ç¨‹å¯èƒ½å…±äº«ç›¸åŒçš„æ ‡å‡†è¾“å…¥è¾“å‡ºæµã€‚ &#39;close&#39; äº‹ä»¶å°†å§‹ç»ˆåœ¨ &#39;exit&#39; æˆ– &#39;error&#39;ï¼ˆå¦‚æœå­è¿›ç¨‹è¡ç”Ÿå¤±è´¥ï¼‰å·²ç»è§¦å‘ä¹‹åè§¦å‘ã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ls <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">&#39;ls&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;-lh&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/usr&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ls<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stdout: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ls<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;close&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">child process close all stdio with code </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ls<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;exit&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">child process exited with code </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="disconnect" tabindex="-1">disconnect</h3><p>è°ƒç”¨çˆ¶è¿›ç¨‹ä¸­çš„ subprocess.<s>disconnect</s>() æ–¹æ³•æˆ–å­è¿›ç¨‹ä¸­çš„ process.disconnect() æ–¹æ³•åä¼šè§¦å‘ &#39;disconnect&#39; äº‹ä»¶ã€‚ æ–­å¼€è¿æ¥åå°±ä¸èƒ½å†å‘é€æˆ–æ¥æ”¶æ¶ˆæ¯ï¼Œä¸” subprocess.connected å±æ€§ä¸º falseã€‚</p><h3 id="error" tabindex="-1">error</h3><div class="language-html"><pre><code>err <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Error</span><span class="token punctuation">&gt;</span></span> é”™è¯¯ã€‚
</code></pre></div><p>&#39;error&#39; äº‹ä»¶åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è§¦å‘ï¼š</p><p>æ— æ³•è¡ç”Ÿè¯¥è¿›ç¨‹ï¼Œæˆ– è¿›ç¨‹æ— æ³•ç»ˆæ­¢ï¼Œæˆ– å‘å­è¿›ç¨‹å‘é€æ¶ˆæ¯å¤±è´¥ã€‚ å‘ç”Ÿé”™è¯¯åï¼Œ&#39;exit&#39; äº‹ä»¶å¯èƒ½ä¼šä¹Ÿå¯èƒ½ä¸ä¼šè§¦å‘ã€‚ åœ¨ç›‘å¬ &#39;exit&#39; å’Œ &#39;error&#39; äº‹ä»¶æ—¶ï¼Œé˜²æ­¢å¤šæ¬¡æ„å¤–è°ƒç”¨å¥æŸ„å‡½æ•°ã€‚</p><p>å¦è§ subprocess.kill() å’Œ subprocess.send()ã€‚</p><h3 id="exit" tabindex="-1">exit</h3><div class="language-html"><pre><code>code <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> å¦‚æœå­è¿›ç¨‹è‡ªå·±é€€å‡ºï¼Œåˆ™ä¸ºé€€å‡ºç ã€‚
signal <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> ç»ˆæ­¢å­è¿›ç¨‹çš„ä¿¡å·ã€‚
</code></pre></div><p>&#39;exit&#39; äº‹ä»¶åœ¨å­è¿›ç¨‹ç»“æŸåè§¦å‘ã€‚ å¦‚æœè¿›ç¨‹é€€å‡ºï¼Œåˆ™ code ä¸ºæœ€ç»ˆçš„è¿›ç¨‹é€€å‡ºç ï¼Œå¦åˆ™ä¸º nullã€‚ å¦‚æœè¿›ç¨‹å› æ”¶åˆ°ä¿¡å·è€Œç»ˆæ­¢ï¼Œåˆ™ signal æ˜¯ä¿¡å·çš„å­—ç¬¦ä¸²åç§°ï¼Œå¦åˆ™ä¸º nullã€‚ ä¸¤è€…ä¹‹ä¸€å°†å§‹ç»ˆæ˜¯é nullã€‚</p><p>å½“ &#39;exit&#39; äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œå­è¿›ç¨‹æ ‡å‡†è¾“å…¥è¾“å‡ºæµå¯èƒ½ä»å¤„äºæ‰“å¼€çŠ¶æ€ã€‚</p><p>Node.js ä¸º SIGINT å’Œ SIGTERM å»ºç«‹ä¿¡å·å¥æŸ„ï¼Œä¸” Node.js è¿›ç¨‹ä¸ä¼šå› ä¸ºæ”¶åˆ°è¿™äº›ä¿¡å·è€Œç«‹å³ç»ˆæ­¢ã€‚ è€Œæ˜¯ï¼ŒNode.js å°†æ‰§è¡Œä¸€ç³»åˆ—æ¸…ç†æ“ä½œï¼Œç„¶åé‡æ–°è§¦å‘å·²å¤„ç†çš„ä¿¡å·ã€‚</p><h3 id="message" tabindex="-1">message</h3><div class="language-html"><pre><code>message <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span> è§£æçš„ JSON å¯¹è±¡æˆ–åŸå§‹å€¼ã€‚
sendHandle <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Handle</span><span class="token punctuation">&gt;</span></span> net.Socket æˆ– net.Server å¯¹è±¡ã€æˆ–æœªå®šä¹‰ã€‚
</code></pre></div><p>å½“å­è¿›ç¨‹ä½¿ç”¨ process.send() å‘é€æ¶ˆæ¯æ—¶ï¼Œåˆ™è§¦å‘ &#39;message&#39; äº‹ä»¶ã€‚</p><p>æ¶ˆæ¯ç»è¿‡åºåˆ—åŒ–å’Œè§£æã€‚ ç»“æœæ¶ˆæ¯å¯èƒ½ä¸æœ€åˆå‘é€çš„æ¶ˆæ¯ä¸åŒã€‚</p><p>å¦‚æœåœ¨è¡ç”Ÿå­è¿›ç¨‹æ—¶å°† serialization é€‰é¡¹è®¾ç½®ä¸º &#39;advanced&#39;ï¼Œåˆ™ message å‚æ•°å¯ä»¥åŒ…å« JSON æ— æ³•è¡¨ç¤ºçš„æ•°æ®ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…é«˜çº§åºåˆ—åŒ–ã€‚</p><h3 id="spawn-2" tabindex="-1">spawn</h3><div class="language-html"><pre><code>ä¸€æ—¦å­è¿›ç¨‹è¡ç”ŸæˆåŠŸï¼Œåˆ™ä¼šè§¦å‘ &#39;spawn&#39; äº‹ä»¶ã€‚ å¦‚æœå­è¿›ç¨‹æ²¡æœ‰è¡ç”ŸæˆåŠŸï¼Œåˆ™ä¸ä¼šè§¦å‘ &#39;spawn&#39; äº‹ä»¶ï¼Œè€Œæ˜¯è§¦å‘ &#39;error&#39; äº‹ä»¶ã€‚

å¦‚æœè§¦å‘ï¼Œåˆ™ &#39;spawn&#39; äº‹ä»¶åœ¨æ‰€æœ‰å…¶ä»–äº‹ä»¶ä¹‹å‰ï¼Œä¸”åœ¨é€šè¿‡ stdout æˆ– stderr æ¥æ”¶ä»»ä½•æ•°æ®ä¹‹å‰ã€‚

æ— è®ºåœ¨è¡ç”Ÿçš„è¿›ç¨‹å†…æ˜¯å¦å‘ç”Ÿé”™è¯¯ï¼Œ&#39;spawn&#39; äº‹ä»¶éƒ½ä¼šè§¦å‘ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœ bash some-command è¡ç”ŸæˆåŠŸï¼Œåˆ™ &#39;spawn&#39; äº‹ä»¶å°†è§¦å‘ï¼Œå°½ç®¡ bash å¯èƒ½è¡ç”Ÿ some-command å¤±è´¥ã€‚ å½“ä½¿ç”¨ { shell: true } æ—¶ï¼Œæ­¤æ³¨æ„äº‹é¡¹ä¹Ÿé€‚ç”¨ã€‚
</code></pre></div><h2 id="å±æ€§" tabindex="-1">å±æ€§</h2><h3 id="subprocess-channel" tabindex="-1">subprocess.channel</h3><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span> ä»£è¡¨åˆ°å­è¿›ç¨‹çš„ IPC é€šé“çš„ç®¡é“
</code></pre></div><p>subprocess.channel å±æ€§æ˜¯å¯¹å­è¿›ç¨‹çš„ IPC é€šé“çš„å¼•ç”¨ã€‚ å¦‚æœå½“å‰ä¸å­˜åœ¨ IPC é€šé“ï¼Œåˆ™æ­¤å±æ€§ä¸º undefinedã€‚</p><h3 id="subprocess-channel-ref" tabindex="-1">subprocess.channel.ref()</h3><p>å¦‚æœä¹‹å‰å·²è°ƒç”¨è¿‡ .unref()ï¼Œåˆ™æ­¤æ–¹æ³•ä½¿ IPC é€šé“ä¿æŒçˆ¶è¿›ç¨‹çš„äº‹ä»¶å¾ªç¯è¿è¡Œã€‚</p><h3 id="subprocess-channel-unref" tabindex="-1">subprocess.channel.unref()</h3><p>æ­¤æ–¹æ³•ä½¿ IPC é€šé“ä¸ä¿æŒçˆ¶è¿›ç¨‹çš„äº‹ä»¶å¾ªç¯è¿è¡Œï¼Œå¹¶ä¸”å³ä½¿åœ¨é€šé“æ‰“å¼€æ—¶ä¹Ÿè®©å…¶ç»“æŸã€‚</p><h3 id="subprocess-connected" tabindex="-1">subprocess.connected</h3><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span> è°ƒç”¨ subprocess.disconnect() åè®¾ç½®ä¸º falseã€‚
</code></pre></div><p>subprocess.connected å±æ€§æŒ‡ç¤ºæ˜¯å¦ä»ç„¶å¯ä»¥ä»å­è¿›ç¨‹å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚ å½“ subprocess.connected ä¸º false æ—¶ï¼Œä¸å†å¯èƒ½å‘é€æˆ–æ¥æ”¶æ¶ˆæ¯ã€‚</p><h3 id="subprocess-disconnect" tabindex="-1">subprocess.disconnect()</h3><p>å…³é—­çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´çš„ IPC é€šé“ï¼Œä¸€æ—¦æ²¡æœ‰å…¶ä»–è¿æ¥ä½¿å…¶ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™å…è®¸å­è¿›ç¨‹æ­£å¸¸é€€å‡ºã€‚ è°ƒç”¨æ­¤æ–¹æ³•åï¼Œçˆ¶å­è¿›ç¨‹ä¸­çš„ subprocess.connected å’Œ process.connected å±æ€§ï¼ˆåˆ†åˆ«ï¼‰å°†è®¾ç½®ä¸º falseï¼Œè¿›ç¨‹ä¹‹é—´å°†æ— æ³•å†ä¼ é€’æ¶ˆæ¯ã€‚</p><p>å½“æ¥æ”¶è¿‡ç¨‹ä¸­æ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œå°†è§¦å‘ &#39;disconnect&#39; äº‹ä»¶ã€‚ è¿™é€šå¸¸ä¼šåœ¨è°ƒç”¨ subprocess.disconnect() åç«‹å³è§¦å‘ã€‚</p><p>å½“å­è¿›ç¨‹æ˜¯ Node.js å®ä¾‹ï¼ˆä¾‹å¦‚ä½¿ç”¨ child_process.fork() è¡ç”Ÿï¼‰æ—¶ï¼Œåˆ™å¯ä»¥åœ¨å­è¿›ç¨‹ä¸­è°ƒç”¨ process.disconnect() æ–¹æ³•æ¥å…³é—­ IPC é€šé“ã€‚</p><h3 id="subprocess-exitcode" tabindex="-1">subprocess.exitCode</h3><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>integer</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>subprocess.exitCode å±æ€§è¡¨ç¤ºå­è¿›ç¨‹çš„é€€å‡ºç ã€‚ å¦‚æœå­è¿›ç¨‹ä»åœ¨è¿è¡Œï¼Œåˆ™è¯¥å­—æ®µå°†ä¸º nullã€‚</p><h3 id="subprocess-kill-signal" tabindex="-1">subprocess.kill([signal])</h3><div class="language-html"><pre><code>signal <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>
è¿”å›: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>subprocess.kill() æ–¹æ³•å‘å­è¿›ç¨‹å‘é€ä¿¡å·ã€‚ å¦‚æœæ²¡æœ‰ç»™å®šå‚æ•°ï¼Œåˆ™è¿›ç¨‹å°†è¢«å‘é€ &#39;SIGTERM&#39; ä¿¡å·ã€‚ æœ‰å…³å¯ç”¨ä¿¡å·çš„åˆ—è¡¨ï¼Œè¯·å‚é˜… signal(7)ã€‚ å¦‚æœ kill(2) æˆåŠŸï¼Œåˆ™æ­¤å‡½æ•°è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> grep <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">&#39;grep&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;ssh&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

grep<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;close&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> signal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">child process terminated due to receipt of signal </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>signal<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å‘é€ SIGHUP åˆ°è¿›ç¨‹ã€‚</span>
grep<span class="token punctuation">.</span><span class="token function">kill</span><span class="token punctuation">(</span><span class="token string">&#39;SIGHUP&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å¦‚æœä¿¡å·æ— æ³•ä¼ è¾¾ï¼Œåˆ™ ChildProcess å¯¹è±¡å¯èƒ½ä¼šè§¦å‘ &#39;error&#39; äº‹ä»¶ã€‚ å‘å·²ç»é€€å‡ºçš„å­è¿›ç¨‹å‘é€ä¿¡å·ä¸æ˜¯é”™è¯¯ï¼Œä½†å¯èƒ½ä¼šäº§ç”Ÿä¸å¯é¢„è§çš„ç»“æœã€‚ å…·ä½“æ¥è¯´ï¼Œå¦‚æœè¿›ç¨‹æ ‡è¯†ç¬¦ (PID) å·²é‡æ–°åˆ†é…ç»™å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œåˆ™ä¿¡å·å°†ä¼ ç»™è¯¥è¿›ç¨‹ï¼Œè€Œè¿™å¯èƒ½ä¼šäº§ç”Ÿæ„å¤–ç»“æœã€‚</p><p>è™½ç„¶è¯¥å‡½æ•°è¢«ç§°ä¸º killï¼Œä½†ä¼ ç»™å­è¿›ç¨‹çš„ä¿¡å·å®é™…ä¸Šå¯èƒ½ä¸ä¼šç»ˆæ­¢è¯¥è¿›ç¨‹ã€‚</p><p>è¯·å‚é˜… kill(2) ä»¥ä¾›å‚è€ƒã€‚</p><p>åœ¨ä¸å­˜åœ¨ POSIX ä¿¡å·çš„ Windows ä¸Šï¼Œsignal å‚æ•°å°†è¢«å¿½ç•¥ï¼Œå¹¶ä¸”è¿›ç¨‹å°†è¢«å¼ºåˆ¶ä¸”çªç„¶åœ°ç»ˆæ­¢ï¼ˆç±»ä¼¼äº &#39;SIGKILL&#39;ï¼‰ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ä¿¡å·äº‹ä»¶ã€‚</p><p>åœ¨ Linux ä¸Šï¼Œå­è¿›ç¨‹çš„å­è¿›ç¨‹åœ¨è¯•å›¾æ€æ­»å…¶çˆ¶è¿›ç¨‹æ—¶ä¸ä¼šè¢«ç»ˆæ­¢ã€‚ å½“åœ¨ shell ä¸­è¿è¡Œæ–°è¿›ç¨‹æˆ–ä½¿ç”¨ ChildProcess çš„ shell é€‰é¡¹æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼š</p><div class="language-js"><pre><code><span class="token string">&#39;use strict&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> subprocess <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span>
  <span class="token string">&#39;sh&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>
    <span class="token string">&#39;-c&#39;</span><span class="token punctuation">,</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">node -e &quot;setInterval(() =&gt; {
      console.log(process.pid, &#39;is alive&#39;)
    }, 500);&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;inherit&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;inherit&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;inherit&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  subprocess<span class="token punctuation">.</span><span class="token function">kill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸ä¼šç»ˆæ­¢ shell ä¸­çš„ Node.js è¿›ç¨‹ã€‚</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="subprocess-killed" tabindex="-1">subprocess.killed</h3><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span> ä½¿ç”¨ subprocess.kill() æˆåŠŸå‘é€ä¿¡å·ç»™å­è¿›ç¨‹åè®¾ç½®ä¸º trueã€‚
</code></pre></div><p>subprocess.killed å±æ€§æŒ‡ç¤ºå­è¿›ç¨‹æ˜¯å¦æˆåŠŸæ¥æ”¶åˆ°æ¥è‡ª subprocess.kill() çš„ä¿¡å·ã€‚ killed å±æ€§å¹¶ä¸è¡¨ç¤ºå­è¿›ç¨‹å·²ç»ˆæ­¢ã€‚</p><h3 id="subprocess-pid" tabindex="-1">subprocess.pid</h3><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>integer</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>undefined</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>è¿”å›å­è¿›ç¨‹çš„è¿›ç¨‹æ ‡è¯†ç¬¦ (PID)ã€‚ å¦‚æœå­è¿›ç¨‹ç”±äºé”™è¯¯è€Œæ— æ³•è¡ç”Ÿï¼Œåˆ™è¯¥å€¼ä¸º undefined å¹¶è§¦å‘ errorã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> grep <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">&#39;grep&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;ssh&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Spawned child pid: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>grep<span class="token punctuation">.</span>pid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
grep<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="subprocess-ref" tabindex="-1">subprocess.ref()</h3><p>åœ¨è°ƒç”¨ subprocess.unref() åè°ƒç”¨ subprocess.ref() å°†ä¸ºå­è¿›ç¨‹æ¢å¤åˆ é™¤çš„å¼•ç”¨è®¡æ•°ï¼Œè¿«ä½¿çˆ¶è¿›ç¨‹åœ¨é€€å‡ºä¹‹å‰ç­‰å¾…å­è¿›ç¨‹é€€å‡ºã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> subprocess <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;child_program.js&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">detached</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">&#39;ignore&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

subprocess<span class="token punctuation">.</span><span class="token function">unref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
subprocess<span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="subprocess-send-message-sendhandle-options-callback" tabindex="-1">subprocess.send(message[, sendHandle[, options]][, callback])</h3><div class="language-html"><pre><code>message <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span>
sendHandle <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Handle</span><span class="token punctuation">&gt;</span></span>
options <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Object</span><span class="token punctuation">&gt;</span></span> options å‚æ•°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰æ˜¯ç”¨äºå‚æ•°åŒ–æŸäº›ç±»å‹å¥æŸ„çš„å‘é€çš„å¯¹è±¡ã€‚ options æ”¯æŒä»¥ä¸‹å±æ€§ï¼š
keepOpen <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span> å½“ä¼ å…¥ net.Socket å®ä¾‹æ—¶å¯ä»¥ä½¿ç”¨çš„å€¼ã€‚ å½“ä¸º true æ—¶ï¼Œå¥—æ¥å­—åœ¨å‘é€è¿‡ç¨‹ä¸­ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚ é»˜è®¤å€¼: falseã€‚
callback <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Function</span><span class="token punctuation">&gt;</span></span>
è¿”å›: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>å½“çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´å»ºç«‹äº† IPC é€šé“æ—¶ï¼ˆå³å½“ä½¿ç”¨ child_process.fork() æ—¶ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ subprocess.send() æ–¹æ³•å‘å­è¿›ç¨‹å‘é€æ¶ˆæ¯ã€‚ å½“å­è¿›ç¨‹æ˜¯ Node.js å®ä¾‹æ—¶ï¼Œå¯ä»¥é€šè¿‡ &#39;message&#39; äº‹ä»¶æ¥æ”¶è¿™äº›æ¶ˆæ¯ã€‚</p><p>æ¶ˆæ¯ç»è¿‡åºåˆ—åŒ–å’Œè§£æã€‚ ç»“æœæ¶ˆæ¯å¯èƒ½ä¸æœ€åˆå‘é€çš„æ¶ˆæ¯ä¸åŒã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨çˆ¶è¿›ç¨‹è„šæœ¬ä¸­ï¼š</p><div class="language-js"><pre><code><span class="token keyword">const</span> cp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> n <span class="token operator">=</span> cp<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/sub.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

n<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;message&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;PARENT got message:&#39;</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å¼•èµ·å­è¿›ç¨‹æ‰“å°ï¼šCHILD got message: { hello: &#39;world&#39; }</span>
n<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">hello</span><span class="token operator">:</span> <span class="token string">&#39;world&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ç„¶åå­è¿›ç¨‹è„šæœ¬ &#39;sub.js&#39; å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-js"><pre><code>process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;message&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;CHILD got message:&#39;</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å¼•èµ·çˆ¶è¿›ç¨‹æ‰“å°ï¼šPARENT got message: { foo: &#39;bar&#39;, baz: null }</span>
process<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">&#39;bar&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">baz</span><span class="token operator">:</span> <span class="token number">NaN</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å­ Node.js è¿›ç¨‹å°†æ‹¥æœ‰è‡ªå·±çš„ process.send() æ–¹æ³•ï¼Œå…è®¸å­è¿›ç¨‹å°†æ¶ˆæ¯å‘é€å›çˆ¶è¿›ç¨‹ã€‚</p><p>å½“å‘é€ {cmd: &#39;NODE_foo&#39;} æ¶ˆæ¯æ—¶æ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚ åœ¨ cmd å±æ€§ä¸­åŒ…å« NODE_ å‰ç¼€çš„æ¶ˆæ¯æ˜¯ Node.js æ ¸å¿ƒé¢„ç•™ä½¿ç”¨çš„ï¼Œä¸ä¼šåœ¨å­è¿›ç¨‹çš„ &#39;message&#39; äº‹ä»¶ä¸­è§¦å‘ã€‚ è€Œæ˜¯ï¼Œæ­¤ç±»æ¶ˆæ¯ä½¿ç”¨ &#39;internalMessage&#39; äº‹ä»¶è§¦å‘ï¼Œå¹¶ç”± Node.js åœ¨å†…éƒ¨ä½¿ç”¨ã€‚ åº”ç”¨ç¨‹åºåº”é¿å…ä½¿ç”¨æ­¤ç±»æ¶ˆæ¯æˆ–ç›‘å¬ &#39;internalMessage&#39; äº‹ä»¶ï¼Œå› ä¸ºå®ƒå¯èƒ½éšæ—¶æ›´æ”¹ï¼Œæ•ä¸å¦è¡Œé€šçŸ¥ã€‚</p><p>å¯ä»¥ä¼ ç»™ subprocess.send() çš„å¯é€‰ sendHandle å‚æ•°ç”¨äºå°† TCP æœåŠ¡å™¨æˆ–å¥—æ¥å­—å¯¹è±¡ä¼ ç»™å­è¿›ç¨‹ã€‚ å­è¿›ç¨‹å°†æ¥æ”¶è¯¥å¯¹è±¡ä½œä¸ºä¼ ç»™åœ¨ &#39;message&#39; äº‹ä»¶ä¸Šæ³¨å†Œçš„å›è°ƒå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚ åœ¨å¥—æ¥å­—ä¸­æ¥æ”¶å’Œç¼“å†²çš„ä»»ä½•æ•°æ®éƒ½ä¸ä¼šå‘é€ç»™å­è¿›ç¨‹ã€‚</p><p>å¯é€‰çš„ callback å‡½æ•°å°†åœ¨æ¶ˆæ¯å‘é€ä¹‹åä½†åœ¨å­è¿›ç¨‹å¯èƒ½æ¥æ”¶åˆ°å®ƒä¹‹å‰è°ƒç”¨ã€‚ è¯¥å‡½æ•°ä½¿ç”¨å•ä¸ªå‚æ•°è°ƒç”¨ï¼šæˆåŠŸæ—¶ä¸º nullï¼Œå¤±è´¥æ—¶ä¸º Error å¯¹è±¡ã€‚</p><p>å¦‚æœæ²¡æœ‰æä¾› callback å‡½æ•°ä¸”æ— æ³•å‘é€æ¶ˆæ¯ï¼Œåˆ™ ChildProcess å¯¹è±¡å°†è§¦å‘ &#39;error&#39; äº‹ä»¶ã€‚ ä¾‹å¦‚ï¼Œå½“å­è¿›ç¨‹å·²ç»é€€å‡ºæ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚</p><p>å¦‚æœé€šé“å·²å…³é—­æˆ–æœªå‘é€æ¶ˆæ¯çš„ç§¯å‹è¶…è¿‡é˜ˆå€¼ï¼ˆè¿™ä½¿å¾—å‘é€æ›´å¤šæ¶ˆæ¯æ˜¯ä¸æ˜æ™ºçš„ï¼‰ï¼Œåˆ™ subprocess.send() å°†è¿”å› falseã€‚ å¦åˆ™ï¼Œè¯¥æ–¹æ³•è¿”å› trueã€‚ callback å‡½æ•°å¯ç”¨äºå®ç°æµé‡æ§åˆ¶</p><p>ç¤ºä¾‹ï¼šå‘é€æœåŠ¡å™¨å¯¹è±¡</p><div class="language-js"><pre><code>ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ sendHandle å‚æ•°å°† <span class="token constant">TCP</span> æœåŠ¡å™¨å¯¹è±¡çš„å¥æŸ„ä¼ ç»™å­è¿›ç¨‹ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š

<span class="token keyword">const</span> subprocess <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token string">&#39;subprocess.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ‰“å¼€æœåŠ¡å™¨å¯¹è±¡å¹¶å‘é€å¥æŸ„ã€‚</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:net&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;connection&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
socket<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;handled by parent&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
subprocess<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;server&#39;</span><span class="token punctuation">,</span> server<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ç„¶åå­è¿›ç¨‹å°†æ”¶åˆ°æœåŠ¡å™¨å¯¹è±¡ï¼š

process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;message&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> server</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>m <span class="token operator">===</span> <span class="token string">&#39;server&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;connection&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
socket<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;handled by child&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ä¸€æ—¦æœåŠ¡å™¨ç°åœ¨åœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´å…±äº«ï¼Œåˆ™ä¸€äº›è¿æ¥å¯ä»¥ç”±çˆ¶è¿›ç¨‹å¤„ç†ï¼Œä¸€äº›è¿æ¥ç”±å­è¿›ç¨‹å¤„ç†ã€‚
è™½ç„¶ä¸Šé¢çš„ç¤ºä¾‹ä½¿ç”¨ä½¿ç”¨ node<span class="token operator">:</span>net æ¨¡å—åˆ›å»ºçš„æœåŠ¡å™¨ï¼Œä½† node<span class="token operator">:</span>dgram æ¨¡å—æœåŠ¡å™¨ä½¿ç”¨å®Œå…¨ç›¸åŒçš„å·¥ä½œæµç¨‹ï¼Œ
é™¤äº†ç›‘å¬ <span class="token string">&#39;message&#39;</span> äº‹ä»¶è€Œä¸æ˜¯ <span class="token string">&#39;connection&#39;</span> å’Œä½¿ç”¨ <span class="token function">server</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> è€Œä¸æ˜¯ server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ã€‚ 
ä½†æ˜¯ï¼Œç›®å‰ä»…åœ¨ Unix å¹³å°ä¸Šæ”¯æŒã€‚
</code></pre></div><p>ç¤ºä¾‹ï¼šå‘é€å¥—æ¥å­—å¯¹è±¡</p><p>åŒæ ·ï¼ŒsendHandler å‚æ•°å¯ç”¨äºå°†å¥—æ¥å­—çš„å¥æŸ„ä¼ ç»™å­è¿›ç¨‹ã€‚ ä¸‹é¢çš„ä¾‹å­äº§ç”Ÿäº†ä¸¤ä¸ªå­è¿›ç¨‹ï¼Œæ¯ä¸ªå­è¿›ç¨‹éƒ½å¤„ç†å…·æœ‰â€œnormalâ€æˆ–â€œspecialâ€ä¼˜å…ˆçº§çš„è¿æ¥ï¼š</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> fork <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> normal <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token string">&#39;subprocess.js&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;normal&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> special <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token string">&#39;subprocess.js&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;special&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ‰“å¼€æœåŠ¡å™¨å¹¶å°†å¥—æ¥å­—å‘é€ç»™å­è¿›ç¨‹ã€‚</span>
<span class="token comment">// ä½¿ç”¨ pauseOnConnect é˜²æ­¢å¥—æ¥å­—åœ¨å‘é€åˆ°å­è¿›ç¨‹ä¹‹å‰è¢«è¯»å–ã€‚</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:net&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">pauseOnConnect</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;connection&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// å¦‚æœè¿™æ˜¯ special ä¼˜å…ˆçº§...</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>socket<span class="token punctuation">.</span>remoteAddress <span class="token operator">===</span> <span class="token string">&#39;74.125.127.100&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        special<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;socket&#39;</span><span class="token punctuation">,</span> socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è¿™æ˜¯ normal ä¼˜å…ˆçº§ã€‚</span>
    normal<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;socket&#39;</span><span class="token punctuation">,</span> socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>subprocess.js å°†æ¥æ”¶å¥—æ¥å­—å¥æŸ„ä½œä¸ºä¼ ç»™äº‹ä»¶å›è°ƒå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼š</p><div class="language-js"><pre><code>process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;message&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>m <span class="token operator">===</span> <span class="token string">&#39;socket&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>socket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ£€æŸ¥å®¢æˆ·ç«¯å¥—æ¥å­—æ˜¯å¦å­˜åœ¨ã€‚</span>
      <span class="token comment">// å¥—æ¥å­—å¯èƒ½ä¼šåœ¨å‘é€å’Œåœ¨å­è¿›ç¨‹ä¸­æ¥æ”¶åˆ°å®ƒä¹‹é—´å…³é—­ã€‚</span>
      socket<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Request handled with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> priority</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä¸è¦åœ¨å·²ä¼ ç»™å­è¿›ç¨‹çš„å¥—æ¥å­—ä¸Šä½¿ç”¨ .maxConnectionsã€‚ çˆ¶è¿›ç¨‹æ— æ³•è·Ÿè¸ªå¥—æ¥å­—ä½•æ—¶è¢«é”€æ¯ã€‚</p><p>å­è¿›ç¨‹ä¸­çš„ä»»ä½• &#39;message&#39; å¥æŸ„éƒ½åº”éªŒè¯ socket æ˜¯å¦å­˜åœ¨ï¼Œå› ä¸ºåœ¨å°†è¿æ¥å‘é€åˆ°å­è¿›ç¨‹æ‰€éœ€çš„æ—¶é—´å†…ï¼Œè¿æ¥å¯èƒ½å·²å…³é—­ã€‚</p><h3 id="subprocess-signalcode" tabindex="-1">subprocess.signalCode</h3><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span> | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>null</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>subprocess.signalCode å±æ€§è¡¨ç¤ºå­è¿›ç¨‹æ¥æ”¶åˆ°çš„ä¿¡å·ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œå¦åˆ™ä¸º nullã€‚</p><h3 id="subprocess-spawnargs" tabindex="-1">subprocess.spawnargs</h3><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Array</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>subprocess.spawnargs å±æ€§è¡¨ç¤ºå­è¿›ç¨‹å¯åŠ¨æ—¶ä½¿ç”¨çš„å‘½ä»¤è¡Œå‚æ•°çš„å®Œæ•´åˆ—è¡¨ã€‚</p><h3 id="subprocess-spawnfile" tabindex="-1">subprocess.spawnfile</h3><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>subprocess.spawnfile å±æ€§è¡¨ç¤ºå¯åŠ¨çš„å­è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶åã€‚</p><p>å¯¹äº child_process.fork()ï¼Œå…¶å€¼å°†ç­‰äº process.execPathã€‚ å¯¹äº child_process.spawn()ï¼Œå®ƒçš„å€¼å°†æ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°ã€‚ å¯¹äº child_process.exec()ï¼Œå®ƒçš„å€¼å°†æ˜¯å¯åŠ¨å­è¿›ç¨‹çš„ shell çš„åç§°ã€‚</p><h3 id="subprocess-stderr" tabindex="-1">subprocess.stderr</h3><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stream.Readable</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>ä»£è¡¨å­è¿›ç¨‹çš„ stderr çš„ Readable Streamã€‚</p><p>å¦‚æœå­è¿›ç¨‹è¡ç”Ÿæ—¶ stdio[2] è®¾ç½®ä¸º &#39;pipe&#39; ä»¥å¤–çš„ä»»ä½•å€¼ï¼Œåˆ™æ­¤å°†æ˜¯ nullã€‚</p><p>subprocess.stderr æ˜¯ subprocess.stdio[2] çš„åˆ«åã€‚ è¿™ä¸¤ä¸ªå±æ€§å°†å¼•ç”¨ç›¸åŒçš„å€¼ã€‚</p><p>å¦‚æœæ— æ³•æˆåŠŸè¡ç”Ÿå­è¿›ç¨‹ï¼Œåˆ™ subprocess.stderr å±æ€§å¯èƒ½æ˜¯ nullã€‚</p><h3 id="subprocess-stdin" tabindex="-1">subprocess.stdin</h3><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stream.Writable</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>ä»£è¡¨å­è¿›ç¨‹çš„ stdin çš„ Writable Streamã€‚</p><p>å¦‚æœå­è¿›ç¨‹ç­‰å¾…è¯»å–å…¶æ‰€æœ‰è¾“å…¥ï¼Œåˆ™åœ¨é€šè¿‡ end() å…³é—­æ­¤æµä¹‹å‰ï¼Œå­è¿›ç¨‹å°†ä¸ä¼šç»§ç»­ã€‚</p><p>å¦‚æœå­è¿›ç¨‹è¡ç”Ÿæ—¶ stdio[0] è®¾ç½®ä¸º &#39;pipe&#39; ä»¥å¤–çš„ä»»ä½•å€¼ï¼Œåˆ™æ­¤å°†æ˜¯ nullã€‚</p><p>subprocess.stdin æ˜¯ subprocess.stdio[0] çš„åˆ«åã€‚ è¿™ä¸¤ä¸ªå±æ€§å°†å¼•ç”¨ç›¸åŒçš„å€¼ã€‚</p><p>å¦‚æœæ— æ³•æˆåŠŸè¡ç”Ÿå­è¿›ç¨‹ï¼Œåˆ™ subprocess.stdin å±æ€§å¯èƒ½æ˜¯ undefinedã€‚</p><h3 id="subprocess-stdout" tabindex="-1">subprocess.stdout</h3><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stream.Readable</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>ä»£è¡¨å­è¿›ç¨‹çš„ stdout çš„ Readable Streamã€‚</p><p>å¦‚æœå­è¿›ç¨‹è¡ç”Ÿæ—¶ stdio[1] è®¾ç½®ä¸º &#39;pipe&#39; ä»¥å¤–çš„ä»»ä½•å€¼ï¼Œåˆ™æ­¤å°†æ˜¯ nullã€‚</p><p>subprocess.stdout æ˜¯ subprocess.stdio[1] çš„åˆ«åã€‚ è¿™ä¸¤ä¸ªå±æ€§å°†å¼•ç”¨ç›¸åŒçš„å€¼ã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> subprocess <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">&#39;ls&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

subprocess<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Received chunk </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="subprocess-stdio" tabindex="-1">subprocess.stdio</h3><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Array</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>åˆ°å­è¿›ç¨‹çš„ç¨€ç–ç®¡é“æ•°ç»„ï¼Œå¯¹åº”äºä¼ ç»™ child_process.spawn() çš„ stdio é€‰é¡¹ä¸­çš„ä½ç½®ï¼Œè¿™äº›ä½ç½®å·²è®¾ç½®ä¸ºå€¼ &#39;pipe&#39;ã€‚ subprocess.stdio[0]ã€subprocess.stdio[1] å’Œ subprocess.stdio[2] ä¹Ÿå¯åˆ†åˆ«ç”¨ä½œ subprocess.stdinã€subprocess.stdout å’Œ subprocess.stderrã€‚</p><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œåªæœ‰å­è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦ 1 (æ ‡å‡†è¾“å‡º) è¢«é…ç½®ä¸ºç®¡é“ï¼Œæ‰€ä»¥åªæœ‰è¿›ç¨‹çš„ subprocess.stdio[1] æ˜¯æµï¼Œæ•°ç»„ä¸­çš„æ‰€æœ‰å…¶ä»–å€¼éƒ½æ˜¯ nullã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> assert <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:assert&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> child_process <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> subprocess <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">&#39;ls&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// ä¸ºå­è¿›ç¨‹ä½¿ç”¨çˆ¶è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥ã€‚</span>
    <span class="token string">&#39;pipe&#39;</span><span class="token punctuation">,</span> <span class="token comment">// ç®¡é“å­è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºåˆ°çˆ¶è¿›ç¨‹ã€‚</span>
    fs<span class="token punctuation">.</span><span class="token function">openSync</span><span class="token punctuation">(</span><span class="token string">&#39;err.out&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;w&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å°†å­è¿›ç¨‹çš„æ ‡å‡†é”™è¯¯å®šå‘åˆ°æ–‡ä»¶ã€‚</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

assert<span class="token punctuation">.</span><span class="token function">strictEqual</span><span class="token punctuation">(</span>subprocess<span class="token punctuation">.</span>stdio<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">strictEqual</span><span class="token punctuation">(</span>subprocess<span class="token punctuation">.</span>stdio<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> subprocess<span class="token punctuation">.</span>stdin<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assert</span><span class="token punctuation">(</span>subprocess<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">strictEqual</span><span class="token punctuation">(</span>subprocess<span class="token punctuation">.</span>stdio<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> subprocess<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>

assert<span class="token punctuation">.</span><span class="token function">strictEqual</span><span class="token punctuation">(</span>subprocess<span class="token punctuation">.</span>stdio<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">strictEqual</span><span class="token punctuation">(</span>subprocess<span class="token punctuation">.</span>stdio<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> subprocess<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å¦‚æœæ— æ³•æˆåŠŸè¡ç”Ÿå­è¿›ç¨‹ï¼Œåˆ™ subprocess.stdio å±æ€§å¯èƒ½æ˜¯ undefinedã€‚</p><h3 id="subprocess-unref" tabindex="-1">subprocess.unref()</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œçˆ¶è¿›ç¨‹å°†ç­‰å¾…åˆ†ç¦»çš„å­è¿›ç¨‹é€€å‡ºã€‚ ä¸ºäº†é˜²æ­¢çˆ¶è¿›ç¨‹ç­‰å¾…ç»™å®šçš„ subprocess é€€å‡ºï¼Œåˆ™ä½¿ç”¨ subprocess.unref() æ–¹æ³•ã€‚ è¿™æ ·åšä¼šä½¿çˆ¶è¿›ç¨‹çš„äº‹ä»¶å¾ªç¯ä¸å°†å­è¿›ç¨‹åŒ…æ‹¬åœ¨å…¶å¼•ç”¨è®¡æ•°ä¸­ï¼Œä»è€Œå…è®¸çˆ¶è¿›ç¨‹ç‹¬ç«‹äºå­è¿›ç¨‹é€€å‡ºï¼Œé™¤éåœ¨å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ä¹‹é—´å»ºç«‹äº† IPC é€šé“ã€‚</p><div class="language-html"><pre><code>const { spawn } = require(&#39;node:child_process&#39;);

const subprocess = spawn(process.argv[0], [&#39;child_program.js&#39;], {
  detached: true,
  stdio: &#39;ignore&#39;
});

subprocess.unref();
</code></pre></div><h2 id="maxbuffer-å’Œ-unicode" tabindex="-1">maxBuffer å’Œ Unicode</h2><p>maxBuffer é€‰é¡¹æŒ‡å®š stdout æˆ– stderr ä¸Šå…è®¸çš„æœ€å¤§å­—èŠ‚æ•°ã€‚ å¦‚æœè¶…è¿‡æ­¤å€¼ï¼Œåˆ™ç»ˆæ­¢å­è¿›ç¨‹ã€‚ è¿™ä¼šå½±å“åŒ…å«å¤šå­—èŠ‚å­—ç¬¦ç¼–ç ï¼ˆä¾‹å¦‚ UTF-8 æˆ– UTF-16ï¼‰çš„è¾“å‡ºã€‚ ä¾‹å¦‚ï¼Œconsole.log(&#39;ä¸­æ–‡æµ‹è¯•&#39;) å°†å‘ stdout å‘é€ 13 ä¸ª UTF-8 ç¼–ç å­—èŠ‚ï¼Œå°½ç®¡åªæœ‰ 4 ä¸ªå­—ç¬¦ã€‚</p><h2 id="shell-çš„è¦æ±‚" tabindex="-1">shell çš„è¦æ±‚</h2><p>shell åº”è¯¥ç†è§£ -c å¼€å…³ã€‚ å¦‚æœ shell æ˜¯ &#39;cmd.exe&#39;ï¼Œåˆ™åº”è¯¥ç†è§£ /d /s /c å¼€å…³ï¼Œå¹¶ä¸”å‘½ä»¤è¡Œè§£æåº”è¯¥æ˜¯å…¼å®¹çš„ã€‚</p><h2 id="é»˜è®¤çš„-windows-shell" tabindex="-1">é»˜è®¤çš„ Windows shell</h2><p>å°½ç®¡å¾®è½¯æŒ‡å®š %COMSPEC% å¿…é¡»åŒ…å«æ ¹ç¯å¢ƒä¸­åˆ° &#39;cmd.exe&#39; çš„è·¯å¾„ï¼Œä½†å­è¿›ç¨‹å¹¶ä¸æ€»æ˜¯å—åˆ°ç›¸åŒçš„è¦æ±‚ã€‚ å› æ­¤ï¼Œåœ¨å¯ä»¥è¡ç”Ÿ shell çš„ child_process å‡½æ•°ä¸­ï¼Œå¦‚æœ process.<wbr>env.ComSpec ä¸å¯ç”¨ï¼Œåˆ™ä½¿ç”¨ &#39;cmd.exe&#39; ä½œä¸ºåå¤‡ã€‚</p><h2 id="é«˜çº§åºåˆ—åŒ–" tabindex="-1">é«˜çº§åºåˆ—åŒ–</h2><p>æ–°å¢äº: v13.2.0, v12.16.0 å­è¿›ç¨‹æ”¯æŒ IPC çš„åºåˆ—åŒ–æœºåˆ¶ï¼Œè¯¥æœºåˆ¶åŸºäº node:v8 æ¨¡å—çš„åºåˆ—åŒ– APIï¼ŒåŸºäº HTML ç»“æ„åŒ–å…‹éš†ç®—æ³•ã€‚ è¿™é€šå¸¸åŠŸèƒ½æ›´å¼ºå¤§ï¼Œæ”¯æŒæ›´å¤šå†…ç½®çš„ JavaScript å¯¹è±¡ç±»å‹ï¼Œä¾‹å¦‚ BigIntã€Map å’Œ Setã€ArrayBuffer å’Œ TypedArrayã€Bufferã€Errorã€RegExp ç­‰ã€‚</p></div></div><footer class="page-footer" data-v-f058c2ee data-v-4d1950e8><div class="edit" data-v-4d1950e8><div class="edit-link" data-v-4d1950e8 data-v-d1f281aa><!----></div></div><div class="updated" data-v-4d1950e8><p class="last-updated" data-v-4d1950e8 data-v-01ad1c9a><span class="prefix" data-v-01ad1c9a>æœ€è¿‘æ›´æ–°æ—¶é—´:</span><span class="datetime" data-v-01ad1c9a></span></p></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"ideshortcutkey_webstorm.md\":\"8f6817f3\",\"about_index.md\":\"01b235a8\",\"client_electron_base.md\":\"79df7dbc\",\"client_electron_index.md\":\"626b9be5\",\"client_typescript_index.md\":\"fb41d36d\",\"client_css_æ»šåŠ¨æ¡.md\":\"293d8e70\",\"client_javascript_xmlhttprequest.md\":\"8aadba5c\",\"client_javascript_base.md\":\"23ef7cf5\",\"client_javascript_index.md\":\"a84c3537\",\"client_javascript_å‡½æ•°.md\":\"db68be79\",\"concat_index.md\":\"877691c0\",\"environmentconstruction_index.md\":\"f872815c\",\"environmentconstruction_kafka.md\":\"62641f4a\",\"environmentconstruction_linux.md\":\"b63089ba\",\"environmentconstruction_mongodbç¦»çº¿å®‰è£….md\":\"362c75fb\",\"environmentconstruction_mysqlç¦»çº¿å®‰è£….md\":\"36f9c57e\",\"environmentconstruction_nginx.md\":\"076c612d\",\"environmentconstruction_redisç¦»çº¿å®‰è£….md\":\"6cdb72f1\",\"home_home.md\":\"0d8ff9a7\",\"index.md\":\"8182c745\",\"interest_drug_index.md\":\"6c1a7ee1\",\"interest_music_index.md\":\"47304e7a\",\"npmpackage_index.md\":\"f6c8e56a\",\"npmpackage_log4js.md\":\"4621b71e\",\"qdcz-note.md\":\"4bb643cc\",\"service_linux_index.md\":\"17e0561e\",\"service_linux_linux.md\":\"02aaa70a\",\"service_linux_å­˜å‚¨å•ä½.md\":\"9ea95410\",\"service_mongodb_base.md\":\"64b48fa5\",\"service_mongodb_index.md\":\"267683f8\",\"service_mongodb_å»ºç«‹ttlç´¢å¼•.md\":\"cae116bc\",\"service_nginx_index.md\":\"b4f22df6\",\"service_nginx_windowç‰ˆæœ¬.md\":\"8162a141\",\"service_nodejs_base.md\":\"4b7a0cf0\",\"service_nodejs_buffer.md\":\"f8a8df62\",\"service_nodejs_child_process.md\":\"83fa6bbd\",\"service_nodejs_index.md\":\"e8394bda\",\"service_nodejs_nodeåˆ†äº«è¯¾1.md\":\"8a7b3ccf\",\"service_nodejs_process.md\":\"5f87cb8c\",\"service_nodejs_stream.md\":\"4c11cbc7\",\"service_nodejs_å·¥å…·å‡½æ•°.md\":\"4ecf2ddb\",\"service_nodejs_æ–‡ä»¶æè¿°ç¬¦.md\":\"21025e3e\",\"service_nodejs_æ—¥å¿—ç³»ç»Ÿè®°å½•.md\":\"4cfc8540\",\"service_nodejs_æ··æ·†ç¼–è¯‘æ‰“åŒ….md\":\"b82165fa\",\"service_nodejs_é”.md\":\"3c2a6e16\",\"service_go_study_1.md\":\"647566a6\",\"service_go_study_index.md\":\"43335d9f\",\"service_kafka_index.md\":\"81e7af6c\",\"service_koa_index.md\":\"2a7dc9bc\",\"service_koa_æ´‹è‘±æ¨¡å‹.md\":\"8391d839\",\"softwareengineering_é¢å‘å¯¹è±¡ç¼–ç¨‹.md\":\"f600078e\",\"temporary_index.md\":\"2cb121ec\",\"temporary_recentplan.md\":\"16f06e40\",\"temporary_websocketforauthbynodejs.md\":\"8a5df03e\",\"temporary_work_day_work_report.md\":\"8afaa7de\",\"temporary_work_todayplan.md\":\"a8386dff\",\"temporary_work_weekly_work_report.md\":\"0d5de338\",\"windowsystem_cmdå‘½ä»¤.md\":\"8c4c3596\",\"windowsystem_index.md\":\"7c834cb9\",\"windowsystem_openssl.md\":\"8256351a\",\"windowsystem_åˆ›å»ºæœ¬åœ°å…±äº«æ–‡ä»¶å¤¹.md\":\"f8fede8b\"}")</script>
    <script type="module" async src="/assets/app.71728ad2.js"></script>
    
  </body>
</html>