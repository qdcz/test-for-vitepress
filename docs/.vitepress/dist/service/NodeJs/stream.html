<!DOCTYPE html>
<html lang="en-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Stream | æ¾œæ¼¾</title>
    <meta name="description" content="å¹¿å¤©ä¸‹ä¹‹å¹¿,æ·±å¤©ä¸‹ä¹‹æ·±">
    <link rel="stylesheet" href="/assets/style.49f07aca.css">
    <link rel="modulepreload" href="/assets/Home.b9b6273f.js">
    <link rel="modulepreload" href="/assets/app.1760f824.js">
    <link rel="modulepreload" href="/assets/service_NodeJs_stream.md.4c62e57a.lean.js">
    
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <meta name="keywords" content="æ¾œæ¼¾">
  <link rel="icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://lib.baomitu.com/gitalk/1.7.0/gitalk.min.css">
  <script src="https://lib.baomitu.com/gitalk/1.7.0/gitalk.min.js"></script>
  <script src="https://lib.baomitu.com/axios/0.21.1/axios.js"></script>
  <meta name="twitter:title" content="Stream | æ¾œæ¼¾">
  <meta property="og:title" content="Stream | æ¾œæ¼¾">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-d186b2c2><div class="sidebar-button" data-v-d186b2c2><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="æ¾œæ¼¾, back to home" data-v-d186b2c2 data-v-34a93bc8><img class="logo" src="/logo2.jpg" alt="Logo" data-v-34a93bc8> æ¾œæ¼¾</a><div class="flex-grow" data-v-d186b2c2></div><div class="nav" data-v-d186b2c2><nav class="nav-links" data-v-d186b2c2 data-v-30b7e073><!--[--><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/" data-v-711da5ba>ğŸ  é¦–é¡µ <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/home/home" data-v-711da5ba>ç ä¸Šè¡ŒåŠ¨ <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/IDEShortcutKey/WebStorm" data-v-711da5ba>ç¼–è¾‘å™¨å¿«æ·é”® <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/environmentConstruction/index" data-v-711da5ba>ç¯å¢ƒæ­å»º <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/windowSystem/index" data-v-711da5ba>windowSkills <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/service/Linux/index" data-v-711da5ba>linuxSkills <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/about/index" data-v-711da5ba>ğŸ”¨å…³äº <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/concat/index" data-v-711da5ba>ğŸ‘«å‹æƒ…é“¾æ¥ <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/temporary/index" data-v-711da5ba>ä¸´æ—¶å­˜å‚¨ <!----></a></div></div><!--]--><!----><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item isExternal" href="https://github.com/qdcz" target="_blank" rel="noopener noreferrer" data-v-711da5ba>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-711da5ba><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-7e9d9da8><nav class="nav-links nav" data-v-7e9d9da8 data-v-30b7e073><!--[--><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/" data-v-711da5ba>ğŸ  é¦–é¡µ <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/home/home" data-v-711da5ba>ç ä¸Šè¡ŒåŠ¨ <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/IDEShortcutKey/WebStorm" data-v-711da5ba>ç¼–è¾‘å™¨å¿«æ·é”® <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/environmentConstruction/index" data-v-711da5ba>ç¯å¢ƒæ­å»º <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/windowSystem/index" data-v-711da5ba>windowSkills <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/service/Linux/index" data-v-711da5ba>linuxSkills <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/about/index" data-v-711da5ba>ğŸ”¨å…³äº <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/concat/index" data-v-711da5ba>ğŸ‘«å‹æƒ…é“¾æ¥ <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/temporary/index" data-v-711da5ba>ä¸´æ—¶å­˜å‚¨ <!----></a></div></div><!--]--><!----><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item isExternal" href="https://github.com/qdcz" target="_blank" rel="noopener noreferrer" data-v-711da5ba>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-711da5ba><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-7e9d9da8><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#æ¦‚å¿µ">æ¦‚å¿µ</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å¯¹è±¡æ¨¡å¼">å¯¹è±¡æ¨¡å¼</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ç¼“å†²">ç¼“å†²</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å¯å†™æµ-writable">å¯å†™æµ(writable)</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#åˆ›å»ºå¯å†™æµ">åˆ›å»ºå¯å†™æµ</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ç¤ºä¾‹">ç¤ºä¾‹</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#äº‹ä»¶">äº‹ä»¶</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#æ–¹æ³•">æ–¹æ³•</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å±æ€§">å±æ€§</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å¯è¯»æµ-readable">å¯è¯»æµ(readable)</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#ä¸¤ç§è¯»å–æ¨¡å¼">ä¸¤ç§è¯»å–æ¨¡å¼</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ä¸‰ç§çŠ¶æ€">ä¸‰ç§çŠ¶æ€</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#é€‰æ‹©ä¸€ç§æ¥å£é£æ ¼">é€‰æ‹©ä¸€ç§æ¥å£é£æ ¼</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#åˆ›å»ºå¯è¯»æµ">åˆ›å»ºå¯è¯»æµ</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ç¤ºä¾‹-1">ç¤ºä¾‹</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#äº‹ä»¶-1">äº‹ä»¶</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#æ–¹æ³•-1">æ–¹æ³•</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å±æ€§-1">å±æ€§</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#åŒå·¥æµ">åŒå·¥æµ()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#è½¬åŒ–æµ">è½¬åŒ–æµ</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#é™„è¡¨1">é™„è¡¨1</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å‹èƒŒ-backpressure">å‹èƒŒ( Backpressure)</a><!----></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-f058c2ee><div class="container" data-v-f058c2ee><!--[--><!--]--><div style="position:relative;" class="content" data-v-f058c2ee><div><h1 id="stream" tabindex="-1">Stream</h1><h2 id="æ¦‚å¿µ" tabindex="-1">æ¦‚å¿µ</h2><p>æµ(Stream) æ˜¯åœ¨ node.js ä¸­å¤„ç†æ•°æ®æµçš„æŠ½è±¡æ¥å£</p><p>Node.js ä¸­æœ‰å››ç§åŸºæœ¬çš„æµç±»å‹ï¼š</p><ul><li><p><a href="http://nodejs.cn/api/stream.html#class-streamwritable" target="_blank" rel="noopener noreferrer"><code>Writable</code></a>: å¯ä»¥å†™å…¥æ•°æ®çš„æµï¼ˆä¾‹å¦‚ï¼Œ<a href="http://nodejs.cn/api/fs.html#fscreatewritestreampath-options" target="_blank" rel="noopener noreferrer"><code>fs.createWriteStream()</code></a>ï¼‰ã€‚</p></li><li><p><a href="http://nodejs.cn/api/stream.html#class-streamreadable" target="_blank" rel="noopener noreferrer"><code>Readable</code></a>: å¯ä»¥ä»ä¸­è¯»å–æ•°æ®çš„æµï¼ˆä¾‹å¦‚ï¼Œ<a href="http://nodejs.cn/api/fs.html#fscreatereadstreampath-options" target="_blank" rel="noopener noreferrer"><code>fs.createReadStream()</code></a>ï¼‰ã€‚</p></li><li><p><a href="http://nodejs.cn/api/stream.html#class-streamduplex" target="_blank" rel="noopener noreferrer"><code>Duplex</code></a>: <code>Readable</code> å’Œ <code>Writable</code> çš„æµï¼ˆåŒå·¥æµï¼‰ï¼ˆä¾‹å¦‚ï¼Œ<a href="http://nodejs.cn/api/net.html#class-netsocket" target="_blank" rel="noopener noreferrer"><code>net.Socket</code></a>ï¼‰ã€‚</p></li><li><p><a href="http://nodejs.cn/api/stream.html#class-streamtransform" target="_blank" rel="noopener noreferrer"><code>Transform</code></a>: å¯ä»¥åœ¨å†™å…¥å’Œè¯»å–æ•°æ®æ—¶ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®çš„ <code>Duplex</code> æµï¼ˆä¾‹å¦‚ï¼Œ<a href="http://nodejs.cn/api/zlib.html#zlibcreatedeflateoptions" target="_blank" rel="noopener noreferrer"><code>zlib.createDeflate()</code></a>ï¼‰ã€‚</p><p>è½¬æ¢æµæ˜¯åŸºäºåŒå‘æµçš„ï¼Œå¯ä»¥åœ¨è¯»æˆ–è€…å†™çš„æ—¶å€™è¢«ç”¨æ¥æ›´æ”¹æˆ–è€…è½¬æ¢æ•°æ®ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ zlib.createGzip ä½¿ç”¨ gzip ç®—æ³•å‹ç¼©æ•°æ®ã€‚ä½ å¯ä»¥å°†è½¬æ¢æµæƒ³è±¡æˆä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„è¾“å…¥æ˜¯å¯å†™æµï¼Œè¾“å‡ºæ˜¯å¯è¯»æµã€‚ä½ æˆ–è®¸ä¹Ÿå¬è¿‡å°†è½¬æ¢æµæˆä¸ºâ€œé€šè¿‡æµï¼ˆthrough streamsï¼‰â€ã€‚</p></li></ul><h2 id="å¯¹è±¡æ¨¡å¼" tabindex="-1">å¯¹è±¡æ¨¡å¼</h2><p>Node.js API åˆ›å»ºçš„æ‰€æœ‰æµéƒ½åªå¯¹å­—ç¬¦ä¸²å’Œ <code>Buffer</code>ï¼ˆæˆ– <code>Uint8Array</code>ï¼‰å¯¹è±¡è¿›è¡Œæ“ä½œ ï¼Œ</p><p>æµçš„å®ä¾‹åœ¨åˆ›å»ºæµæ—¶ä½¿ç”¨ <code>objectMode</code> é€‰é¡¹åˆ‡æ¢åˆ°å¯¹è±¡æ¨¡å¼ã€‚ å°è¯•å°†ç°æœ‰çš„æµåˆ‡æ¢åˆ°å¯¹è±¡æ¨¡å¼æ˜¯ä¸å®‰å…¨çš„ã€‚</p><h2 id="ç¼“å†²" tabindex="-1">ç¼“å†²</h2><p><a href="http://nodejs.cn/api/stream.html#class-streamwritable" target="_blank" rel="noopener noreferrer"><code>Writable</code></a> å’Œ <a href="http://nodejs.cn/api/stream.html#class-streamreadable" target="_blank" rel="noopener noreferrer"><code>Readable</code></a> æµéƒ½å°†æ•°æ®å­˜å‚¨åœ¨å†…éƒ¨ç¼“å†²åŒºä¸­ ï¼Œç¼“å†²çš„æ•°é‡å–å†³äºæµçš„æ„é€ å‡½æ•°çš„highWaterMarké€‰é¡¹ã€‚</p><p>å¯¹äºæ™®é€šæµï¼š <code>highWaterMark</code> ç”¨äºæŒ‡å®šå­—èŠ‚çš„æ€»æ•°</p><p>å¯¹äºå¯¹è±¡æ¨¡å¼ï¼š <code>highWaterMark</code> ç”¨äºæŒ‡å®šå¯¹è±¡çš„æ€»æ•°</p><blockquote><p>å½“å®ç°è°ƒç”¨ <a href="http://nodejs.cn/api/stream.html#readablepushchunk-encoding" target="_blank" rel="noopener noreferrer"><code>stream.push(chunk)</code></a> æ—¶ï¼Œæ•°æ®ç¼“å­˜åœ¨ <code>Readable</code> æµä¸­ã€‚ å¦‚æœæµçš„æ¶ˆè´¹è€…æ²¡æœ‰è°ƒç”¨ <a href="http://nodejs.cn/api/stream.html#readablereadsize" target="_blank" rel="noopener noreferrer"><code>stream.read()</code></a>ï¼Œåˆ™æ•°æ®ä¼šä¸€ç›´é©»ç•™åœ¨å†…éƒ¨é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°è¢«æ¶ˆè´¹ã€‚</p></blockquote><h2 id="å¯å†™æµ-writable" tabindex="-1">å¯å†™æµ(writable)</h2><p>å¯å†™æµæ˜¯ æ•°æ®å†™å…¥ç›®æ ‡çš„æŠ½è±¡</p><p>å¸¸è§çš„å¯å†™æµæœ‰ï¼š</p><ul><li>å®¢æˆ·ç«¯ä¸Šhttpè¯·æ±‚ã€</li><li>æœåŠ¡å™¨ä¸Šçš„httpå“åº”ã€</li><li>æ–‡ä»¶ç³»ç»Ÿå†™å…¥æµã€</li><li>å‹ç¼©æµã€åŠ å¯†æµã€</li><li>TCPå¥—æ¥å­—ã€</li><li>å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥ã€</li><li>process.stdoutã€</li><li>process.stderr</li></ul><h3 id="åˆ›å»ºå¯å†™æµ" tabindex="-1">åˆ›å»ºå¯å†™æµ</h3><p><strong>createWriteStream</strong>:æ˜¯fsæ¨¡å—çš„ä¸€ä¸ªapiï¼Œå‚æ•°å¦‚ä¸‹ï¼š</p><div class="language-js"><pre><code>fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span>

path <span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token operator">&lt;</span>Buffer<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token constant">URL</span><span class="token operator">&gt;</span>
options <span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token operator">&lt;</span>Object<span class="token operator">&gt;</span>
    start <span class="token operator">&lt;</span>integer<span class="token operator">&gt;</span>
    flags <span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> é»˜è®¤å€¼<span class="token operator">:</span> <span class="token string">&#39;w&#39;</span>ã€‚  è¯¦è§ä¸‹ é™„è¡¨<span class="token number">1</span>
    encoding <span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> é»˜è®¤å€¼<span class="token operator">:</span> <span class="token string">&#39;utf8&#39;</span>
    fd <span class="token operator">&lt;</span>integer<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token operator">&lt;</span>FileHandle<span class="token operator">&gt;</span> é»˜è®¤å€¼<span class="token operator">:</span> <span class="token keyword">null</span>
    mode <span class="token operator">&lt;</span>integer<span class="token operator">&gt;</span> é»˜è®¤å€¼<span class="token operator">:</span> <span class="token number">0o666</span>
    autoClose <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span> é»˜è®¤å€¼<span class="token operator">:</span> <span class="token boolean">true</span>
    emitClose <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span> é»˜è®¤å€¼<span class="token operator">:</span> <span class="token boolean">true</span>
    
    fs <span class="token operator">&lt;</span>Object<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span> é»˜è®¤å€¼<span class="token operator">:</span> <span class="token keyword">null</span>
</code></pre></div><ul><li><p>pathä¸€èˆ¬ä½¿ç”¨è·¯å¾„</p></li><li><p>start é€‰é¡¹ï¼Œä»¥å…è®¸åœ¨æ–‡ä»¶å¼€å¤´çš„æŸä¸ªä½ç½®å†™å…¥æ•°æ®ï¼Œå…è®¸çš„å€¼åœ¨ [0, Number.MAX_SAFE_INTEGER] èŒƒå›´å†…ã€‚ ä¿®æ”¹æ–‡ä»¶è€Œä¸æ˜¯æ›¿æ¢å®ƒå¯èƒ½éœ€è¦å°† flags é€‰é¡¹è®¾ç½®ä¸º r+ è€Œä¸æ˜¯é»˜è®¤çš„ wã€‚ encoding å¯ä»¥æ˜¯ Bufferæ¥å—çš„ä»»ä½•ä¸€ç§ã€‚</p></li><li><p>autoClose è®¾ç½®ä¸º trueï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ï¼Œåˆ™åœ¨ &#39;error&#39; æˆ– &#39;finish&#39; æ—¶æ–‡ä»¶æè¿°ç¬¦å°†è‡ªåŠ¨å…³é—­ã€‚ å¦‚æœ autoClose ä¸º falseï¼Œåˆ™å³ä½¿å‡ºç°é”™è¯¯ï¼Œæ–‡ä»¶æè¿°ç¬¦ä¹Ÿä¸ä¼šå…³é—­ã€‚ å…³é—­å®ƒå¹¶ç¡®ä¿æ²¡æœ‰æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ˜¯åº”ç”¨ç¨‹åºçš„è´£ä»»ã€‚</p></li><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæµå°†åœ¨é”€æ¯åè§¦å‘ &#39;close&#39; äº‹ä»¶ã€‚ å°† emitClose é€‰é¡¹è®¾ç½®ä¸º false ä»¥æ›´æ”¹æ­¤è¡Œä¸ºã€‚</p></li><li><p>é€šè¿‡æä¾› fs é€‰é¡¹ï¼Œå¯ä»¥è¦†ç›– openã€writeã€writev å’Œ close çš„ç›¸åº” fs å®ç°ã€‚ åœ¨æ²¡æœ‰ writev() çš„æƒ…å†µä¸‹è¦†ç›– write() ä¼šé™ä½æ€§èƒ½ï¼Œå› ä¸ºæŸäº›ä¼˜åŒ– (_writev()) å°†è¢«ç¦ç”¨ã€‚ å½“æä¾›äº† fs é€‰é¡¹æ—¶ï¼Œåˆ™è‡³å°‘éœ€è¦è¦†ç›– write å’Œ writev ä¹‹ä¸€ã€‚ å¦‚æœæ²¡æœ‰æä¾› fd é€‰é¡¹ï¼Œåˆ™è¿˜éœ€è¦è¦†ç›– openã€‚ å¦‚æœ autoClose æ˜¯ trueï¼Œåˆ™è¿˜éœ€è¦è¦†ç›– closeã€‚</p></li><li><p>ä¸ &lt;fs.ReadStream&gt; ä¸€æ ·ï¼Œå¦‚æœæŒ‡å®šäº† fdï¼Œåˆ™ &lt;fs.WriteStream&gt; å°†å¿½ç•¥ path å‚æ•°å¹¶ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ã€‚ è¿™æ„å‘³ç€ä¸ä¼šè§¦å‘ &#39;open&#39; äº‹ä»¶ã€‚ fd åº”è¯¥æ˜¯é˜»å¡çš„ï¼›éé˜»å¡ fd åº”è¯¥ä¼ ç»™ &lt;net.Socket&gt;ã€‚</p></li></ul><h3 id="ç¤ºä¾‹" tabindex="-1">ç¤ºä¾‹</h3><div class="language-js"><pre><code><span class="token keyword">let</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> txt <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">&quot;./è¿™æ˜¯ä¸€ä¸ªå¯å†™æµåˆ›å»ºçš„æ–‡ä»¶.txt&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">flags</span><span class="token operator">:</span><span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">encoding</span><span class="token operator">:</span><span class="token string">&quot;utf8&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

txt<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;è¿™æ˜¯ä¸€ä¸²ä½¿ç”¨ utf8 ç¼–ç å†™å…¥çš„æ–‡æœ¬æ•°æ®&quot;</span><span class="token punctuation">,</span><span class="token string">&#39;UTF8&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// æ ‡è®°æ–‡ä»¶æœ«å°¾</span>
txt<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

txt<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;finish&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å†™å…¥å®Œæˆã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

txt<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œå®Œæ­¤è„šæœ¬  åœ¨å½“å‰ç›®å½•ä¸‹ä¼šåˆ›å»ºä¸€ä¸ª   è¿™æ˜¯ä¸€ä¸ªå¯å†™æµåˆ›å»ºçš„æ–‡ä»¶.txt  çš„æ–‡ä»¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="äº‹ä»¶" tabindex="-1">äº‹ä»¶</h3><p>å¯¹äº<code>writable</code> ç±»å®ƒæ‹¥æœ‰è¯¸å¤šäº‹ä»¶</p><h4 id="close-äº‹ä»¶" tabindex="-1"><strong>close</strong> äº‹ä»¶</h4><p>å†™å…¥æµè¢«å…³é—­æ—¶è§¦å‘</p><h4 id="drain-äº‹ä»¶" tabindex="-1">**drain **äº‹ä»¶</h4><p>å¦‚æœå¯¹ stream.write(chunk) çš„è°ƒç”¨è¿”å› falseï¼Œåˆ™ &#39;drain&#39; äº‹ä»¶å°†åœ¨é€‚åˆç»§ç»­å°†æ•°æ®å†™å…¥æµæ—¶è§¦å‘ã€‚</p><div class="language-js"><pre><code><span class="token comment">// å°†æ•°æ®å†™å…¥æä¾›çš„å¯å†™æµä¸€ç™¾ä¸‡æ¬¡ã€‚</span>
<span class="token comment">// æ³¨æ„èƒŒå‹ã€‚</span>
<span class="token keyword">function</span> <span class="token function">writeOneMillionTimes</span><span class="token punctuation">(</span><span class="token parameter">writer<span class="token punctuation">,</span> data<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>
  <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ok <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
      i<span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æœ€åä¸€æ¬¡ï¼</span>
        writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// çœ‹çœ‹æ˜¯åº”è¯¥ç»§ç»­ï¼Œè¿˜æ˜¯ç­‰å¾…ã€‚</span>
        <span class="token comment">// ä¸è¦ä¼ å…¥å›è°ƒï¼Œå› ä¸ºè¿˜æ²¡æœ‰å®Œæˆã€‚</span>
        ok <span class="token operator">=</span> writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> encoding<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¿…é¡»æ—©ç‚¹åœä¸‹æ¥ï¼</span>
      <span class="token comment">// ç­‰å®ƒæ’ç©ºæ—¶å†å†™ä¸€äº›ã€‚</span>
      writer<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&#39;drain&#39;</span><span class="token punctuation">,</span> write<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="error-äº‹ä»¶" tabindex="-1"><strong>error</strong> äº‹ä»¶</h4><p>å†™å…¥æˆ–ç®¡é“æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯è§¦å‘ï¼Œ</p><p>é™¤éåœ¨åˆ›å»ºæµæ—¶å°† <a href="http://nodejs.cn/api/stream.html#new-streamwritableoptions" target="_blank" rel="noopener noreferrer"><code>autoDestroy</code></a> é€‰é¡¹è®¾ç½®ä¸º <code>false</code>ï¼Œå¦åˆ™å½“è§¦å‘ <code>&#39;error&#39;</code> äº‹ä»¶æ—¶å°†å…³é—­æµã€‚</p><p>åœ¨ <code>&#39;error&#39;</code> ä¹‹åï¼Œä¸åº”è§¦å‘é™¤ <code>&#39;close&#39;</code> ä¹‹å¤–çš„å…¶ä»–äº‹ä»¶ï¼ˆåŒ…æ‹¬ <code>&#39;error&#39;</code> äº‹ä»¶ï¼‰ã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Writable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;node:stream&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Writable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fooErr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;foo error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myStream<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>fooErr<span class="token punctuation">)</span><span class="token punctuation">;</span>
myStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">fooErr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>fooErr<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo error</span>
</code></pre></div><h4 id="finish-äº‹ä»¶" tabindex="-1">**finish **äº‹ä»¶</h4><p>è°ƒç”¨writable.end()åï¼Œå¹¶ä¸”æ‰€æœ‰æ•°æ®éƒ½å·²åˆ·æ–°åˆ°åº•å±‚ç³»ç»Ÿè§¦å‘</p><h4 id="pipe-äº‹ä»¶" tabindex="-1">**pipe **äº‹ä»¶</h4><p>å½“åœ¨å¯è¯»æµä¸Šè°ƒç”¨ <a href="http://nodejs.cn/api/stream.html#readablepipedestination-options" target="_blank" rel="noopener noreferrer"><code>stream.pipe()</code></a> æ–¹æ³•å°†æ­¤å¯å†™æµæ·»åŠ åˆ°å…¶ç›®æ ‡é›†æ—¶ï¼Œåˆ™è§¦å‘ <code>&#39;pipe&#39;</code> äº‹ä»¶ã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> writer <span class="token operator">=</span> <span class="token function">getWritableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token function">getReadableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
writer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;pipe&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Something is piping into the writer.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> reader<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="unpipe-äº‹ä»¶" tabindex="-1"><strong>unpipe</strong> äº‹ä»¶</h4><p><code>src</code>å–æ¶ˆç®¡é“æ­¤å¯å†™æµçš„æºæµ</p><p>å½“åœ¨ <a href="http://nodejs.cn/api/stream.html#class-streamreadable" target="_blank" rel="noopener noreferrer"><code>Readable</code></a> æµä¸Šè°ƒç”¨ <a href="http://nodejs.cn/api/stream.html#readableunpipedestination" target="_blank" rel="noopener noreferrer"><code>stream.unpipe()</code></a> æ–¹æ³•æ—¶ï¼Œåˆ™ä¼šè§¦å‘ <code>&#39;unpipe&#39;</code> äº‹ä»¶ï¼Œä»å…¶ç›®æ ‡é›†åˆä¸­åˆ é™¤æ­¤ <a href="http://nodejs.cn/api/stream.html#class-streamwritable" target="_blank" rel="noopener noreferrer"><code>Writable</code></a>ã€‚</p><p>å½“ <a href="http://nodejs.cn/api/stream.html#class-streamreadable" target="_blank" rel="noopener noreferrer"><code>Readable</code></a> æµç®¡é“è¿›å…¥å®ƒæ—¶ï¼Œå¦‚æœæ­¤ <a href="http://nodejs.cn/api/stream.html#class-streamwritable" target="_blank" rel="noopener noreferrer"><code>Writable</code></a> æµè§¦å‘é”™è¯¯ï¼Œåˆ™è¿™ä¹Ÿä¼šè§¦å‘ã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> writer <span class="token operator">=</span> <span class="token function">getWritableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token function">getReadableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
writer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;unpipe&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Something has stopped piping into the writer.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> reader<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function">unpipe</span><span class="token punctuation">(</span>writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="æ–¹æ³•" tabindex="-1">æ–¹æ³•</h3><p>å¯¹äº<code>writable</code> ç±»å®ƒä¹Ÿæœ‰æ‹¥æœ‰è¯¸å¤šæ–¹æ³•</p><h4 id="writable-cork" tabindex="-1"><strong>writable.cork()</strong></h4><p><code>writable.cork()</code> æ–¹æ³•å¼ºåˆ¶æ‰€æœ‰å†™å…¥çš„æ•°æ®éƒ½ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚ å½“è°ƒç”¨ <a href="http://nodejs.cn/api/stream.html#writableuncork" target="_blank" rel="noopener noreferrer"><code>stream.uncork()</code></a> æˆ– <a href="http://nodejs.cn/api/stream.html#writableendchunk-encoding-callback" target="_blank" rel="noopener noreferrer"><code>stream.end()</code></a> æ–¹æ³•æ—¶ï¼Œç¼“å†²çš„æ•°æ®å°†è¢«åˆ·æ–°ã€‚</p><p><code>writable.cork()</code> çš„ä¸»è¦ç›®çš„æ˜¯é€‚åº”å°†å‡ ä¸ªå°å—å¿«é€Ÿè¿ç»­å†™å…¥æµçš„æƒ…å†µã€‚ <code>writable.cork()</code> ä¸æ˜¯ç«‹å³å°†å®ƒä»¬è½¬å‘åˆ°åº•å±‚ç›®æ ‡ï¼Œè€Œæ˜¯ç¼“å†²æ‰€æœ‰å—ï¼Œç›´åˆ° <code>writable.uncork()</code> è¢«è°ƒç”¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œ<code>writable.uncork()</code> ä¼šå°†å®ƒä»¬å…¨éƒ¨ä¼ ç»™ <code>writable._writev()</code>ã€‚ è¿™å¯ä»¥é˜²æ­¢åœ¨ç­‰å¾…å¤„ç†ç¬¬ä¸€ä¸ªå°å—æ—¶æ­£åœ¨ç¼“å†²æ•°æ®çš„è¡Œå¤´é˜»å¡æƒ…å†µã€‚ ä½†æ˜¯ï¼Œåœ¨ä¸å®ç° <code>writable._writev()</code> çš„æƒ…å†µä¸‹ä½¿ç”¨ <code>writable.cork()</code> å¯èƒ½ä¼šå¯¹ååé‡äº§ç”Ÿä¸åˆ©å½±å“ã€‚</p><h4 id="writable-destroy" tabindex="-1"><strong>writable.destroy()</strong></h4><p>é”€æ¯æµ å¯é€‰åœ°è§¦å‘ <code>&#39;error&#39;</code> äº‹ä»¶ï¼Œå¹¶ä¸”è§¦å‘ <code>&#39;close&#39;</code> äº‹ä»¶ï¼ˆé™¤é <code>emitClose</code> è®¾ç½®ä¸º <code>false</code>ï¼‰ã€‚ åœ¨æ­¤è°ƒç”¨ä¹‹åï¼Œåˆ™å¯å†™æµå·²ç»“æŸï¼Œéšåå¯¹ <code>write()</code> æˆ– <code>end()</code> çš„è°ƒç”¨å°†å¯¼è‡´ <code>ERR_STREAM_DESTROYED</code> é”™è¯¯ã€‚ è¿™æ˜¯é”€æ¯æµçš„ç ´åæ€§å’Œç›´æ¥çš„æ–¹å¼ã€‚ å…ˆå‰å¯¹ <code>write()</code> çš„è°ƒç”¨å¯èƒ½æ²¡æœ‰æ’ç©ºï¼Œå¹¶ä¸”å¯èƒ½è§¦å‘ <code>ERR_STREAM_DESTROYED</code> é”™è¯¯ã€‚ å¦‚æœæ•°æ®åº”è¯¥åœ¨å…³é—­ä¹‹å‰åˆ·æ–°ï¼Œæˆ–è€…åœ¨é”€æ¯æµä¹‹å‰ç­‰å¾… <code>&#39;drain&#39;</code> äº‹ä»¶ï¼Œåˆ™ä½¿ç”¨ <code>end()</code> è€Œä¸æ˜¯é”€æ¯ã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Writable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;stream&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> myStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Writable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fooErr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;foo error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myStream<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>fooErr<span class="token punctuation">)</span><span class="token punctuation">;</span>
myStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">fooErr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>fooErr<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo error</span>
</code></pre></div><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Writable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;stream&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Writable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myStream<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">wontHappen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Writable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;stream&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Writable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myStream<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ERR_STREAM_DESTROYED</span>
</code></pre></div><h4 id="writable-end" tabindex="-1"><strong>writable. end()</strong></h4><p>è°ƒç”¨ writable.end() æ–¹æ³•è¡¨ç¤ºä¸å†æœ‰æ•°æ®å†™å…¥ Writable</p><div class="language-js"><pre><code><span class="token comment">// è¯­æ³•ï¼š</span>
writable<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">[</span>chunk<span class="token punctuation">[</span><span class="token punctuation">,</span> encoding<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span> callback<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token literal-property property">chunk</span><span class="token operator">:</span>å¯é€‰çš„è¦å†™å…¥çš„æ•°æ®ã€‚ å¯¹äºä¸åœ¨å¯¹è±¡æ¨¡å¼ä¸‹æ“ä½œçš„æµï¼Œchunk å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€Buffer æˆ– Uint8Arrayã€‚ å¯¹äºå¯¹è±¡æ¨¡å¼çš„æµï¼Œchunk å¯ä»¥æ˜¯é™¤ <span class="token keyword">null</span> ä¹‹å¤–çš„ä»»ä½• JavaScript å€¼
<span class="token literal-property property">encoding</span><span class="token operator">:</span>ç¼–ç 
<span class="token literal-property property">callback</span><span class="token operator">:</span>æµç»“æŸæ—¶çš„å›è°ƒ
</code></pre></div><div class="language-js"><pre><code><span class="token comment">// å†™å…¥ &#39;hello, &#39; ç„¶åä»¥ &#39;world!&#39; ç»“å°¾ã€‚</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> file <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">&#39;example.txt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;hello, &#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
file<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;world!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ç°åœ¨ä¸å…è®¸å†™å…¥æ›´å¤šï¼</span>
</code></pre></div><h4 id="writable-setdefaultencoding" tabindex="-1"><strong>writable.setDefaultEncoding ()</strong></h4><p>è®¾ç½®é»˜è®¤çš„ç¼–ç (encoding)</p><div class="language-js"><pre><code>writable<span class="token punctuation">.</span><span class="token function">setDefaultEncoding</span><span class="token punctuation">(</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span> 
</code></pre></div><h4 id="writable-uncork" tabindex="-1"><strong>writable.uncork()</strong></h4><p><code>writable.uncork()</code> æ–¹æ³•ä¼šåˆ·æ–°è‡ªè°ƒç”¨ <code>stream.cork()</code> ä»¥æ¥ç¼“å†²çš„æ‰€æœ‰æ•°æ®ã€‚</p><p>å½“ä½¿ç”¨ <a href="http://nodejs.cn/api/stream.html#writablecork" target="_blank" rel="noopener noreferrer"><code>writable.cork()</code></a> å’Œ <code>writable.uncork()</code> ç®¡ç†å†™å…¥æµçš„ç¼“å†²æ—¶ï¼Œå»ºè®®ä½¿ç”¨ <code>process.nextTick()</code> å»¶è¿Ÿå¯¹ <code>writable.uncork()</code> çš„è°ƒç”¨ã€‚ è¿™æ ·åšå…è®¸å¯¹åœ¨ç»™å®š Node.js äº‹ä»¶å¾ªç¯é˜¶æ®µä¸­å‘ç”Ÿçš„æ‰€æœ‰ <code>writable.write()</code> è°ƒç”¨è¿›è¡Œæ‰¹å¤„ç†ã€‚</p><div class="language-js"><pre><code>stream<span class="token punctuation">.</span><span class="token function">cork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;some &#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;data &#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> stream<span class="token punctuation">.</span><span class="token function">uncork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å¦‚æœåœ¨ä¸€ä¸ªæµä¸Šå¤šæ¬¡è°ƒç”¨ <a href="http://nodejs.cn/api/stream.html#writablecork" target="_blank" rel="noopener noreferrer"><code>writable.cork()</code></a> æ–¹æ³•ï¼Œåˆ™å¿…é¡»è°ƒç”¨ç›¸åŒæ•°é‡çš„ <code>writable.uncork()</code> è°ƒç”¨æ¥åˆ·æ–°ç¼“å†²çš„æ•°æ®ã€‚</p><div class="language-js"><pre><code>stream<span class="token punctuation">.</span><span class="token function">cork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;some &#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">cork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;data &#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  stream<span class="token punctuation">.</span><span class="token function">uncork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// åœ¨ç¬¬äºŒæ¬¡è°ƒç”¨ uncork() ä¹‹å‰ä¸ä¼šåˆ·æ–°æ•°æ®ã€‚</span>
  stream<span class="token punctuation">.</span><span class="token function">uncork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å¦è§: <a href="http://nodejs.cn/api/stream.html#writablecork" target="_blank" rel="noopener noreferrer"><code>writable.cork()</code></a>ã€‚</p><h4 id="writable-write-chunk-encoding-callback" tabindex="-1"><strong>writable.write(chunk[, encoding][, callback])</strong></h4><p>å°†æ•°æ®å†™å…¥æµä¸­ï¼Œè¿”å›Booleanï¼Œ å¦‚æœæµå¸Œæœ›è°ƒç”¨ä»£ç åœ¨ç»§ç»­å†™å…¥å…¶ä»–æ•°æ®ä¹‹å‰ç­‰å¾… <code>&#39;drain&#39;</code> äº‹ä»¶è¢«è§¦å‘ï¼Œåˆ™ä¸º <code>false</code>ï¼›å¦åˆ™ä¸º <code>true</code>ã€‚</p><p>chunkï¼šè¦å†™å…¥çš„æ•°æ®</p><p>encodingï¼šå­—èŠ‚ç¼–ç </p><p>callbackï¼šå½“åˆ·æ–°æ­¤å—æ•°æ®æ—¶çš„å›è°ƒ</p><div class="language-js"><pre><code><span class="token keyword">let</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> txt <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">&quot;./è¿™æ˜¯ä¸€ä¸ªå¯å†™æµåˆ›å»ºçš„æ–‡ä»¶.txt&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">flags</span><span class="token operator">:</span><span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">encoding</span><span class="token operator">:</span><span class="token string">&quot;utf8&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>txt<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token string">&#39;UTF8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//  .write()è¿”å›trueè¡¨ç¤ºèƒ½ç»§ç»­å†™å…¥</span>
        txt<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&#39;drain&#39;</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// åœ¨æ‰§è¡Œä»»ä½•å…¶ä»–å†™å…¥ä¹‹å‰ç­‰å¾…å›è°ƒè¢«è°ƒç”¨ã€‚</span>
<span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;è¿™æ˜¯ä¸€ä¸²ä½¿ç”¨ utf8 ç¼–ç å†™å…¥çš„æ–‡æœ¬æ•°æ®,å¹¶ä¸”åšäº†é˜²æ­¢èƒŒå‹çš„æ“ä½œ&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å®Œæˆå†™å…¥ï¼Œç°åœ¨å°±è¿›è¡Œæ›´å¤šå†™å…¥ã€‚&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// æ ‡è®°æ–‡ä»¶æœ«å°¾</span>
txt<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

txt<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;finish&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å†™å…¥å®Œæˆã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

txt<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;close&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å†™å…¥æµå·²ç»è¢«å…³é—­ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

txt<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

txt<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;pipe&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;pipe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ç¨‹åºæ‰§è¡Œå®Œæ¯•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="å±æ€§" tabindex="-1">å±æ€§</h3><p>å¯¹äº<code>writable</code> ç±»å®ƒä¹Ÿæœ‰æ‹¥æœ‰è¯¸å¤šå±æ€§</p><ul><li><strong>writable.writable</strong></li></ul><p>å¦‚æœè°ƒç”¨ <code>writable.write()</code> æ˜¯å®‰å…¨çš„ï¼Œåˆ™ä¸º <code>true</code>ï¼Œè¿™æ„å‘³ç€æµæ²¡æœ‰è¢«é”€æ¯ã€å‡ºé”™æˆ–ç»“æŸã€‚</p><ul><li><p><strong>writable.writableEnded</strong></p><p>åœ¨è°ƒç”¨ <a href="http://nodejs.cn/api/stream.html#writableendchunk-encoding-callback" target="_blank" rel="noopener noreferrer"><code>writable.end()</code></a> ä¹‹åæ˜¯ <code>true</code>ã€‚ æ­¤å±æ€§ä¸æŒ‡ç¤ºæ•°æ®æ˜¯å¦å·²åˆ·æ–°ï¼Œä¸ºæ­¤åˆ™ä½¿ç”¨ <a href="http://nodejs.cn/api/stream.html#writablewritablefinished" target="_blank" rel="noopener noreferrer"><code>writable.writableFinished</code></a> ä»£æ›¿ã€‚</p></li><li><p><strong>writable.writableCorked</strong></p><p>éœ€è¦è°ƒç”¨ <a href="http://nodejs.cn/api/stream.html#writableuncork" target="_blank" rel="noopener noreferrer"><code>writable.uncork()</code></a> ä»¥å®Œå…¨è§£å¼€æµçš„æ¬¡æ•°ã€‚</p></li><li><p><strong>writable. writableFinished</strong></p><p>åœ¨è§¦å‘ <a href="http://nodejs.cn/api/stream.html#event-finish" target="_blank" rel="noopener noreferrer"><code>&#39;finish&#39;</code></a> äº‹ä»¶ä¹‹å‰ç«‹å³è®¾ç½®ä¸º <code>true</code>ã€‚</p></li><li><p><strong>writable.writableHighWaterMark</strong></p><p>è¿”å›åˆ›å»ºæ­¤ <code>Writable</code> æ—¶ä¼ å…¥çš„ <code>highWaterMark</code> çš„å€¼ã€‚</p></li><li><p><strong>writable.writableLength</strong></p><p>æ­¤å±æ€§åŒ…å«é˜Ÿåˆ—ä¸­å‡†å¤‡å†™å…¥çš„å­—èŠ‚æ•°ï¼ˆæˆ–å¯¹è±¡æ•°ï¼‰ã€‚ è¯¥å€¼æä¾›æœ‰å…³ <code>highWaterMark</code> çŠ¶æ€çš„å†…çœæ•°æ®ã€‚</p></li><li><p><strong>writable.writableNeedDrain</strong></p><p>å¦‚æœæµçš„ç¼“å†²åŒºå·²æ»¡å¹¶ä¸”æµå°†è§¦å‘ <code>&#39;drain&#39;</code>ï¼Œåˆ™ä¸º <code>true</code>ã€‚</p></li><li><p><strong>writable.writableObjectMode</strong></p><p>ç»™å®š <code>Writable</code> æµçš„å±æ€§ <code>objectMode</code> çš„è·å–å™¨ã€‚</p><p><strong>writable. destroyed()</strong></p><p>åœ¨è°ƒç”¨ <code>writable.destro ä¹‹åæ˜¯ </code>true`ã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Writable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;stream&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> myStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Writable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myStream<span class="token punctuation">.</span>destroyed<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
myStream<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myStream<span class="token punctuation">.</span>destroyed<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div></li></ul><h2 id="å¯è¯»æµ-readable" tabindex="-1">å¯è¯»æµ(readable)</h2><p>å¯è¯»æµæ˜¯å¯¹æ¶ˆè´¹çš„æ•°æ®æ¥æºçš„æŠ½è±¡</p><p>å¸¸è§çš„å¯è¯»æµæœ‰ï¼š</p><ul><li>å®¢æˆ·ç«¯ä¸Šçš„ HTTP å“åº”</li><li>æœåŠ¡å™¨ä¸Šçš„ HTTP è¯·æ±‚</li><li>æ–‡ä»¶ç³»ç»Ÿè¯»å–æµ</li><li>å‹ç¼©æµ</li><li>åŠ å¯†æµ</li><li>TCP å¥—æ¥å­—</li><li>å­è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯</li><li>process.stdin</li></ul><h3 id="ä¸¤ç§è¯»å–æ¨¡å¼" tabindex="-1">ä¸¤ç§è¯»å–æ¨¡å¼</h3><p><code>readable</code>åˆä¸¤ç§æ¨¡å¼ä¹‹ä¸€æœ‰æ•ˆçš„è¿è¡Œï¼šæµåŠ¨å’Œæš‚åœã€‚è¿™äº›æ¨¡å¼å’Œå¯¹è±¡æ¨¡å¼æ˜¯åˆ†å¼€çš„ã€‚<code>readable</code>æµå¯ä»¥å¤„äºæˆ–ä¸å¤„äºå¯¹å¯¹è±¡æ¨¡å¼ï¼Œæ— è®ºæ˜¯æµåŠ¨æ¨¡å¼è¿˜æ˜¯æš‚åœæ¨¡å¼ã€‚</p><ul><li>åœ¨æµåŠ¨æ¨¡å¼ä¸‹ï¼Œæ•°æ®ä¼šè‡ªåŠ¨ä»åº•å±‚ç³»ç»Ÿè¯»å–ï¼Œå¹¶é€šè¿‡EventEmitteræ¥å£ä½¿ç”¨äº‹ä»¶å°½å¿«æä¾›ç»™åº”ç”¨ç¨‹åºã€‚</li><li>åœ¨æš‚åœæ¨¡å¼ä¸‹ï¼Œå¿…é¡»æ˜¾å¼è°ƒç”¨<code>stream.read()</code>æ–¹æ³•ä»æµä¸­è¯»å–æ•°æ®å—ã€‚</li></ul><p>æ‰€æœ‰çš„<code>readable</code>æµéƒ½æ˜¯ä»¥æš‚åœæ¨¡å¼å¼€å§‹çš„ï¼Œå¯ä»¥ é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€åˆ‡æ¢åˆ°æµåŠ¨æ¨¡å¼ï¼š</p><ul><li>æ·»åŠ <code>data</code>äº‹ä»¶ç›‘å¬</li><li>è°ƒç”¨<code>stream.resume()</code>æ–¹æ³•</li><li>è°ƒç”¨<code>stream.pipe()</code>æ–¹æ³•å°†æ•°æ®å‘é€åˆ°<code>writable</code></li></ul><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¹‹ä¸€åˆ‡æ¢å›æš‚åœæ¨¡å¼ï¼š</p><ul><li>å¦‚æœæ²¡æœ‰ç®¡é“ç›®æ ‡ï¼Œåˆ™é€šè¿‡è°ƒç”¨ <code>stream.pause()</code> æ–¹æ³•ã€‚</li><li>å¦‚æœæœ‰ç®¡é“ç›®æ ‡ï¼Œåˆ™åˆ é™¤æ‰€æœ‰ç®¡é“ç›®æ ‡ã€‚ å¯ä»¥é€šè¿‡è°ƒç”¨ <code>stream.unpipe()</code>æ–¹æ³•åˆ é™¤å¤šä¸ªç®¡é“ç›®æ ‡ã€‚</li></ul><p><strong>è¦è®°ä½çš„é‡è¦æ¦‚å¿µæ˜¯ï¼Œåœ¨æä¾›æ¶ˆè´¹æˆ–å¿½ç•¥è¯¥æ•°æ®çš„æœºåˆ¶ä¹‹å‰ï¼Œ<code>Readable</code> ä¸ä¼šäº§ç”Ÿæ•°æ®ã€‚ å¦‚æœæ¶ˆè´¹æœºåˆ¶è¢«ç¦ç”¨æˆ–ç§»é™¤ï¼Œåˆ™ <code>Readable</code> å°†å°è¯•åœæ­¢äº§ç”Ÿæ•°æ®ã€‚</strong></p><p>å‡ºäºå‘åå…¼å®¹æ€§çš„åŸå› ï¼Œåˆ é™¤ <a href="http://nodejs.cn/api/stream.html#event-data" target="_blank" rel="noopener noreferrer"><code>&#39;data&#39;</code></a> äº‹ä»¶å¥æŸ„ä¸ä¼šè‡ªåŠ¨æš‚åœæµã€‚ æ­¤å¤–ï¼Œå¦‚æœæœ‰ç®¡é“ç›®æ ‡ï¼Œåˆ™è°ƒç”¨ <a href="http://nodejs.cn/api/stream.html#readablepause" target="_blank" rel="noopener noreferrer"><code>stream.pause()</code></a> å°†ä¸èƒ½ä¿è¯ä¸€æ—¦è¿™äº›ç›®æ ‡æ’ç©ºå¹¶è¦æ±‚æ›´å¤šæ•°æ®ï¼Œæµå°†ä¿æŒæš‚åœçŠ¶æ€ã€‚</p><p>å¦‚æœ <a href="http://nodejs.cn/api/stream.html#class-streamreadable" target="_blank" rel="noopener noreferrer"><code>Readable</code></a> åˆ‡æ¢åˆ°æµåŠ¨æ¨¡å¼å¹¶ä¸”æ²¡æœ‰æ¶ˆè´¹è€…å¯ç”¨äºå¤„ç†æ•°æ®ï¼Œåˆ™æ•°æ®å°†è¢«ä¸¢å¤±ã€‚ ä¾‹å¦‚ï¼Œå½“è°ƒç”¨ <code>readable.resume()</code> æ–¹æ³•è€Œæ²¡æœ‰ç»‘å®šåˆ° <code>&#39;data&#39;</code> äº‹ä»¶çš„ç›‘å¬å™¨æ—¶ï¼Œæˆ–è€…å½“ä»æµä¸­åˆ é™¤ <code>&#39;data&#39;</code> äº‹ä»¶å¥æŸ„æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚</p><p>æ·»åŠ  <a href="http://nodejs.cn/api/stream.html#event-readable" target="_blank" rel="noopener noreferrer"><code>&#39;readable&#39;</code></a> äº‹ä»¶å¥æŸ„ä¼šè‡ªåŠ¨ä½¿æµåœæ­¢æµåŠ¨ï¼Œå¹¶ä¸”å¿…é¡»é€šè¿‡ <a href="http://nodejs.cn/api/stream.html#readablereadsize" target="_blank" rel="noopener noreferrer"><code>readable.read()</code></a> æ¥æ¶ˆè´¹æ•°æ®ã€‚ å¦‚æœåˆ é™¤äº† <a href="http://nodejs.cn/api/stream.html#event-readable" target="_blank" rel="noopener noreferrer"><code>&#39;readable&#39;</code></a> äº‹ä»¶å¥æŸ„ï¼Œåˆ™å¦‚æœæœ‰ <a href="http://nodejs.cn/api/stream.html#event-data" target="_blank" rel="noopener noreferrer"><code>&#39;data&#39;</code></a> äº‹ä»¶å¥æŸ„ï¼Œæµå°†å†æ¬¡å¼€å§‹æµåŠ¨ã€‚</p><h3 id="ä¸‰ç§çŠ¶æ€" tabindex="-1">ä¸‰ç§çŠ¶æ€</h3><p><code>Readable</code> æµçš„æ“ä½œçš„&quot;ä¸¤ç§æ¨¡å¼&quot;æ˜¯å¯¹ <code>Readable</code> æµå®ç°ä¸­å‘ç”Ÿçš„æ›´å¤æ‚çš„å†…éƒ¨çŠ¶æ€ç®¡ç†çš„ç®€åŒ–æŠ½è±¡ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œåœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´ç‚¹ï¼Œæ¯ä¸ª <code>Readable</code> éƒ½å¤„äºä¸‰ç§å¯èƒ½çš„çŠ¶æ€ä¹‹ä¸€ï¼š</p><ul><li><code>readable.readableFlowing === null</code></li><li><code>readable.readableFlowing === false</code></li><li><code>readable.readableFlowing === true</code></li></ul><p>å½“ <code>readable.readableFlowing</code> ä¸º <code>null</code> æ—¶ï¼Œåˆ™ä¸æä¾›æ¶ˆè´¹æµæ•°æ®çš„æœºåˆ¶ã€‚ å› æ­¤ï¼Œæµä¸ä¼šç”Ÿæˆæ•°æ®ã€‚ åœ¨æ­¤çŠ¶æ€ä¸‹ï¼Œä¸º <code>&#39;data&#39;</code> äº‹ä»¶ç»‘å®šç›‘å¬å™¨ã€è°ƒç”¨ <code>readable.pipe()</code> æ–¹æ³•ã€æˆ–è°ƒç”¨ <code>readable.resume()</code> æ–¹æ³•ä¼šå°† <code>readable.readableFlowing</code> åˆ‡æ¢åˆ° <code>true</code>ï¼Œä»è€Œä½¿ <code>Readable</code> åœ¨ç”Ÿæˆæ•°æ®æ—¶å¼€å§‹ä¸»åŠ¨è§¦å‘äº‹ä»¶ã€‚</p><p>è°ƒç”¨<code>readable.pause()</code>ã€<code>readable.unpipe()</code>ã€æˆ–è€…æ¥æ”¶èƒŒå‹éƒ½ä¼šå¯¼è‡´ <code>readable.readableFlowing</code> è¢«è®¾ç½®ä¸º <code>false</code>ï¼Œæš‚æ—¶åœæ­¢äº‹ä»¶çš„æµåŠ¨ï¼Œä½†ä¸ä¼šåœæ­¢æ•°æ®çš„ç”Ÿæˆã€‚ åœ¨æ­¤çŠ¶æ€ä¸‹ï¼Œä¸º <code>&#39;data&#39;</code> äº‹ä»¶ç»‘å®šç›‘å¬å™¨ä¸ä¼šå°† <code>readable.readableFlowing</code> åˆ‡æ¢åˆ° <code>true</code>ã€‚</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> PassThrough<span class="token punctuation">,</span> Writable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;stream&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PassThrough</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> writable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Writable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

pass<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writable<span class="token punctuation">)</span><span class="token punctuation">;</span>
pass<span class="token punctuation">.</span><span class="token function">unpipe</span><span class="token punctuation">(</span>writable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// readableFlowing ç°åœ¨ä¸º falseã€‚</span>

pass<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pass<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¸ä¼šè§¦å‘ &#39;data&#39;ã€‚</span>
pass<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// å¿…é¡»è°ƒç”¨æ‰èƒ½ä½¿æµè§¦å‘ &#39;data&#39;ã€‚</span>
</code></pre></div><h3 id="é€‰æ‹©ä¸€ç§æ¥å£é£æ ¼" tabindex="-1">é€‰æ‹©ä¸€ç§æ¥å£é£æ ¼</h3><p>è™½ç„¶ <code>readable.readableFlowing</code> æ˜¯ <code>false</code>ï¼Œä½†æ•°æ®å¯èƒ½ä¼šåœ¨æµçš„å†…éƒ¨ç¼“å†²åŒºä¸­ç´¯ç§¯ã€‚</p><p><code>Readable</code> æµçš„ API è·¨è¶Šå¤šä¸ª Node.js ç‰ˆæœ¬çš„æ¼”è¿›ï¼Œå¹¶æä¾›äº†å¤šç§æ¶ˆè´¹æµæ•°æ®çš„æ–¹æ³•ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¼€å‘è€…åº”è¯¥é€‰æ‹©å…¶ä¸­ä¸€ç§æ¶ˆè´¹æ•°æ®çš„æ–¹å¼ï¼Œåˆ‡å¿Œä½¿ç”¨å¤šç§æ–¹å¼æ¶ˆè´¹å•ä¸€æµä¸­çš„æ•°æ®ã€‚ å…·ä½“æ¥è¯´ï¼Œä½¿ç”¨ <code>on(&#39;data&#39;)</code>ã€<code>on(&#39;readable&#39;)</code>ã€<code>pipe()</code> æˆ–å¼‚æ­¥è¿­ä»£å™¨çš„ç»„åˆå¯èƒ½ä¼šå¯¼è‡´ä¸ç›´è§‚çš„è¡Œä¸ºã€‚</p><p>å»ºè®®å¤§å¤šæ•°ç”¨æˆ·ä½¿ç”¨ <code>readable.pipe()</code> æ–¹æ³•ï¼Œå› ä¸ºå®ƒå·²è¢«å®æ–½ä»¥æä¾›ä½¿ç”¨æµæ•°æ®çš„æœ€ç®€å•æ–¹æ³•ã€‚ éœ€è¦å¯¹æ•°æ®ä¼ è¾“å’Œç”Ÿæˆè¿›è¡Œæ›´ç»†ç²’åº¦æ§åˆ¶çš„å¼€å‘è€…å¯ä»¥ä½¿ç”¨ <a href="http://nodejs.cn/api/events.html#class-eventemitter" target="_blank" rel="noopener noreferrer"><code>EventEmitter</code></a> å’Œ <code>readable.on(&#39;readable&#39;)</code>/<code>readable.read()</code> æˆ– <code>readable.pause()</code>/<code>readable.resume()</code> APIã€‚</p><h3 id="åˆ›å»ºå¯è¯»æµ" tabindex="-1">åˆ›å»ºå¯è¯»æµ</h3><h3 id="ç¤ºä¾‹-1" tabindex="-1">ç¤ºä¾‹</h3><h3 id="äº‹ä»¶-1" tabindex="-1">äº‹ä»¶</h3><p>å¯¹äº<code>Readable</code> ç±»å®ƒæ‹¥æœ‰è¯¸å¤šäº‹ä»¶</p><p><code>&#39;close&#39;</code> <strong>äº‹ä»¶</strong></p><p><code>&#39;data&#39;</code> <strong>äº‹ä»¶</strong></p><p><code>&#39;end&#39;</code> <strong>äº‹ä»¶</strong></p><p><code>&#39;error&#39;</code> <strong>äº‹ä»¶</strong></p><p><code>&#39;pause&#39;</code> <strong>äº‹ä»¶</strong></p><p><code>&#39;readable&#39;</code> <strong>äº‹ä»¶</strong></p><p><code>&#39;resume&#39;</code> <strong>äº‹ä»¶</strong></p><h3 id="æ–¹æ³•-1" tabindex="-1">æ–¹æ³•</h3><p>å¯¹äº<code>Readable</code> ç±»å®ƒæ‹¥æœ‰è¯¸å¤šæ–¹æ³•</p><p><strong>readable.destroy([error])</strong></p><p><strong>readable.destroyed</strong></p><p><strong>readable.isPaused()</strong></p><p><strong>readable.pause()</strong></p><p><strong>readable.pipe(destination[, options])</strong></p><p><strong>readable.unpipe([destination])</strong></p><p><strong>readable.unshift(chunk[, encoding])</strong></p><p><strong>readable.read([size])</strong></p><p><strong>readable.resume()</strong></p><p><strong>readable.setEncoding(encoding)</strong></p><p><strong>eadable.wrap(stream)</strong></p><h3 id="å±æ€§-1" tabindex="-1">å±æ€§</h3><p>å¯¹äº<code>Readable</code> ç±»å®ƒæ‹¥æœ‰è¯¸å¤šå±æ€§</p><p><strong>readable.readable</strong></p><p><strong>readable.readableAborted</strong></p><p><strong>readable.readableDidRead</strong></p><p><strong>readable.readableEncoding</strong></p><p><strong>readable.readableEnded</strong></p><p><strong>readable.readableFlowing</strong></p><p><strong>readable.readableHighWaterMark</strong></p><p><strong>readable.readableLength</strong></p><p><strong>readable.readableObjectMode</strong></p><div class="language-js"><pre><code>fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token punctuation">{</span>
    flags <span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> è¯·å‚é˜…å¯¹æ–‡ä»¶ç³»ç»Ÿ flags çš„æ”¯æŒã€‚ é»˜è®¤å€¼<span class="token operator">:</span> <span class="token string">&#39;r&#39;</span>ã€‚
    <span class="token literal-property property">encoding</span><span class="token operator">:</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">,</span>	<span class="token comment">// é»˜è®¤å€¼: null</span>
    fd <span class="token operator">&lt;</span>integer<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token operator">&lt;</span>FileHandle<span class="token operator">&gt;</span> é»˜è®¤å€¼<span class="token operator">:</span> <span class="token keyword">null</span> 
    mode <span class="token operator">&lt;</span>integer<span class="token operator">&gt;</span> é»˜è®¤å€¼<span class="token operator">:</span> <span class="token number">0o666</span>
    autoClose <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span> é»˜è®¤å€¼<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token literal-property property">emitClose</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>	 <span class="token comment">// é»˜è®¤å€¼: true</span>
    <span class="token literal-property property">start</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>		<span class="token comment">// ä»ç´¢å¼•3å¼€å§‹è¯»</span>
    <span class="token literal-property property">end</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span>		<span class="token comment">// è¯»åˆ°ç´¢å¼•ä¸º100çš„  åŒ…æ‹¬ç»“æŸ</span>
    <span class="token literal-property property">highWaterMark</span><span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// é»˜è®¤å€¼: 64 * 1024(64kb)</span>
    fs <span class="token operator">&lt;</span>Object<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span> é»˜è®¤å€¼<span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
encoding å¯ä»¥æ˜¯ <span class="token operator">&lt;</span>Buffer<span class="token operator">&gt;</span> æ¥å—çš„ä»»ä½•ä¸€ç§ã€‚
å¦‚æœæŒ‡å®šäº† fdï¼Œåˆ™ ReadStream å°†å¿½ç•¥ path å‚æ•°å¹¶ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ã€‚ è¿™æ„å‘³ç€ä¸ä¼šè§¦å‘ <span class="token string">&#39;open&#39;</span> äº‹ä»¶ã€‚ fd åº”è¯¥æ˜¯é˜»å¡çš„ï¼›éé˜»å¡ fd åº”è¯¥ä¼ ç»™ <span class="token operator">&lt;</span>net<span class="token punctuation">.</span>Socket<span class="token operator">&gt;</span>ã€‚
å¦‚æœ fd æŒ‡å‘ä»…æ”¯æŒé˜»å¡è¯»å–çš„å­—ç¬¦è®¾å¤‡ï¼ˆä¾‹å¦‚é”®ç›˜æˆ–å£°å¡ï¼‰ï¼Œåˆ™è¯»å–æ“ä½œä¸ä¼šåœ¨æ•°æ®å¯ç”¨ä¹‹å‰å®Œæˆã€‚ è¿™å¯ä»¥é˜²æ­¢è¿›ç¨‹é€€å‡ºå’Œæµè‡ªç„¶å…³é—­ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼Œæµå°†åœ¨é”€æ¯åè§¦å‘ <span class="token string">&#39;close&#39;</span> äº‹ä»¶ã€‚ å°† emitClose é€‰é¡¹è®¾ç½®ä¸º <span class="token boolean">false</span> ä»¥æ›´æ”¹æ­¤è¡Œä¸ºã€‚
å¦‚æœ autoClose ä¸º <span class="token boolean">false</span>ï¼Œåˆ™å³ä½¿å‡ºç°é”™è¯¯ï¼Œæ–‡ä»¶æè¿°ç¬¦ä¹Ÿä¸ä¼šå…³é—­ã€‚ å…³é—­å®ƒå¹¶ç¡®ä¿æ²¡æœ‰æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æ˜¯åº”ç”¨ç¨‹åºçš„è´£ä»»ã€‚ å¦‚æœ autoClose è®¾ç½®ä¸º <span class="token boolean">true</span>ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ï¼Œåˆ™åœ¨ <span class="token string">&#39;error&#39;</span> æˆ– <span class="token string">&#39;end&#39;</span> æ—¶ï¼Œæ–‡ä»¶æè¿°ç¬¦å°†è‡ªåŠ¨å…³é—­ã€‚
mode è®¾ç½®æ–‡ä»¶æ¨¡å¼ï¼ˆæƒé™å’Œç²˜æ»ä½ï¼‰ï¼Œä½†å‰ææ˜¯æ–‡ä»¶å·²åˆ›å»ºã€‚
</code></pre></div><p>äº‹ä»¶</p><div class="language-js"><pre><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">&quot;./test.txt&quot;</span><span class="token punctuation">)</span>

<span class="token comment">/*
** æ–¹æ³•
*/</span>
a<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// å°†å¯¼è‡´å¤„äºæµåŠ¨æ¨¡å¼çš„æµåœæ­¢è§¦å‘ &#39;data&#39; äº‹ä»¶ï¼Œåˆ‡æ¢å‡ºæµåŠ¨æ¨¡å¼ã€‚ ä»»ä½•å¯ç”¨çš„æ•°æ®éƒ½å°†ä¿ç•™åœ¨å†…éƒ¨ç¼“å†²åŒºä¸­</span>
a<span class="token punctuation">.</span><span class="token function">isPaused</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ–¹æ³•è¿”å› Readable(a) çš„å½“å‰è¿è¡ŒçŠ¶æ€</span>
a<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// é”€æ¯æµçŠ¶æ€ï¼Œå¯é€‰åœ°è§¦å‘ &#39;error&#39; äº‹ä»¶ï¼Œå¹¶ä¸”è§¦å‘ &#39;close&#39; äº‹ä»¶ï¼ˆé™¤é emitClose è®¾ç½®ä¸º falseï¼‰åœ¨æ­¤è°ƒç”¨ä¹‹åï¼Œå¯è¯»æµå°†é‡Šæ”¾ä»»ä½•å†…éƒ¨èµ„æºï¼Œéšåå¯¹ push() çš„è°ƒç”¨å°†è¢«å¿½ç•¥ã€‚</span>
<span class="token comment">// ä¸€æ—¦ destroy() è¢«è°ƒç”¨ï¼Œä»»ä½•è¿›ä¸€æ­¥çš„è°ƒç”¨éƒ½å°†æ˜¯ç©ºæ“ä½œï¼Œé™¤äº†æ¥è‡ª _destroy() çš„å…¶ä»–é”™è¯¯å¯èƒ½ä¸ä¼šä½œä¸º &#39;error&#39; è§¦å‘ã€‚</span>
a<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ç»§ç»­è§¦å‘ &#39;data&#39; äº‹ä»¶ </span>
a<span class="token punctuation">.</span><span class="token function">destroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ˜¯å¦è°ƒç”¨äº†destroyæ–¹æ³•</span>
a<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment">// </span>

<span class="token comment">// è™½ç„¶ readable.readableFlowing æ˜¯ falseï¼Œä½†æ•°æ®å¯èƒ½ä¼šåœ¨æµçš„å†…éƒ¨ç¼“å†²åŒºä¸­ç´¯ç§¯ã€‚</span>
<span class="token comment">/*
** äº‹ä»¶
*/</span>
<span class="token comment">// ç›‘å¬æ•°æ®æµäº‹ä»¶</span>
a<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span>param<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ä»æµä¸­è¯»å–çš„æ•°æ®æˆ–å·²åˆ°è¾¾æµçš„æœ«å°¾æ—¶è§¦å‘</span>
a<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;readable&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç°åœ¨æœ‰ä¸€äº›æ•°æ®è¦è¯»å–ã€‚</span>
    <span class="token keyword">let</span> data<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// this.read() å¯èƒ½ä¸ºnull</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;readable&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ç›‘å¬æ•°æ®æµç»“æŸäº‹ä»¶</span>
a<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span>param<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ç›‘å¬æ•°æ®æµé”™è¯¯äº‹ä»¶</span>
a<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>param<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ç›‘å¬æ•°æ®æµæ‰“å¼€äº‹ä»¶</span>
a<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœæœ‰ &#39;readable&#39; äº‹ä»¶ç›‘å¬å™¨ï¼Œåˆ™ a.pause() æ–¹æ³•ä¸èµ·ä½œç”¨</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span>param<span class="token punctuation">)</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Now data will start flowing again.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        a<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// a.destroy();</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ç›‘å¬æ•°æ®æµæš‚åœäº‹ä»¶</span>
a<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;pause&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;pause&quot;</span><span class="token punctuation">,</span>param<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ç›‘å¬æ•°æ®æµå…³é—­äº‹ä»¶</span>
a<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;pause&quot;</span><span class="token punctuation">,</span>param<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ç›‘å¬æ•°æ®æµå…³é—­äº‹ä»¶ === å½“è°ƒç”¨ stream.resume() å¹¶ä¸” readableFlowing ä¸æ˜¯ true æ—¶ï¼Œåˆ™ä¼šè§¦å‘ &#39;resume&#39; äº‹ä»¶ã€‚</span>
a<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;resume&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;resume&quot;</span><span class="token punctuation">,</span>param<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œreadable.pipe() å’Œ &#39;data&#39; äº‹ä»¶æœºåˆ¶æ¯” &#39;readable&#39; äº‹ä»¶æ›´å®¹æ˜“ç†è§£ã€‚ ä½†æ˜¯ï¼Œå¤„ç† &#39;readable&#39; å¯èƒ½ä¼šå¯¼è‡´ååé‡å¢åŠ ã€‚ å¦‚æœåŒæ—¶ä½¿ç”¨ &#39;readable&#39; å’Œ &#39;data&#39;ï¼Œåˆ™ &#39;readable&#39; ä¼˜å…ˆæ§åˆ¶æµï¼Œå³åªæœ‰åœ¨è°ƒç”¨ stream.read() æ—¶æ‰ä¼šè§¦å‘ &#39;data&#39;ã€‚ readableFlowing å±æ€§å°†å˜ä¸º falseã€‚ å¦‚æœåœ¨ç§»é™¤ &#39;readable&#39; æ—¶æœ‰ &#39;data&#39; ä¸ªç›‘å¬å™¨ï¼Œåˆ™æµå°†å¼€å§‹æµåŠ¨ï¼Œå³ &#39;data&#39; äº‹ä»¶å°†åœ¨ä¸è°ƒç”¨ .resume() çš„æƒ…å†µä¸‹è§¦å‘ã€‚</p></blockquote><h2 id="åŒå·¥æµ" tabindex="-1">åŒå·¥æµ()</h2><h2 id="è½¬åŒ–æµ" tabindex="-1">è½¬åŒ–æµ</h2><h2 id="é™„è¡¨1" tabindex="-1">é™„è¡¨1</h2><ul><li><p><code>&#39;a&#39;</code>: æ‰“å¼€æ–‡ä»¶è¿›è¡Œè¿½åŠ ã€‚ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥æ–‡ä»¶ã€‚</p></li><li><p><code>&#39;ax&#39;</code>: ç±»ä¼¼äº <code>&#39;a&#39;</code> ä½†å¦‚æœè·¯å¾„å­˜åœ¨åˆ™å¤±è´¥ã€‚</p></li><li><p><code>&#39;a+&#39;</code>: æ‰“å¼€æ–‡ä»¶è¿›è¡Œè¯»å–å’Œè¿½åŠ ã€‚ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥æ–‡ä»¶ã€‚</p></li><li><p><code>&#39;ax+&#39;</code>: ç±»ä¼¼äº <code>&#39;a+&#39;</code> ä½†å¦‚æœè·¯å¾„å­˜åœ¨åˆ™å¤±è´¥ã€‚</p></li><li><p><code>&#39;as&#39;</code>: ä»¥åŒæ­¥æ¨¡å¼æ‰“å¼€æ–‡ä»¶è¿›è¡Œè¿½åŠ ã€‚ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥æ–‡ä»¶ã€‚</p></li><li><p><code>&#39;as+&#39;</code>: ä»¥åŒæ­¥æ¨¡å¼æ‰“å¼€æ–‡ä»¶è¿›è¡Œè¯»å–å’Œè¿½åŠ ã€‚ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥æ–‡ä»¶ã€‚</p></li><li><p><code>&#39;r&#39;</code>: æ‰“å¼€æ–‡ä»¶è¿›è¡Œè¯»å–ã€‚ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚</p></li><li><p><code>&#39;r+&#39;</code>: æ‰“å¼€æ–‡ä»¶è¿›è¡Œè¯»å†™ã€‚ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚</p></li><li><p><code>&#39;rs+&#39;</code>: ä»¥åŒæ­¥æ¨¡å¼æ‰“å¼€æ–‡ä»¶è¿›è¡Œè¯»å†™ã€‚ æŒ‡ç¤ºæ“ä½œç³»ç»Ÿç»•è¿‡æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ã€‚</p><p>è¿™ä¸»è¦ç”¨äºåœ¨ NFS æŒ‚è½½ä¸Šæ‰“å¼€æ–‡ä»¶ï¼Œå› ä¸ºå®ƒå…è®¸è·³è¿‡å¯èƒ½è¿‡æ—¶çš„æœ¬åœ°ç¼“å­˜ã€‚ å®ƒå¯¹ I/O æ€§èƒ½æœ‰éå¸¸å®é™…çš„å½±å“ï¼Œå› æ­¤é™¤ééœ€è¦ï¼Œå¦åˆ™ä¸å»ºè®®ä½¿ç”¨æ­¤æ ‡å¿—ã€‚</p><p>è¿™ä¸ä¼šå°† <code>fs.open()</code> æˆ– <code>fsPromises.open()</code> å˜æˆåŒæ­¥é˜»å¡è°ƒç”¨ã€‚ å¦‚æœéœ€è¦åŒæ­¥æ“ä½œï¼Œåº”è¯¥ä½¿ç”¨ç±»ä¼¼ <code>fs.openSync()</code> çš„ä¸œè¥¿ã€‚</p></li><li><p><code>&#39;w&#39;</code>: æ‰“å¼€æ–‡ä»¶è¿›è¡Œå†™å…¥ã€‚ åˆ›å»ºï¼ˆå¦‚æœå®ƒä¸å­˜åœ¨ï¼‰æˆ–æˆªæ–­ï¼ˆå¦‚æœå®ƒå­˜åœ¨ï¼‰è¯¥æ–‡ä»¶ã€‚</p></li><li><p><code>&#39;wx&#39;</code>: ç±»ä¼¼äº <code>&#39;w&#39;</code> ä½†å¦‚æœè·¯å¾„å­˜åœ¨åˆ™å¤±è´¥ã€‚</p></li><li><p><code>&#39;w+&#39;</code>: æ‰“å¼€æ–‡ä»¶è¿›è¡Œè¯»å†™ã€‚ åˆ›å»ºï¼ˆå¦‚æœå®ƒä¸å­˜åœ¨ï¼‰æˆ–æˆªæ–­ï¼ˆå¦‚æœå®ƒå­˜åœ¨ï¼‰è¯¥æ–‡ä»¶ã€‚</p></li><li><p><code>&#39;wx+&#39;</code>: ç±»ä¼¼äº <code>&#39;w+&#39;</code> ä½†å¦‚æœè·¯å¾„å­˜åœ¨åˆ™å¤±è´¥ã€‚</p></li></ul><h2 id="å‹èƒŒ-backpressure" tabindex="-1">å‹èƒŒ( Backpressure)</h2><p>ä¸€èˆ¬æ˜¯æŒ‡bufferè¾¾åˆ°ä¸Šé™ï¼Œç®€å•è®²å°±æ˜¯ä¸Šæ¸¸çš„ç”Ÿäº§é€Ÿåº¦å¤§äºä¸‹æ¸¸çš„æ¶ˆè´¹é€Ÿåº¦</p></div></div><footer class="page-footer" data-v-f058c2ee data-v-4d1950e8><div class="edit" data-v-4d1950e8><div class="edit-link" data-v-4d1950e8 data-v-d1f281aa><!----></div></div><div class="updated" data-v-4d1950e8><p class="last-updated" data-v-4d1950e8 data-v-01ad1c9a><span class="prefix" data-v-01ad1c9a>æœ€è¿‘æ›´æ–°æ—¶é—´:</span><span class="datetime" data-v-01ad1c9a></span></p></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"ideshortcutkey_webstorm.md\":\"19c4ae71\",\"about_index.md\":\"be45de70\",\"client_electron_base.md\":\"1d881de0\",\"client_electron_index.md\":\"c432582b\",\"client_typescript_index.md\":\"ff455ba9\",\"client_css_æ»šåŠ¨æ¡.md\":\"58516aa0\",\"client_javascript_xmlhttprequest.md\":\"6f49cf58\",\"client_javascript_base.md\":\"cd88cb16\",\"client_javascript_index.md\":\"1e16a282\",\"client_javascript_å‡½æ•°.md\":\"0959e7ca\",\"concat_index.md\":\"8ba38e07\",\"environmentconstruction_index.md\":\"83171eeb\",\"environmentconstruction_linux.md\":\"d87ef34b\",\"environmentconstruction_mongodbç¦»çº¿å®‰è£….md\":\"d53b145c\",\"environmentconstruction_mysqlç¦»çº¿å®‰è£….md\":\"9526a905\",\"environmentconstruction_nginx.md\":\"a5bbc935\",\"environmentconstruction_redisç¦»çº¿å®‰è£….md\":\"cff6f538\",\"home_home.md\":\"bdda725b\",\"index.md\":\"999f742a\",\"interest_drug_index.md\":\"1209e85f\",\"interest_music_index.md\":\"625298a8\",\"npmpackage_index.md\":\"690a873d\",\"npmpackage_log4js.md\":\"8c2ee6a3\",\"qdcz-note.md\":\"01ac23f3\",\"service_linux_index.md\":\"b50fb82d\",\"service_linux_linux.md\":\"8351125d\",\"service_linux_å­˜å‚¨å•ä½.md\":\"e6f14abf\",\"service_mongodb_base.md\":\"c72e94f2\",\"service_mongodb_index.md\":\"07dce089\",\"service_mongodb_å»ºç«‹ttlç´¢å¼•.md\":\"96872d71\",\"service_nginx_index.md\":\"fb582ecc\",\"service_nginx_windowç‰ˆæœ¬.md\":\"1ae79a1d\",\"service_nodejs_base.md\":\"f724d3c1\",\"service_nodejs_buffer.md\":\"773c745e\",\"service_nodejs_index.md\":\"1e9b9708\",\"service_nodejs_process.md\":\"8f521494\",\"service_nodejs_stream.md\":\"4c62e57a\",\"service_nodejs_å·¥å…·å‡½æ•°.md\":\"9e14031f\",\"service_nodejs_æ–‡ä»¶æè¿°ç¬¦.md\":\"e4a5e3d5\",\"service_nodejs_æ—¥å¿—ç³»ç»Ÿè®°å½•.md\":\"b0edc299\",\"service_nodejs_æ··æ·†ç¼–è¯‘æ‰“åŒ….md\":\"045edeb3\",\"service_nodejs_é”.md\":\"cc245d7c\",\"softwareengineering_é¢å‘å¯¹è±¡ç¼–ç¨‹.md\":\"676219dd\",\"temporary_index.md\":\"86377c67\",\"temporary_recentplan.md\":\"4f39be33\",\"temporary_websocketforauthbynodejs.md\":\"914ee2ad\",\"temporary_work_day_work_report.md\":\"51ddcd7c\",\"temporary_work_todayplan.md\":\"f76512b0\",\"temporary_work_weekly_work_report.md\":\"8582985c\",\"windowsystem_index.md\":\"e3b3cf52\",\"windowsystem_åˆ›å»ºæœ¬åœ°å…±äº«æ–‡ä»¶å¤¹.md\":\"3c3fdf2d\"}")</script>
    <script type="module" async src="/assets/app.1760f824.js"></script>
    
  </body>
</html>