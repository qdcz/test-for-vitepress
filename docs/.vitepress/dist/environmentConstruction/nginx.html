<!DOCTYPE html>
<html lang="en-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1、同行对比 | 澜漾</title>
    <meta name="description" content="广天下之广,深天下之深">
    <link rel="stylesheet" href="/assets/style.49f07aca.css">
    <link rel="modulepreload" href="/assets/Home.83738dfc.js">
    <link rel="modulepreload" href="/assets/app.f3070ad9.js">
    <link rel="modulepreload" href="/assets/environmentConstruction_nginx.md.f2832f95.lean.js">
    
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <meta name="keywords" content="澜漾">
  <link rel="icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://lib.baomitu.com/gitalk/1.7.0/gitalk.min.css">
  <script src="https://lib.baomitu.com/gitalk/1.7.0/gitalk.min.js"></script>
  <script src="https://lib.baomitu.com/axios/0.21.1/axios.js"></script>
  <meta name="twitter:title" content="1、同行对比 | 澜漾">
  <meta property="og:title" content="1、同行对比 | 澜漾">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-d186b2c2><div class="sidebar-button" data-v-d186b2c2><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="澜漾, back to home" data-v-d186b2c2 data-v-34a93bc8><img class="logo" src="/logo2.jpg" alt="Logo" data-v-34a93bc8> 澜漾</a><div class="flex-grow" data-v-d186b2c2></div><div class="nav" data-v-d186b2c2><nav class="nav-links" data-v-d186b2c2 data-v-30b7e073><!--[--><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/" data-v-711da5ba>🏠 首页 <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/home/home" data-v-711da5ba>码上行动 <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/IDEShortcutKey/WebStorm" data-v-711da5ba>编辑器快捷键 <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item active" href="/environmentConstruction/index" data-v-711da5ba>环境搭建 <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/windowSystem/index" data-v-711da5ba>window <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/service/Linux/index" data-v-711da5ba>linux <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/about/index" data-v-711da5ba>🔨关于 <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/concat/index" data-v-711da5ba>👫友情链接 <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/temporary/index" data-v-711da5ba>临时存储 <!----></a></div></div><!--]--><!----><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item isExternal" href="https://github.com/qdcz" target="_blank" rel="noopener noreferrer" data-v-711da5ba>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-711da5ba><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-7e9d9da8><nav class="nav-links nav" data-v-7e9d9da8 data-v-30b7e073><!--[--><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/" data-v-711da5ba>🏠 首页 <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/home/home" data-v-711da5ba>码上行动 <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/IDEShortcutKey/WebStorm" data-v-711da5ba>编辑器快捷键 <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item active" href="/environmentConstruction/index" data-v-711da5ba>环境搭建 <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/windowSystem/index" data-v-711da5ba>window <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/service/Linux/index" data-v-711da5ba>linux <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/about/index" data-v-711da5ba>🔨关于 <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/concat/index" data-v-711da5ba>👫友情链接 <!----></a></div></div><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item" href="/temporary/index" data-v-711da5ba>临时存储 <!----></a></div></div><!--]--><!----><div class="item" data-v-30b7e073><div class="nav-link" data-v-30b7e073 data-v-711da5ba><a class="item isExternal" href="https://github.com/qdcz" target="_blank" rel="noopener noreferrer" data-v-711da5ba>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-711da5ba><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-7e9d9da8><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#退出ng进程">退出ng进程</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#代理斜杠问题">代理斜杠问题</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#重复出现多次跨域允许">重复出现多次跨域允许*</a><!----></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-f058c2ee><div class="container" data-v-f058c2ee><!--[--><!--]--><div style="position:relative;" class="content" data-v-f058c2ee><div><h1 id="_1、同行对比" tabindex="-1">1、同行对比</h1><p>IIS</p><p>Apache</p><p>Tomcat</p><p>Lighttpd</p><p>Nginx优点</p><p>5W并发量</p><p>Ng采用了多进程和I/O多路复用（epoll）的底层实线的</p><h1 id="_2、在线部署nginx（简单安装）" tabindex="-1">2、在线部署nginx（简单安装）</h1><p>1、安装gcc编译器、gcc能处理各种语言 使用命令 <code>yum install -y gcc</code>来安装 检查是否安装成功 <code>gcc-v</code></p><p>2、安装pcre 使用命令<code>yum install -y pcre pcre-devel</code> 来安装 检查是否安装成功 <code>rpm -qa pcre pcre-devel</code></p><p>因为ng有用到pcre库（兼容正则表达式库）rewrite 和 http 模块都有用到正则库</p><p>3、zlib</p><p>zlib库提供了压缩算法 使用命令<code>yum install -y zlib zlib-devel</code> 来安装 检查是否安装成功 <code>rpm -qa zlib zlib-devel</code></p><p>4、OpenSSL 使用命令<code>yum install -y openssl openssl-devel</code> 来安装 检查是否安装成功 <code>rpm -qa openssl openssl-devel</code></p><p>OpenSSL是一个开放源代码的软件库包</p><p>SSL：安全套接协议的缩写，可以在intelnet上提供秘密性传输。</p><p>5、在线下载ng 使用命令<code>wget ng的下载链接</code> 然后使用<code>tar -zxvf nginx-1.13.9.tar.gz</code> 解压到当前文件夹或者指定文件夹</p><p>6、进入到ng文件夹内 使用命令 <code>./configure</code> 进行简单安装</p><p>7、然后运行 <code>make &amp;&amp; make install</code> 进行全部安装 （默认安装路径是<code>/usr/local/nginx</code>）</p><p>8、启动ng 进入到sbin 文件夹内 运行 <code>./nginx</code> 即运行成功</p><h1 id="_3、离线部署nginx（简单安装）" tabindex="-1">3、离线部署nginx（简单安装）</h1><p><a href="http://nginx.org/en/download.html" target="_blank" rel="noopener noreferrer">http://nginx.org/en/download.html</a> 在官网下载ng包 选择linux版 然后上传☞服务器</p><p>安装ng时需要再安装一些环境所需的包</p><p>1、进入gcc文件夹 运行 <code> rpm -Uvh *.rpm --nodeps --force</code> 命令 检查是否安装成功 <code>gcc-v</code></p><p>2、进入gcc-c++文件夹 运行 <code> rpm -Uvh *.rpm --nodeps --force</code> 命令 检查是否安装成功 <code>g++-v</code></p><p>3、安装PCRE 解压 <code>tar -zxvf pcre-8.35.tar.gz</code> 然后 编译 ./configure &amp;&amp; make &amp;&amp; make install</p><p>4、安装libtool 解压 <code> tar -zxvf libtool-2.4.2.tar.gz</code> 然后 编译 ./configure &amp;&amp; make &amp;&amp; make install</p><p>5、安装ng 解压 <code>tar -zxvf nginx-1.13.9.tar.gz</code> 然后 编译 ./configure &amp;&amp; make &amp;&amp; make install</p><p>启动ng方式 nginx安装目录地址 -c nginx配置文件地址 如下：</p><div class="language-nginx"><pre><code>/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf            （安装后的路径会被变到/usr/local  里面）
</code></pre></div><div class="language-nginx"><pre><code>命令： 
路径 -s stop 							停止ng
路径 -s reload  						重启ng 


netstat -tunlp   						查看端口占用
netstat -tunlp |grep                      查看指定端口
</code></pre></div><h1 id="_4、复杂安装" tabindex="-1">4、复杂安装</h1><p>相当于在configure上做一些命令的添加</p><p>注意：要重新添加configure后面跟的后缀得卸载ng后重新安装</p><div class="language-shell"><pre><code>./configure --prefix<span class="token operator">=</span>/usr/local/nginx --with-http_ssl_module --with-openssl<span class="token operator">=</span>/usr/cxy/openssl-1.1.1l
</code></pre></div><h1 id="_5、卸载nginx" tabindex="-1">5、卸载nginx</h1><p>1、<code>./nginx -s stop</code> 先把ng停掉</p><p>2、<code>rm -rf /usr/local/nginx</code> 将ng删除</p><p>3、<code>make clean</code> 将安装包之前编译的环境清除掉</p><h1 id="_6、无停止服务更新nginx版本" tabindex="-1">6、无停止服务更新nginx版本</h1><p>1)、将旧版本的nginx下sbin的nginx进行备份</p><div class="language-shell"><pre><code><span class="token builtin class-name">cd</span> /usr/local/nginx/sbin
<span class="token function">mv</span> nginx nginxold
</code></pre></div><p>2)、将新版本的安装目录编译后的objs目录下的nginx文件拷贝到原来 <code>/usr/local/nginx/sbin</code> 目录下</p><div class="language-shell"><pre><code><span class="token builtin class-name">cd</span> ~/nginx/newVersion/nginx-1.16.1/objs
<span class="token function">cp</span> nginx /usr/local/nginx/sbin
</code></pre></div><p>3)、发送信号USR2给Nginx的旧版本对应的master进程</p><div class="language-shell"><pre><code><span class="token function">kill</span> -USR2 <span class="token variable"><span class="token variable">`</span><span class="token function">more</span> /usr/local/logs/nginx.pid<span class="token variable">`</span></span>
</code></pre></div><p>4)、发送信号QUIT给Nginx的旧版本对应的master进程</p><div class="language-shell"><pre><code><span class="token function">kill</span> -QUIT <span class="token variable"><span class="token variable">`</span><span class="token function">more</span> /usr/local/logs/nginx.pid.oldpid<span class="token variable">`</span></span>
</code></pre></div><h1 id="_7、nginx服务器升级" tabindex="-1">7、nginx服务器升级</h1><p>方案一、使用nginx服务信息升级</p><p>如上6</p><p>方案二、使用nginx安装目录的make命令升级</p><p>1)、将旧版本的nginx下sbin的nginx进行备份</p><div class="language-shell"><pre><code><span class="token builtin class-name">cd</span> /usr/local/nginx/sbin
<span class="token function">mv</span> nginx nginxold
</code></pre></div><p>2)、将新版本的安装目录编译后的objs目录下的nginx文件拷贝到原来 <code>/usr/local/nginx/sbin</code> 目录下</p><div class="language-shell"><pre><code><span class="token builtin class-name">cd</span> ~/nginx/newVersion/nginx-1.16.1/objs
<span class="token function">cp</span> nginx /usr/local/nginx/sbin
</code></pre></div><p>3)、进入到安装目录（注意再nginx目录下 而不是sbin目录下），执行make upgrade</p><p>4)、验证 nginx -V</p><h1 id="_8、user指令" tabindex="-1">8、user指令</h1><p>用于配置运行nginx服务器的worker进程的用户和用户组</p><div class="language-"><pre><code>useradd www   会在home目录下创建一个www的用户
user www      设置一个用户信息  www
在home/www/   目录下放置一个index.html页面


修改ng一个http模块的配置（可以先看下ng整体配置文件）
user  www;
location /{
	root	/home/www/html
	index	/index.html index.htm
}
</code></pre></div><h1 id="_9、work进程和master进程" tabindex="-1">9、work进程和master进程</h1><p>如果要关闭work进程</p><div class="language-nginx"><pre><code><span class="token comment"># user  nobody;         	# 用户组</span>
master_process	off    	<span class="token comment"># 默认使用on 开启工作进程</span>
worker_processes  1		<span class="token comment"># 用于配置nginx生成工作进程的数量，这是nginx服务器实现并发处理服务的关键所在，建议与服务器cpu内核数保持一致</span>
</code></pre></div><p>指定work进程的数量</p><div class="language-nginx"><pre><code><span class="token directive"><span class="token keyword">worker_processes</span>  <span class="token number">2</span></span><span class="token punctuation">;</span>
</code></pre></div><h1 id="_9、ng常使用的一些命令" tabindex="-1">9、ng常使用的一些命令</h1><div class="language-shell"><pre><code><span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> nginx   过滤出关于ng的进程信息
./nginx -t  检查config配置文件是否有错
./nginx -T  检查config配置文件是否有错并打印出配置文件
./nginx -tq 检查config配置文件是否有错并打印出配置文件中出错的位置和错误
</code></pre></div><h2 id="退出ng进程" tabindex="-1">退出ng进程</h2><div class="language-shell"><pre><code><span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> nginx 		拿到进程号
<span class="token function">more</span> <span class="token punctuation">..</span>/logs/nginx.pid		拿到进程号 两种方式都可
<span class="token function">kill</span> -<span class="token environment constant">TERM</span> <span class="token number">14270</span>    		杀掉进程   关于<span class="token environment constant">TERM</span>看如下表
</code></pre></div><div class="language-shell"><pre><code>./nginx -s stop 	<span class="token comment"># 停止ng</span>
./nginx -s reload 	<span class="token comment"># 重启ng</span>
./nginx -s start 	<span class="token comment"># 启动ng</span>
nginx -s 是给nginx发信号  如果未启动过直接 /usr/local/nginx/sbin/nginx 启动即可

./nginx -s quit     <span class="token comment"># 见如下</span>
./nginx -s hub
./nginx -s usr1
./nginx -s usr2
./nginx -s winch

./nginx -g <span class="token string">&quot;pid logs/test.pid&quot;</span>		<span class="token comment"># 以携带全局配置的方法启动ng</span>
</code></pre></div><table><thead><tr><th style="text-align:center;"><strong>TERM, INT</strong></th><th style="text-align:left;">Quick shutdown 直接杀死进程（粗暴）</th></tr></thead><tbody><tr><td style="text-align:center;"><strong>QUIT</strong></td><td style="text-align:left;">Graceful shutdown 优雅的关闭进程,即等请求结束后再关闭（推荐使用）</td></tr><tr><td style="text-align:center;"><strong>HUP</strong></td><td style="text-align:left;">Configuration reload ,Start the new worker processes with a new configuralltion Gracefully shutdown the old worker processes<br>(改变配置文件,平滑的重读配置文件）</td></tr><tr><td style="text-align:center;"><strong>USR1</strong></td><td style="text-align:left;">Reopen the log files 重读日志,在日志按月/日分割时有用</td></tr><tr><td style="text-align:center;"><strong>USR2</strong></td><td style="text-align:left;">Upgrade Executable on the fly 平滑的升级</td></tr><tr><td style="text-align:center;"><strong>WINCH</strong></td><td style="text-align:left;">Gracefully shutdown the worker processes 优雅关闭旧的进程(配合USR2来进行升级)</td></tr></tbody></table><div class="language-shell"><pre><code><span class="token comment"># 如果我删除了ng的日志  这时我不想重启 又要重新生成日志可以使用</span>
<span class="token function">kill</span> -USR1 <span class="token variable"><span class="token variable">`</span><span class="token function">more</span> /usr/local/nginx/logs/nginx.pid<span class="token variable">`</span></span>

<span class="token comment"># 只优雅的关闭work进程</span>
<span class="token function">kill</span> -WINCH <span class="token number">14270</span>

<span class="token comment"># 不重启nginx又要平滑的升级ng</span>
<span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> nginx 		拿到进程号
<span class="token function">kill</span> -USR2 <span class="token number">14270</span>		
<span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> nginx 		你会发现有两个master进程和work进程
进入到logs文件内  会出现两个文件  一个是nginx.pid.oldbin 一个是nginx.pid
如果确定服务器升级成功之后  执行  <span class="token function">kill</span> -QUIT 旧的主进程号  然后就升级成功了
</code></pre></div><h1 id="反向代理" tabindex="-1">反向代理</h1><h2 id="代理斜杠问题" tabindex="-1"><strong>代理斜杠问题</strong></h2><p><strong>1.以下是加不加斜杠都是一样的路径</strong> 都会访问 <code>http://10.142.124.221:18080/</code></p><div class="language-nginx"><pre><code><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span><span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://10.142.124.221:18080</span><span class="token punctuation">;</span>
        <span class="token comment"># proxy_pass http://10.142.124.221:18080/;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>2.带有前缀的话</strong></p><p>第一个会返回 <code>http://10.142.124.221:18080/server/index.html</code></p><p>第二个会返回 <code>http://10.142.124.221:18080/index.html</code></p><div class="language-nginx"><pre><code><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /server</span><span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://10.142.124.221:18080</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://10.142.124.221:18080/</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>或者如果想达到第二个的效果也可以进行如下操作</p><div class="language-nginx"><pre><code><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /proxy_api_out/</span><span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/proxy_api_out/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://10.142.124.221:18080</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

以上是会匹配路径上的/proxy_api_out/  如果匹配上会进行路径重写
</code></pre></div><h2 id="重复出现多次跨域允许" tabindex="-1">重复出现多次跨域允许*</h2><p>可以使用<code>proxy_set_header Origin &quot;&quot;;</code>将代理源的允许所有跨域清除掉 然后再自己设置上</p><h1 id="linux-ssl自签证书-nginx-将http升级成https" tabindex="-1">linux+ssl自签证书+nginx 将http升级成https</h1><p>nginx 需要开启 ssl模块</p><p>执行如下命令</p><div class="language-nginx"><pre><code>./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-openssl=/usr/cxy/ssl/openssl-1.1.1

<span class="token comment"># （/usr/cxy/ssl/openssl-1.1.1   是存放openssl源码的地方  可自行去nginx官网下载）</span>

然后make 
然后make install
</code></pre></div><p>1)、创建CA私钥， 利用私钥创建CA证书</p><div class="language-shell"><pre><code><span class="token comment">#创建CA私钥</span>
openssl genrsa -out rootCA.key <span class="token number">2048</span>
<span class="token comment">#创建CA证书</span>
openssl req -x509 -new -nodes -key rootCA.key -sha256 -days <span class="token number">1024</span> -out rootCA.crt
</code></pre></div><p>2)、创建server私钥以及CSR</p><div class="language-shell"><pre><code><span class="token comment">#创建server私钥</span>
openssl genrsa -out control.key <span class="token number">2048</span>
<span class="token comment">#根据配置要的openssl参数创建服务器csr文件， 后面会用到</span>
openssl req -new -key control.key -out control.csr -extensions v3_req
</code></pre></div><p>3)、使用CA证书给server.csr做签名</p><div class="language-shell"><pre><code>openssl x509 -req -days <span class="token number">500</span> -in control.csr -CA rootCA.crt -CAkey rootCA.key -CAcreateserial -out control.crt -sha256 -extensions v3_req
</code></pre></div><p>4)、将证书放到nginx的conf目录下 如果不这么做 你也可在配置中指定证书的位置</p><div class="language-nginx"><pre><code><span class="token directive"><span class="token keyword">ssl_certificate</span>      server.crt</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">ssl_certificate_key</span>  server.key</span><span class="token punctuation">;</span>
</code></pre></div><p>ng完整配置如下：</p><div class="language-shell"><pre><code>control <span class="token punctuation">{</span>
    listen       <span class="token number">443</span> ssl<span class="token punctuation">;</span>
    server_name  <span class="token number">192.168</span>.237.128<span class="token punctuation">;</span>

    ssl_certificate      control.crt<span class="token punctuation">;</span>
    ssl_certificate_key  control.key<span class="token punctuation">;</span>
    ssl_session_cache    shared:SSL:1m<span class="token punctuation">;</span>
    ssl_session_timeout  5m<span class="token punctuation">;</span>
    ssl_ciphers  HIGH:<span class="token operator">!</span>aNULL:<span class="token operator">!</span>MD5<span class="token punctuation">;</span>
    ssl_prefer_server_ciphers  on<span class="token punctuation">;</span>
    location / <span class="token punctuation">{</span>
        <span class="token comment"># rewrite ^/snxun/(.*)$ /$1 break;</span>
        proxy_pass http://127.0.0.1:7001<span class="token punctuation">;</span> 
        proxy_pass_header Server<span class="token punctuation">;</span> 
        proxy_set_header Host <span class="token variable">$http_host</span><span class="token punctuation">;</span> 
        proxy_redirect off<span class="token punctuation">;</span> 
        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span> 
        proxy_set_header X-Scheme <span class="token variable">$scheme</span><span class="token punctuation">;</span> 
        proxy_connect_timeout <span class="token number">60</span><span class="token punctuation">;</span> 
        proxy_read_timeout <span class="token number">120</span><span class="token punctuation">;</span>
        root   html<span class="token punctuation">;</span>
        index  index.html index.htm<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="慢慢完善配置文件" tabindex="-1">慢慢完善配置文件</h1><div class="language-nginx"><pre><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">8688</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>
    <span class="token comment">#charset koi8-r;</span>
    <span class="token directive"><span class="token keyword">access_log</span>  logs/8688_haojin.access.log  main</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">error_log</span>   logs/8688_haojin.error.log</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span><span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">location</span> /haojin-api-out/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">&#39;Access-Control-Allow-Origin&#39;</span> <span class="token string">&quot;*&quot;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">&#39;Access-Control-Allow-Methods&#39;</span> <span class="token string">&#39;GET, POST, OPTIONS&#39;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">&#39;Access-Control-Allow-Headers&#39;</span> <span class="token string">&#39;DNT,web-token,app-token,Authorization,Accept,Origin,Keep-Alive,User-Agent,X-Mx-ReqToken,X-Data-Type,X-Auth-Token,vaildMin,If-Modified-Since,Cache-Control,Content-Type,Range,pageNum,pageSize&#39;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">&#39;Access-Control-Expose-Headers&#39;</span> <span class="token string">&#39;Content-Length,Content-Range&#39;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">add_header</span> Pragma <span class="token string">&quot;no-cache&quot;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">&quot;no-store, no-cache, must-revalidate, post-check=0, pre-check=0&quot;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://10.249.0.31:18080/</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Origin <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_method</span> = OPTIONS)</span><span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">location</span> /haojin-api-in/</span> <span class="token punctuation">{</span>
        <span class="token comment"># rewrite ^/haojin-api/(.*)$ /$1 break;</span>
        <span class="token comment"># add_header &#39;Access-Control-Allow-Credentials&#39; &#39;true&#39;;</span>
        <span class="token comment"># add_header &#39;Access-Control-Allow-Origin&#39; $http_origin;</span>
        <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">&#39;Access-Control-Allow-Origin&#39;</span> <span class="token string">&quot;*&quot;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">&#39;Access-Control-Allow-Methods&#39;</span> <span class="token string">&#39;GET, POST, OPTIONS&#39;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">&#39;Access-Control-Allow-Headers&#39;</span> <span class="token string">&#39;DNT,web-token,app-token,Authorization,Accept,Origin,Keep-Alive,User-Agent,X-Mx-ReqToken,X-Data-Type,X-Auth-Token,vaildMin,If-Modified-Since,Cache-Control,Content-Type,Range,pageNum,pageSize&#39;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">&#39;Access-Control-Expose-Headers&#39;</span> <span class="token string">&#39;Content-Length,Content-Range&#39;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">add_header</span> Pragma <span class="token string">&quot;no-cache&quot;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">&quot;no-store, no-cache, must-revalidate, post-check=0, pre-check=0&quot;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://10.142.124.221:18080/</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Origin <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_method</span> = OPTIONS)</span><span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-shell"><pre><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
<span class="token comment">#error_log  logs/error.log  info;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>


events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>

    <span class="token comment">#log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>

    <span class="token comment">#access_log  logs/access.log  main;</span>

    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>

    control <span class="token punctuation">{</span>
        listen       <span class="token number">8688</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

         location / <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
            index  index.html index.htm<span class="token punctuation">;</span>
	    <span class="token comment"># proxy_pass http://10.249.0.31:18080;</span>
	    proxy_pass http://10.142.124.221:18080<span class="token punctuation">;</span>
            add_header Access-Control-Allow-Methods *<span class="token punctuation">;</span>
            add_header Access-Control-Max-Age <span class="token number">3600</span><span class="token punctuation">;</span>
            <span class="token comment"># add_header Access-Control-Allow-Credentials true;</span>
            <span class="token comment"># more_clear_headers Access-Control-Allow-Origin;</span>
            <span class="token comment"># add_header Access-Control-Allow-Origin $http_origin;</span>
            add_header Access-Control-Allow-Headers 
            <span class="token variable">$http_access_control_request_headers</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">=</span> OPTIONS<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token builtin class-name">return</span> <span class="token number">200</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect control error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span>
        <span class="token comment">#</span>
        <span class="token comment">#location ~ \.php$ {</span>
        <span class="token comment">#    proxy_pass   http://127.0.0.1;</span>
        <span class="token comment">#}</span>

        <span class="token comment"># pass the PHP scripts to FastCGI control listening on 127.0.0.1:9000</span>
        <span class="token comment">#</span>
        <span class="token comment">#location ~ \.php$ {</span>
        <span class="token comment">#    root           html;</span>
        <span class="token comment">#    fastcgi_pass   127.0.0.1:9000;</span>
        <span class="token comment">#    fastcgi_index  index.php;</span>
        <span class="token comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span>
        <span class="token comment">#    include        fastcgi_params;</span>
        <span class="token comment">#}</span>

        <span class="token comment"># deny access to .htaccess files, if Apache&#39;s document root</span>
        <span class="token comment"># concurs with nginx&#39;s one</span>
        <span class="token comment">#</span>
        <span class="token comment">#location ~ /\.ht {</span>
        <span class="token comment">#    deny  all;</span>
        <span class="token comment">#}</span>
    <span class="token punctuation">}</span>
    
    
    control <span class="token punctuation">{</span>
        listen       <span class="token number">7001</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

         location / <span class="token punctuation">{</span>
             root   html<span class="token punctuation">;</span>
            index  index.html index.htm<span class="token punctuation">;</span>
            proxy_pass http://101.231.77.77:28088/<span class="token punctuation">;</span>
             add_header Access-Control-Allow-Methods *<span class="token punctuation">;</span>
            add_header Access-Control-Max-Age <span class="token number">3600</span><span class="token punctuation">;</span>
            <span class="token comment"># add_header Access-Control-Allow-Credentials true;</span>
            <span class="token comment"># more_clear_headers Access-Control-Allow-Origin;</span>
            <span class="token comment"># add_header Access-Control-Allow-Origin $http_origin;</span>
            add_header Access-Control-Allow-Headers 
            <span class="token variable">$http_access_control_request_headers</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">=</span> OPTIONS<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token builtin class-name">return</span> <span class="token number">200</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect control error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span>
        <span class="token comment">#</span>
        <span class="token comment">#location ~ \.php$ {</span>
        <span class="token comment">#    proxy_pass   http://127.0.0.1;</span>
        <span class="token comment">#}</span>

        <span class="token comment"># pass the PHP scripts to FastCGI control listening on 127.0.0.1:9000</span>
        <span class="token comment">#</span>
        <span class="token comment">#location ~ \.php$ {</span>
        <span class="token comment">#    root           html;</span>
        <span class="token comment">#    fastcgi_pass   127.0.0.1:9000;</span>
        <span class="token comment">#    fastcgi_index  index.php;</span>
        <span class="token comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span>
        <span class="token comment">#    include        fastcgi_params;</span>
        <span class="token comment">#}</span>

        <span class="token comment"># deny access to .htaccess files, if Apache&#39;s document root</span>
        <span class="token comment"># concurs with nginx&#39;s one</span>
        <span class="token comment">#</span>
        <span class="token comment">#location ~ /\.ht {</span>
        <span class="token comment">#    deny  all;</span>
        <span class="token comment">#}</span>
    <span class="token punctuation">}</span>


    <span class="token comment"># another virtual host using mix of IP-, name-, and port-based configuration</span>
    <span class="token comment">#</span>
    <span class="token comment">#control {</span>
    <span class="token comment">#    listen       8000;</span>
    <span class="token comment">#    listen       somename:8080;</span>
    <span class="token comment">#    server_name  somename  alias  another.alias;</span>

    <span class="token comment">#    location / {</span>
    <span class="token comment">#        root   html;</span>
    <span class="token comment">#        index  index.html index.htm;</span>
    <span class="token comment">#    }</span>
    <span class="token comment">#}</span>


    <span class="token comment"># HTTPS control</span>
    <span class="token comment">#</span>
    <span class="token comment">#control {</span>
    <span class="token comment">#    listen       443 ssl;</span>
    <span class="token comment">#    server_name  localhost;</span>

    <span class="token comment">#    ssl_certificate      cert.pem;</span>
    <span class="token comment">#    ssl_certificate_key  cert.key;</span>

    <span class="token comment">#    ssl_session_cache    shared:SSL:1m;</span>
    <span class="token comment">#    ssl_session_timeout  5m;</span>

    <span class="token comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span>
    <span class="token comment">#    ssl_prefer_server_ciphers  on;</span>

    <span class="token comment">#    location / {</span>
    <span class="token comment">#        root   html;</span>
    <span class="token comment">#        index  index.html index.htm;</span>
    <span class="token comment">#    }</span>
    <span class="token comment">#}</span>

<span class="token punctuation">}</span>

</code></pre></div><div class="language-shell"><pre><code>./nginx -s reload  				// 重启
</code></pre></div><h1 id="个人记录" tabindex="-1">个人记录</h1><p>P25</p><p><a href="https://www.bilibili.com/video/BV1og411T76d?p=25&amp;spm_id_from=pageDriver" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1og411T76d?p=25&amp;spm_id_from=pageDriver</a></p></div></div><footer class="page-footer" data-v-f058c2ee data-v-4d1950e8><div class="edit" data-v-4d1950e8><div class="edit-link" data-v-4d1950e8 data-v-d1f281aa><!----></div></div><div class="updated" data-v-4d1950e8><p class="last-updated" data-v-4d1950e8 data-v-01ad1c9a><span class="prefix" data-v-01ad1c9a>最近更新时间:</span><span class="datetime" data-v-01ad1c9a></span></p></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"ideshortcutkey_webstorm.md\":\"18c6c91e\",\"about_index.md\":\"266d606d\",\"client_electron_base.md\":\"73b81831\",\"client_electron_index.md\":\"63ff8f07\",\"client_typescript_index.md\":\"2609fcb2\",\"client_css_滚动条.md\":\"704dd147\",\"client_javascript_xmlhttprequest.md\":\"ea195791\",\"client_javascript_base.md\":\"fd1f6794\",\"client_javascript_index.md\":\"eece4482\",\"client_javascript_函数.md\":\"bf6b65b9\",\"concat_index.md\":\"a782833f\",\"environmentconstruction_index.md\":\"b7b45d45\",\"environmentconstruction_linux.md\":\"491489b6\",\"environmentconstruction_mongodb离线安装.md\":\"9d0f7670\",\"environmentconstruction_mysql离线安装.md\":\"a3088b54\",\"environmentconstruction_nginx.md\":\"f2832f95\",\"environmentconstruction_redis离线安装.md\":\"29fa9b75\",\"home_home.md\":\"38f1fc65\",\"index.md\":\"b65b705c\",\"interest_drug_index.md\":\"90a8b05a\",\"interest_music_index.md\":\"3981382e\",\"npmpackage_index.md\":\"93ce991e\",\"npmpackage_log4js.md\":\"6d781e35\",\"qdcz-note.md\":\"4557beaf\",\"service_linux_index.md\":\"a9464d28\",\"service_linux_linux.md\":\"4e8c9496\",\"service_linux_存储单位.md\":\"1e89b4f1\",\"service_mongodb_base.md\":\"6ca155d3\",\"service_mongodb_index.md\":\"4208220d\",\"service_mongodb_建立ttl索引.md\":\"53de734b\",\"service_nginx_index.md\":\"11980c9c\",\"service_nginx_window版本.md\":\"fe4f4779\",\"service_nodejs_base.md\":\"adf20931\",\"service_nodejs_buffer.md\":\"31afcf78\",\"service_nodejs_child_process.md\":\"b4f536bf\",\"service_nodejs_index.md\":\"b32f8eae\",\"service_nodejs_node分享课1.md\":\"f7826959\",\"service_nodejs_process.md\":\"b9b704bb\",\"service_nodejs_stream.md\":\"18fec455\",\"service_nodejs_工具函数.md\":\"0a5d610f\",\"service_nodejs_文件描述符.md\":\"d3c6d470\",\"service_nodejs_日志系统记录.md\":\"6aca9a07\",\"service_nodejs_混淆编译打包.md\":\"33ae689f\",\"service_nodejs_锁.md\":\"6d1431a0\",\"service_koa_index.md\":\"8c028d04\",\"service_koa_洋葱模型.md\":\"26a07483\",\"softwareengineering_面向对象编程.md\":\"7d674901\",\"temporary_index.md\":\"5a23302e\",\"temporary_recentplan.md\":\"4a33a5c9\",\"temporary_websocketforauthbynodejs.md\":\"2ff12679\",\"temporary_work_day_work_report.md\":\"b2cedae0\",\"temporary_work_todayplan.md\":\"b7eb1c2b\",\"temporary_work_weekly_work_report.md\":\"26f025a0\",\"windowsystem_cmd命令.md\":\"e4ff76d1\",\"windowsystem_index.md\":\"ef9c447f\",\"windowsystem_创建本地共享文件夹.md\":\"76d9012b\"}")</script>
    <script type="module" async src="/assets/app.f3070ad9.js"></script>
    
  </body>
</html>